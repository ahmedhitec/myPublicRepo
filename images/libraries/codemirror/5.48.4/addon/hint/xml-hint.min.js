!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(a,b,c){return c?a.indexOf(b)>=0:0==a.lastIndexOf(b,0)}function c(c,e){var f=e&&e.schemaInfo,g=e&&e.quoteChar||'"',h=e&&e.matchInMiddle;if(f){var i=c.getCursor(),j=c.getTokenAt(i);j.end>i.ch&&(j.end=i.ch,j.string=j.string.slice(0,i.ch-j.start));var k=a.innerMode(c.getMode(),j.state);if("xml"==k.mode.name){var l,m,n=[],o=!1,p=/\btag\b/.test(j.type)&&!/>$/.test(j.string),q=p&&/^\w/.test(j.string);if(q){var r=c.getLine(i.line).slice(Math.max(0,j.start-2),j.start),s=/<\/$/.test(r)?"close":/<$/.test(r)?"open":null;s&&(m=j.start-("close"==s?2:1))}else p&&"<"==j.string?s="open":p&&"</"==j.string&&(s="close");if(!p&&!k.state.tagName||s){q&&(l=j.string),o=s;var t=k.state.context,u=t&&f[t.tagName],v=t?u&&u.children:f["!top"];if(v&&"close"!=s)for(var w=0;w<v.length;++w)(!l||b(v[w],l,h))&&n.push("<"+v[w]);else if("close"!=s)for(var x in f)!f.hasOwnProperty(x)||"!top"==x||"!attrs"==x||l&&!b(x,l,h)||n.push("<"+x);t&&(!l||"close"==s&&b(t.tagName,l,h))&&n.push("</"+t.tagName+">")}else{var u=f[k.state.tagName],y=u&&u.attrs,z=f["!attrs"];if(!y&&!z)return;if(y){if(z){var A={};for(var B in z)z.hasOwnProperty(B)&&(A[B]=z[B]);for(var B in y)y.hasOwnProperty(B)&&(A[B]=y[B]);y=A}}else y=z;if("string"==j.type||"="==j.string){var C,r=c.getRange(d(i.line,Math.max(0,i.ch-60)),d(i.line,"string"==j.type?j.start:j.end)),D=r.match(/([^\s\u00a0=<>\"\']+)=$/);if(!D||!y.hasOwnProperty(D[1])||!(C=y[D[1]]))return;if("function"==typeof C&&(C=C.call(this,c)),"string"==j.type){l=j.string;var E=0;/['"]/.test(j.string.charAt(0))&&(g=j.string.charAt(0),l=j.string.slice(1),E++);var F=j.string.length;if(/['"]/.test(j.string.charAt(F-1))&&(g=j.string.charAt(F-1),l=j.string.substr(E,F-2)),E){var G=c.getLine(i.line);G.length>j.end&&G.charAt(j.end)==g&&j.end++}o=!0}for(var w=0;w<C.length;++w)(!l||b(C[w],l,h))&&n.push(g+C[w]+g)}else{"attribute"==j.type&&(l=j.string,o=!0);for(var H in y)!y.hasOwnProperty(H)||l&&!b(H,l,h)||n.push(H)}}return{list:n,from:o?d(i.line,null==m?j.start:m):i,to:o?d(i.line,j.end):i}}}}var d=a.Pos;a.registerHelper("hint","xml",c)});
!function(t,a,e,o){"use strict";var i="a-Toolbar",n=t.ui.keyCode,r=1;t.widget("apex.toolbar",{version:"5.1",widgetEventPrefix:"toolbar",options:{label:"",toolbarFor:null,idPrefix:null,actionsContext:null,small:!1,simple:!1,toolbarClass:"",cursorKeyNavigation:!1,data:[]},_create:function(){var e,n=this.element,r=this,s=this.options;e=a.debounce((function(a,e){"update"!==e&&"updateChoices"!==e||(r.enterActions[a.name]&&n.find('[data-enter-action="'+a.name+'"]').prop("disabled",!!a.disabled),n.is(":visible")&&n.find(".a-Toolbar-group").each((function(){var a,e=t(this);a=e.children().filter((function(){return!this.style||"none"!==this.style.display})).length>0,e.toggle(a)})))}),10),this.menus={},this.enterActions={},n.addClass(i).attr("role","toolbar").attr("aria-label",s.label?s.label:o.formatMessage("APEX.TB.TOOLBAR")),s.toolbarFor&&n.attr("aria-controls",s.toolbarFor),s.small&&n.addClass("a-Toolbar--small"),s.simple&&n.addClass("a-Toolbar--simple"),s.toolbarClass&&n.addClass(s.toolbarClass),apex.actions&&(this.actionsContext=s.actionsContext||apex.actions,this.actionsContext.observe(e),this.actionObserver=e),this.refresh(),s.cursorKeyNavigation&&(this.toolbarHasChanged(),this._on(this._keyNavHandlers))},_keyNavHandlers:{keydown:function(a){var e=this,o=a.which,i=t(a.target);function r(t){var o,i;t.attr("tabindex","-1"),o=(i=parseFloat(e.focusableElements.index(t[0])+1))>=e.focusableElements.length?e.focusableElements.first():e.focusableElements.filter(":eq("+i+")"),t.is(":input[type=radio]")&&t.attr("name")===o.attr("name")?r(o):o.attr("tabindex","0").focus(),a.preventDefault()}function s(t){var o,i;t.attr("tabindex","-1"),o=(i=parseFloat(e.focusableElements.index(t[0])-1))<0?e.focusableElements.last():e.focusableElements.filter(":eq("+i+")"),t.is(":input[type=radio]")&&t.attr("name")===o.attr("name")?s(o):o.attr("tabindex","0").focus(),a.preventDefault()}i.is(":input[type=text],:input[type=radio],select")?a.shiftKey&&o===n.TAB?s(i):o===n.TAB&&r(i):o===n.LEFT?s(i):o===n.RIGHT&&r(i)}},_destroy:function(){var a,e=this.element,o=this.options;for(a in e.removeClass(i+" a-Toolbar--small a-Toolbar--simple "+o.toolbarClass).removeAttr("role").empty(),this.actionsContext&&this.actionsContext.unobserve(this.actionObserver),this.menus)this.menus.hasOwnProperty(a)&&t("#"+a).remove()},_setOption:function(t,a){var e=this.element;"small"===t&&e.toggleClass("a-Toolbar--small",a),"simple"===t&&e.toggleClass("a-Toolbar--simple",a),"toolbarClass"===t&&e.removeClass(this.options.toolbarClass).addClass(a),this._super(t,a),"data"===t&&this.refresh()},_getControlProperty:function(t,a){var e,o;return void 0===(o=t[a])&&t.action&&(e=this.actionsContext.lookup(t.action))&&e[a]&&(o=e[a]),o},_getLocalizedControlProperty:function(t,a){var e,i=null;return t[a+"Key"]?i=o.getMessage(t[a+"Key"]):void 0!==t[a]&&(i=t[a]),!i&&t.action&&(e=this.actionsContext.lookup(t.action))&&void 0!==e[a]&&(i=e[a]),i},_getNoUpdate:function(t){return t.label||t.labelKey||t.icon||t.title||t.titleKey?"true":null},_getId:function(t){var a=this.options.idPrefix||this.element[0].id||"tb";return t.id?a+"_"+t.id:null},_forceId:function(t){t.id||(t.id="m"+r,r+=1)},_buildText:function(a,e){var o=t.extend({id:"",label:"",size:"30",maxChars:"4000",placeholder:"",action:""},e);o.enterAction&&(this.enterActions[o.enterAction]=!0),a.markup("<input").optionalAttr("id",this._getId(o)).attr("class","a-Toolbar-input a-Toolbar-inputText a-Toolbar-item").attr("title",this._getLocalizedControlProperty(o,"label")).attr("type","text").attr("size",o.size).attr("maxlength",o.maxChars).attr("value","").optionalAttr("placeholder",this._getLocalizedControlProperty(o,"placeholder")).optionalAttr("data-enter-action",o.enterAction).markup(" />")},_buildStatic:function(t,a){t.markup("<span").optionalAttr("id",this._getId(a)).attr("class","a-Toolbar-static a-Toolbar-item").markup(">"),a.content?t.markup(a.content):t.content(this._getLocalizedControlProperty(a,"label")),t.markup("</span>")},_buildSelect:function(t,a){var e,o=this.actionsContext.lookup(a.action);(e=this._getLocalizedControlProperty(a,"title"))||(e=this._getLocalizedControlProperty(a,"label")),t.markup("<select").optionalAttr("id",this._getId(a)).attr("class","a-Toolbar-selectList js-actionSelect a-Toolbar-item").attr("size","1").optionalAttr("title",e).optionalAttr("aria-label",e).optionalBoolAttr("disabled",o&&!!o.disabled).attr("data-action",a.action).markup("></select>")},_buildButton:function(t,a){var e,o,i,n,r,s="a-Button a-Toolbar-item",l=a.menu||a.menuId;function u(){t.markup("<span").attr("class","a-Icon "+i).markup("></span>")}l?(a.menu?(this._forceId(a),e=this._getId(a)+"_menu"):e=a.menuId,s+=" js-menuButton"):s+=" js-actionButton",(i=this._getControlProperty(a,"icon"))&&(s+=" a-Button--withIcon"),a.iconOnly&&(s+=" a-Button--noLabel"),a.hot&&(s+=" a-Button--hot"),(r=this.actionsContext.lookup(a.action))&&r.get&&!r.onLabel&&r.get(a.action)&&(s+=" is-active"),t.markup("<button type='button'").attr("class",s).optionalAttr("id",this._getId(a)).optionalBoolAttr("disabled",r&&!!r.disabled),o=this._getLocalizedControlProperty(a,"label"),n=this._getLocalizedControlProperty(a,"title"),!o&&r&&r.get&&(o=r.get()?r.onLabel:r.offLabel),a.iconOnly?(n||(n=o),t.attr("title",n).attr("aria-label",o)):n&&t.attr("title",n),l?t.attr("data-menu",e).attr("aria-haspopup",!0).attr("aria-expanded",!1):t.attr("data-action",a.action).optionalAttr("data-no-update",this._getNoUpdate(a)),t.markup(">"),i&&a.iconBeforeLabel&&u(),a.iconOnly||t.markup("<span class='a-Button-label'>").content(o).markup("</span>"),i&&!a.iconBeforeLabel&&u(),l&&t.markup("<span").attr("class","a-Icon icon-menu-drop-down").markup("></span>"),t.markup("</button>"),a.menu&&(this.menus[e]=a.menu)},_buildRadioButtonGroup:function(t,a){t.markup("<div role='group'").attr("aria-label",this._getLocalizedControlProperty(a,"label")).attr("class","a-Toolbar-radioGroup js-actionRadioGroup a-Toolbar-item").attr("data-action",a.action).attr("data-item","a-Button").attr("data-item-wrap","a-Toolbar-button-item").markup("></div>")},_buildToggle:function(t,a){var e,o,i=this.actionsContext.lookup(a.action);this._forceId(a),o="a-Toolbar-input a-Toolbar-inputCheckbox",(e=i&&i.get(a.action))&&(o+=" is-active"),t.markup("<div").attr("class","a-Toolbar-toggleButton js-actionCheckbox a-Toolbar-item").attr("data-action",a.action).optionalAttr("data-no-update",this._getNoUpdate(a)).markup(">"),t.markup("<input type='checkbox'").attr("class",o).attr("name",a.action).attr("id",this._getId(a)).optionalBoolAttr("checked",e).optionalBoolAttr("disabled",i&&!!i.disabled).markup(" />"),t.markup("<label").attr("for",this._getId(a)).attr("class","a-Button").markup(">").content(this._getLocalizedControlProperty(a,"label")).markup("</label>"),t.markup("</div>")},_buildToolbar:function(t,a){var e,o=[],i=[],n=[];for(e=0;e<a.length;e++)a[e].align&&"start"!==a[e].align?"center"===a[e].align?i.push(a[e]):"end"===a[e].align&&n.push(a[e]):o.push(a[e]);o.length&&this._buildGroupContainer(t,"start",o),i.length&&this._buildGroupContainer(t,"center",i),n.length&&this._buildGroupContainer(t,"end",n)},_buildGroupContainer:function(t,a,o){var i,n,r,s,l,u="a-Toolbar-groupContainer";switch(a){case"start":u+=" a-Toolbar-groupContainer--start";break;case"center":u+=" a-Toolbar-groupContainer--center";break;case"end":u+=" a-Toolbar-groupContainer--end"}for(t.markup("<div").attr("class",u).markup(">"),i=0;i<o.length;i++){for(l="a-Toolbar-group",(r=o[i]).customCSS&&(l+=" "+r.customCSS),r.groupTogether&&(l+=" a-Toolbar-group--together"),t.markup("<div").attr("class",l).markup(">"),n=0;n<r.controls.length;n++)switch((s=r.controls[n]).type){case"STATIC":this._buildStatic(t,s);break;case"TEXT":this._buildText(t,s);break;case"SELECT":this._buildSelect(t,s);break;case"MENU":case"BUTTON":this._buildButton(t,s);break;case"RADIO_GROUP":this._buildRadioButtonGroup(t,s);break;case"TOGGLE":this._buildToggle(t,s);break;default:e.error("Unknown toolbar control type: "+s.type)}t.markup("</div>")}t.markup("</div>")},refresh:function(){var e,o,i,n,r,s,l,u=this,c=this.element,d=this.options,p=d.data,h=a.htmlBuilder();for(r in this.menus)this.menus.hasOwnProperty(r)&&t("#"+r).remove();for(this._buildToolbar(h,d.data),c.html(h.toString()),e=0;e<p.length;e++)if(i=p[e].controls)for(o=0;o<i.length;o++)n=i[o],(l=this.actionsContext.lookup(n.action))&&(l.hide&&this.actionsContext.update(n.action),l.choices&&this.actionsContext.updateChoices(n.action));for(r in c.find(".a-Toolbar-input").on("keydown",(function(a){var e=t(a.target).attr("data-enter-action");e&&13===a.which&&(u.actionsContext.invoke(e),a.preventDefault())})),this.menus)this.menus.hasOwnProperty(r)&&(t("<div/>",{id:r,class:"a-Toolbar-menu",style:"display:none;"}).appendTo("body"),(s=this.menus[r]).actionsContext=this.actionsContext,s.idPrefix=this.options.idPrefix||this.element[0].id||"tb",t("#"+r).menu(s))},toolbarHasChanged:function(){var t,a;this.focusableElements=this.element.find(":focusable"),a=(t=this.focusableElements.filter("[tabindex=0]")).length?this.focusableElements.index(t[0]):0,this.focusableElements.filter(":eq("+a+")").attr("tabindex","0").end().not(":eq("+a+")").attr("tabindex","-1")},hideControl:function(t){var a=this.find(t);a&&(a.action?this.actionsContext.hide(a.action):(this.findElement(t).hide(),this.actionObserver&&this.actionObserver({},"update")))},showControl:function(t){var a=this.find(t);a&&(a.action?this.actionsContext.show(a.action):(this.findElement(t).show(),this.actionObserver&&this.actionObserver({},"update")))},disableControl:function(t){var a=this.find(t);a&&(a.action?this.actionsContext.disable(a.action):this.findElement(t).prop("disabled",!0))},enableControl:function(t){var a=this.find(t);a&&(a.action?this.actionsContext.enable(a.action):this.findElement(t).prop("disabled",!1))},findGroup:function(t){var a,e,o=this.options.data;for(a=0;a<o.length;a++)if((e=o[a]).id===t)return e;return null},find:function(a){var e,o,i,n,r,s=this.options.data;for(e=0;e<s.length;e++)if(i=s[e].controls)for(o=0;o<i.length;o++)if((n=i[o]).id===a)return n;for(r in this.menus)if(this.menus.hasOwnProperty(r)&&(n=t("#"+r).menu("find",a)))return n;return null},findElement:function(a){var e=this._getId({id:a});return t("#"+e)}})}(apex.jQuery,apex.util,apex.debug,apex.lang);
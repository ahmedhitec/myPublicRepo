apex.widget.util={},function(e,t,o,n,a){"use strict";e.cascadingLov=function(e,t,o,n){var i=a(e,apex.gPageContext$),r=i[0]?i[0].id:"lov",s=a.extend({optimizeRefresh:!0,queue:{name:r,action:"replace"}},n),l=!1;return s.refreshObject||(s.refreshObject=i),s.loadingIndicator||(s.loadingIndicator=i),s.optimizeRefresh&&(a(s.dependingOn,apex.gPageContext$).each((function(){if(apex.item(this).isEmpty())return l=!0,!1})),l)?(s.refreshObject.trigger("apexbeforerefresh"),a.isFunction(s.clear)&&s.clear(),i.change(),void s.refreshObject.trigger("apexafterrefresh")):(o.pageItems=a(o.pageItems,apex.gPageContext$).add(s.dependingOn),apex.server.plugin(t,o,s))};e.openPopupLov=function(e,n,i,r,s){var l,c,u,h,d,p,f,m,v,g=t.getTopApex().jQuery,y=null,x=r.isPopup||!1,P=o.getMessage("APEX.POPUP_LOV.NO_RESULTS"),_=null,O=r.incrementalSearch,C=r.initialSearch||"",E=a("#"+r.itemId),w="PopupLov_"+a("#pFlowStepId").val()+"_"+r.itemId,b=w+"_dlg",I=null;function S(e){u.resize()}function T(e,o,n,a){var i,s=!1,c=!1,h=l.getOption("fetchData");e.forceRefresh&&(s=!0,"none"!==r.initialFetch||e.typeAhead&&O||(c=!0),h.search=null,e.forceRefresh=!1),null!==o&&o!==h.search&&(h.search=o,s=!0),n&&a&&(n!==h.sortColumn||a!==h.sortDirection)&&(h.sortColumn=n,h.sortDirection=a,s=!0),s&&(i=t.escapeRegExp(h.search).replace(/[_%]/g,(function(e){return"[^<>&]"+("%"===e?"*":"")})),u.options.highlighterContext={term:h.search,re:new RegExp("([<>&;])|("+i+")","ig")},_?o.length>=r.minSearchChars&&!c&&!e.typeAhead?(u._setOption("noDataMessage",P),l.clearData()):(u._setOption("noDataMessage",_),l.setData([]),h.search=null):e.typeAhead&&!O?(l.setData([]),h.search=null):l.clearData(),e.typeAhead=!1)}function D(){v.setItem("state",JSON.stringify(y))}r.persistState&&function(){var e;if(v=apex.storage.getScopedSessionStorage({prefix:w,usePageId:!0,useAppId:!0}),y={},"grid"===r.display&&(y.columnWidths={}),e=v.getItem("state"))try{e=JSON.parse(e),x||(y.width=parseInt(e.width,10)||r.width,y.height=parseInt(e.height,10)||r.height),e.sortDirection&&/^(asc|desc)$/.test(e.sortDirection)&&(y.sortDirection=e.sortDirection),r.columns[e.sortColumn]&&(y.sortColumn=e.sortColumn),a.each(e.columnWidths,(function(e,t){(t=parseInt(t,10))&&(y.columnWidths[e]=t)}))}catch(e){}}(),m=function(){return"<div class='a-PopupLOV-dialog'></div>"},E.data("popupSearchState",{forceRefresh:e,typeAhead:i,searchText:n}),!g("#"+b)[0]&&y&&(r.width=y.width||r.width,r.height=y.height||r.height,y.sortColumn&&y.sortDirection&&a.each(r.columns,(function(e,t){e===y.sortColumn&&t.canSort?(t.sortIndex=1,t.sortDirection=y.sortDirection):(delete t.sortIndex,delete t.sortDirection)})),a.each(y.columnWidths,(function(e,t){r.columns[e].width=t}))),h={id:b,title:r.title||o.getMessage("APEX.POPUP.SEARCH"),isPopup:x,parentElement:x?E.closest(".apex-item-group--popup-lov"):null,returnFocusTo:E[0],noOverlay:!0,draggable:!0,resizable:!0,width:200,height:r.height,okButton:!1,dialogClass:"ui-dialog-popuplov",notification:!1,callback:function(){var e,t,o,n,a="setValue",i=apex.item(r.itemId);if(r.multiple&&(a="addValue"),I&&("object"==typeof I&&I.hasOwnProperty("d")&&I.hasOwnProperty("v")?i[a](I.v,I.d):"object"==typeof I&&I.hasOwnProperty("v")?i[a](I.v):i[a](I),!r.multiple&&(e=r.extraOut)))for(t in e)e.hasOwnProperty(t)&&(n=null,null!==(o=I[t])&&"object"==typeof o&&o.hasOwnProperty("d")&&(n=(o=o.v).d),$s(e[t].item,o,n));u.setSelectedRecords([],!1),s&&s(I)},init:function(s){var h,m,v,g,b,S,L,H,V=null,R=null,k=w+"_m",M=s.is(":data(apexPopup)")?"popup":"dialog",z=o.getMessage("APEX.POPUP.SEARCH"),A={forceRefresh:e,typeAhead:i,searchText:C||n},j=t.htmlBuilder();function N(e){return e.match(/^[A-Z0-9_$#]+$/)?"&"+e+".":'&"'+e+'".'}function Y(){var e=u.getSelectedRecords()[0];e&&(I={v:l.getValue(e,r.valueColumn)},r.hasDisplayValue&&r.displayColumn&&(I.d=l.getValue(e,r.displayColumn)),r.extraOut&&Object.keys(r.extraOut).forEach((function(t){I[t]=l.getValue(e,t)})),s[M]("close"))}function U(e,t,o){var n=null;return!e.term||o&&!1===o.canSearch?t:t.replace(e.re,(function(e,t,o){if(t){switch(t){case"<":n=t;break;case">":"<"===n&&(n=null);break;case"&":n||(n=t);break;case";":"&"===n&&(n=null)}return t}return n||!o.length?o:"<span class='popup-lov-highlight'>"+o+"</span>"}))}if(E.data("popupSearchState",A),j.markup("<div><div").attr("class","a-PopupLOV-searchBar"+(O?" a-PopupLOV--incremental":"")).markup("><input type='text' aria-label='"+z+"' maxlength='100' class='a-PopupLOV-search apex-item-text'").attr("value",C).markup(">"),O||j.markup("<button type='button' class='a-Button a-PopupLOV-doSearch' aria-label='"+z+"'>"),j.markup("<span class='a-Icon icon-search' aria-hidden='true'></span>"),O||j.markup("</button>"),j.markup("</div>"),r.nullDisplayValue&&j.markup("<div class='a-PopupLOV-clear'><button class='a-PopupLOV-clearButton' type='button'>").content(r.nullDisplayValue).markup("</button></div>"),j.markup("<div class='a-PopupLOV-results'></div></div></div>"),L=a(j.toString()),c=L.find(".a-PopupLOV-results"),d=L.find(".a-PopupLOV-searchBar"),p=d.find(".a-PopupLOV-search"),H=d.find(".a-PopupLOV-doSearch"),f=L.find(".a-PopupLOV-clearButton"),a.each(r.columns,(function(e,t){if(t.sortIndex)return V=e,R=t.sortDirection,!1})),l=apex.model.create(k,{shape:"table",hasTotalRecords:!1,recordIsArray:!0,identityField:r.valueColumn,metaField:r.columns._meta?"_meta":null,fields:r.columns,paginationType:"progressive",regionId:r.itemId,fetchData:{search:null,sortColumn:V,sortDirection:R},requestOptions:r.pluginTarget?{target:r.pluginTarget}:null,ajaxIdentifier:r.ajaxIdentifier,pageItemsToSubmit:r.itemsToSubmit},[],0,!1),E.data("popupLovModelName",k),b=r.displayColumn||r.valueColumn,"grid"===r.display)r.columns[b].usedAsRowHeader=!0,r.iconColumn&&(g="<span class='"+N(r.iconColumn)+"'></span> "+N(b),r.columns[b].cellTemplate=g),h=a.extend({modelName:k,columns:[r.columns],columnSort:!0,columnSortMultiple:!1,collapsibleControlBreaks:!1,footer:!1,hasSize:!0,noDataMessage:P,multiple:!1,pagination:{scroll:!0,loadMore:!0},constrainNavigation:!1,reorderColumns:!1,resizeColumns:!0,tooltip:null,highlighter:U,activateCell:function(e){var t=a(e.target).closest(".a-GV-cell");"keydown"===e.type&&13!==e.which||t.hasClass("a-GV-selHeader")||t.hasClass("has-button")||Y()},selectionChange:function(e){e.originalEvent&&"click"===e.originalEvent.type&&Y()},sortChange:function(e,t){var o,n,a,i=t.column.sortIndex,r=v.grid("getColumns");for(a=1,o=0;o<r.length;o++)(n=r[o]).sortIndex&&("change"===t.action?n===t.column&&(a=n.sortIndex):"add"===t.action?n.sortIndex>=a&&(a=n.sortIndex+1):"remove"===t.action?n===t.column?(delete n.sortIndex,delete n.sortDirection):n.sortIndex>i&&(n.sortIndex-=1):"clear"!==t.action&&"set"!==t.action||(delete n.sortIndex,delete n.sortDirection));"clear"!==t.action&&"remove"!==t.action&&(t.column.sortIndex=a,t.column.sortDirection=t.direction),v.grid("refreshColumns"),T(A,null,t.column.property,t.direction),y&&(y.sortColumn=t.column.property,y.sortDirection=t.direction,D())},columnResize:function(e,t){y&&(y.columnWidths[t.column.property]=parseInt(t.width,10),D())}},r.defaultGridOptions),(v=c).grid(h),u=v.data("apex-grid"),v.click((function(e){a(e.target).closest(".a-GV-row").hasClass("is-selected")&&Y()}));else{if("list"!==r.display)throw new Error("Invalid display value");(g=r.recordTemplate)?g=g.replace("&DISPLAY.","&"+b+".").replace("&ICON.","&"+r.iconColumn+".").replace("&RETURN.","&"+r.valueColumn+"."):(g="<li data-id='"+N(r.valueColumn)+"'>",r.iconColumn&&(g+="<span class='"+N(r.iconColumn)+"'></span> "),g+=N(b)+"</li>"),m=a.extend({modelName:k,recordTemplate:g,footer:!1,hasSize:!0,noDataMessage:P,highlighter:U,useIconList:!0,constrainNavigation:!1,iconListOptions:{navigation:!0,multiple:!1,activate:function(e){Y(),e.preventDefault()}},pagination:{scroll:!0,loadMore:!0}},r.defaultIconListOptions),c.tableModelView(m),u=c.data("apex-tableModelView")}s.append(L.children()),r.minSearchChars>0&&(_=o.formatMessage("APEX.POPUP_LOV.FILTER_REQ",r.minSearchChars)),_||"none"!==r.initialFetch||(_=o.getMessage("APEX.POPUP_LOV.INITIAL_FILTER_REQ")),O&&(S=t.debounce((function(){T(A,p.val())}),400)),c.keydown((function(e){var t=e.which;e.isDefaultPrevented()||(40===t?p.focus():38===t&&f.add(p).last().focus())})).focusin((function(){var e=u.getSelection();0===e.length&&(e=a(c[0].ownerDocument.activeElement).closest(".a-IconList-item,.a-GV-row"))[0]&&u.setSelection(e)})),p.keydown((function(e){var t,o=e.which;40===o?(f[0]?f.focus():u.focus(),e.preventDefault()):38===o?(u.focus(),e.preventDefault()):9===o&&O?1===l.getTotalRecords()&&(v?v.grid("setSelection",v.find(".a-GV-cell").eq(0)):u.focus(),Y(),e.preventDefault(),e.stopPropagation()):13===o?(e.preventDefault(),O&&r.enterable&&x&&p.val()?(I={v:p.val()},s[M]("close")):O&&!r.enterable&&1===l.getTotalRecords()?(t=null,l.forEach((function(e){t=e})),t&&(u.setSelectedRecords([t]),Y())):T(A,p.val())):O&&S()})),H.click((function(){T(A,p.val())})),f.click((function(){I={v:r.nullValue,d:r.nullDisplayValue},r.extraOut&&Object.keys(r.extraOut).forEach((function(e){I[e]=""})),s[M]("close")})).keydown((function(e){var t=e.which;40===t?(u.focus(),e.preventDefault()):38===t&&(p.focus(),e.preventDefault())})),s.attr("role","application")},open:function(e){var t,o,n,i,s=E.data("popupSearchState"),l=s.searchText||"",c=g(e.target),u=c.is(":data(apexPopup)")?"popup":"dialog";r.width||(t=E.closest(".apex-item-group--popup-lov").width()),x&&(n=a(window).width()-10,i=a(window).height()-10,(r.width||t)>n&&(t=n),r.height>i&&(o=i)),t&&c[u]("option","width",t),o&&c[u]("option","height",o),S(e.target),I=null,(l||s.forceRefresh)&&(p.val(l),T(s,l)),p.focus()},resize:function(e){S(e.target)},resizeStop:function(e,t){y&&!x&&(y.height=t.size.height,y.width=t.size.width,D())}},["draggable","resizable","width","height","minWidth","minHeight","maxWidth","maxHeight","noOverlay"].forEach((function(e){void 0!==r[e]&&(h[e]=r[e])})),apex.message.showDialog(m,h)};var i=function(e,t){e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),"label-desc"===t&&e.reverse()};e.chartSortArray=i,e.chartFillGaps=function(e,t,o,n){i(t,o);for(var a=0;a<e.length;a++)t[a]&&t[a].name===e[a].name?t[a].id!==a&&(t[a].id=a):t.splice(a,0,{name:e[a].name,value:n?0:null})},e.enableIcon=function(e,t,o){e.find("img").css({opacity:1,cursor:""}).parent("a").attr("href",t),o&&e.click(o)},e.disableIcon=function(e){e.find("img").css({opacity:.5,cursor:"default"}).parent("a").removeAttr("href").unbind("click")};var r=[];function s(e){var t;for(t=0;t<r.length;t++)if(r[t].el===e)return t;return null}e.onVisibilityChange=function(e,t){var o=s(e),n={el:e,cb:t};null!==o?r[o]=n:r.push(n)},e.offVisibilityChange=function(e){var t=s(e);null!==t&&r.splice(t,1)};var l=e.visibilityChange=function(e,t){var o,n,i,s=a(e);for(t=!!t,o=0;o<r.length;o++)i=r[o],t===(n=a(i.el)).is(":visible")&&n.closest(s).length&&i.cb(t)};a(document).on("apexaftershow",(function(e){l(e.target,!0)})).on("apexafterhide",(function(e){l(e.target,!1)}));e.onElementResize=function(e,t){var o,n;"string"==typeof e&&(e="#"+e),(n=(o=a(e).first()).data("apex-resize-sensor"))||(n=new c(o[0]),o.data("apex-resize-sensor",n),n.start()),n.addListener(t)},e.offElementResize=function(e,t){var o,n;"string"==typeof e&&(e="#"+e),(n=(o=a(e).first()).data("apex-resize-sensor"))&&(t?(n.removeListener(t),n.isEmpty()&&(n.stop(),o.removeData("apex-resize-sensor"))):(n.destroy(),o.removeData("apex-resize-sensor")))},e.updateResizeSensors=function(e){"string"==typeof e&&(e="#"+e),a(e).find(".js-resize-sensor").parent().each((function(e,t){var o=a(t).data("apex-resize-sensor");null!=o&&o.init(!0)}))};var c=function(e){var o=a.Callbacks(),n=0,i=null,r=null,s=null,l=null,c=null,u=null,h=null;function d(e){var t=!1;if(null!=l.offsetParent){var o=l.offsetWidth,a=l.offsetHeight;r===o&&s===a||(n=2,v(o,a),t=!0,e&&p(!0))}return t}function p(n){var a=e.offsetWidth,r=e.offsetHeight;o.has()&&(n?(null!==i&&t.cancelInvokeAfterPaint(i),i=t.invokeAfterPaint((function(){i=null,o.fire(a,r)}))):o.fire(a,r))}function f(e){e.stopPropagation(),d(!0)||n>0&&null!=l.offsetParent&&(0==l.scrollLeft||0==l.scrollTop)&&(n--,v(r,s))}function m(){p(!1)}function v(e,t){r=e,s=t;var o=l.firstChild.style,n=1;do{o.width=e+n+"px",o.height=t+n+"px",l.scrollLeft=l.scrollTop=n,n++}while((0==l.scrollTop||0==l.scrollLeft)&&n<=5);c.scrollLeft=e,c.scrollTop=t}this.addListener=function(e){o.add(e)},this.removeListener=function(e){o.remove(e)},this.isEmpty=function(){return!o.has()},this.destroy=function(){o.empty(),this.stop()},this.start=function(){function t(e,t){e.direction="ltr",e.position=t.position="absolute",e.left=e.top=e.right=e.bottom="0",e.overflow="hidden",e.zIndex="-1",e.visibility="hidden",t.left=t.top="0",t.transition="0s"}if(h=f.bind(this),e.attachEvent)u=m.bind(this),e.attachEvent("onresize",u);else{var o=e.childNodes[0];(l=document.createElement("div")).className="js-resize-sensor";var n=document.createElement("div");t(l.style,n.style),l.appendChild(n),o?e.insertBefore(l,o):e.appendChild(l),l.addEventListener("scroll",h,!1),c=document.createElement("div");var a=document.createElement("div");t(c.style,a.style),a.style.width="200%",a.style.height="200%",c.appendChild(a),e.insertBefore(c,l),c.addEventListener("scroll",h,!1),this.init(!1)}},this.stop=function(){null!==i&&(t.cancelInvokeAfterPaint(i),i=null),null!==l?(l.removeEventListener("scroll",h),c.removeEventListener("scroll",h),l.parentNode&&e.removeChild(l),c.parentNode&&e.removeChild(c)):e.detachEvent("onresize",u)},this.init=function(e){var t=d(e);e&&!t&&null!=l.offsetParent&&v(r,s)}};e.TouchProxy=function(e){this._init(e)},e.TouchProxy.prototype._init=function(e){this._elem=e,this._touchHandled=!1,this._touchMoved=!1,this._touchStartHandler=a.proxy(this._touchStart,this),this._touchEndHandler=a.proxy(this._touchEnd,this),this._touchMoveHandler=a.proxy(this._touchMove,this),this._elem.on({touchstart:this._touchStartHandler,touchend:this._touchEndHandler,touchmove:this._touchMoveHandler,touchcancel:this._touchEndHandler})},e.TouchProxy.prototype._destroy=function(){this._elem&&this._touchStartHandler&&(this._elem.off({touchstart:this._touchStartHandler,touchmove:this._touchMoveHandler,touchend:this._touchEndHandler,touchcancel:this._touchEndHandler}),this._touchStartHandler=void 0,this._touchEndHandler=void 0,this._touchMoveHandler=void 0)},e.TouchProxy.prototype._touchHandler=function(e,t){if(!(e.originalEvent.touches.length>1)){"touchstart"!=e.type&&"touchend"!=e.type&&e.preventDefault();var o=e.originalEvent.changedTouches[0],n=document.createEvent("MouseEvent");n.initMouseEvent(t,!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),o.target.dispatchEvent(n)}},e.TouchProxy.prototype._touchStart=function(e){this._touchHandled||(this._touchHandled=!0,this._touchMoved=!1,this._touchHandler(e,"mouseover"),this._touchHandler(e,"mousemove"),this._touchHandler(e,"mousedown"))},e.TouchProxy.prototype._touchMove=function(e){this._touchHandled&&(this._touchMoved=!0,this._touchHandler(e,"mousemove"))},e.TouchProxy.prototype._touchEnd=function(e){this._touchHandled&&(this._touchHandler(e,"mouseup"),this._touchHandler(e,"mouseout"),this._touchHandled=!1)},e.TouchProxy._TOUCH_PROXY_KEY="apexTouchProxy",e.TouchProxy.prototype.touchMoved=function(){return this._touchMoved},e.TouchProxy.addTouchListeners=function(t){var o=a(t),n=o.data(e.TouchProxy._TOUCH_PROXY_KEY);return n||(n=new e.TouchProxy(o),o.data(e.TouchProxy._TOUCH_PROXY_KEY,n)),n},e.TouchProxy.removeTouchListeners=function(t){var o=a(t),n=o.data(e.TouchProxy._TOUCH_PROXY_KEY);n&&(n._destroy(),o.removeData(e.TouchProxy._TOUCH_PROXY_KEY))}}(apex.widget.util,apex.util,apex.lang,apex.navigation,apex.jQuery);
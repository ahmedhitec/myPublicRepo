!function(e,t,i,o,r,l,s){"use strict";var d=".u-Form-fieldContainer",n="show",a="hide",c="delete-record",u="next-record",h="previous-record",f="insert-record",p=s.ui.keyCode;var m=[{align:"start",controls:[{type:"MENU",labelKey:"APEX.RV.SETTINGS_MENU",iconOnly:!0,icon:"icon-gear",menu:{items:[{type:"toggle",action:"exclude-null-values"},{type:"toggle",action:"exclude-hidden"}]}}]},{align:"end",controls:[{type:"STATIC",id:"status",label:""},{type:"BUTTON",iconOnly:!0,action:h},{type:"STATIC",id:"recordNumber",label:""},{type:"BUTTON",iconOnly:!0,action:u}]}];function g(e){var t=e.groupName||null;return t&&e.useGroupFor&&e.useGroupFor.indexOf("srv")<0&&(t=null),t}s.widget("apex.recordView",s.apex.tableModelViewBase,{version:"19.1",widgetEventPrefix:"recordview",options:{idPrefix:null,actionsContext:null,recordOffset:0,recordParent:null,showNullAs:"-",fields:null,fieldGroups:null,alwaysEdit:!1,skipDeletedRecords:!1,toolbar:m,showExcludeNullValues:!0,showExcludeHiddenFields:!0,formCssClasses:null,labelAlignment:"end",tabbableFieldContent:"a,button,input",modeChange:null,recordChange:null},_create:function(){var e=this,t=this.options,i=this.element;i.addClass("a-RV"),this._super(),delete this.firstPage,delete this.previousPage,delete this.nextPage,delete this.lastPage,delete this.loadMore,delete this.gotoPage,this.editMode=!1,this.fields=null,this.excludeNullValues=!1,this.excludeHiddenFields=!1,this.lastFocused=null,this.lastField=null,this.toolbar$=null,this.currentRecord=null,this.currentRecordId=null,t.actionsContext?this.actions=t.actionsContext:this.actions=l.createContext("recordView",i[0]),this.actions.remove(["exclude-null-values","exclude-hidden",u,h,f,"refresh-record","revert-record",c,"duplicate-record"]),this.actions.add([{name:"exclude-null-values",labelKey:"APEX.RV.EXCLUDE_NULL",get:function(){return e.excludeNullValues},set:function(o){t.showExcludeNullValues&&(e.excludeNullValues=o,i.toggleClass("a-RV--excludeNull",o))}},{name:"exclude-hidden",labelKey:"APEX.RV.EXCLUDE_HIDDEN",get:function(){return e.excludeHiddenFields},set:function(o){t.showExcludeHiddenFields&&(e.excludeHiddenFields=o,i.toggleClass("a-RV--excludeHidden",o))}},{name:u,labelKey:"APEX.RV.NEXT_RECORD",shortcut:"Alt+Page Down",icon:"icon-next",action:function(){var i,o;if("tree"===e.modelShape){if(!(o=e._nextTreeRecord()))return;t.recordParent=o.parent,t.recordOffset=o.offset}else{if(!((i=e.model.getTotalRecords())<0||t.recordOffset+1<i))return;t.recordOffset+=1}e.direction=1,e.refresh(!1)}},{name:h,labelKey:"APEX.RV.PREV_RECORD",shortcut:"Alt+Page Up",icon:"icon-prev",action:function(){var i;if("tree"===e.modelShape){if(!(i=e._previousTreeRecord()))return;t.recordParent=i.parent,t.recordOffset=i.offset}else{if(!(t.recordOffset>0))return;t.recordOffset-=1}e.direction=-1,e.refresh(!1)}},{name:f,labelKey:"APEX.RV.INSERT",action:function(){if(t.editable)return e.model.insertNewRecord("tree"===e.modelShape?t.recordParent:null,e.getRecord()),e.actions.invoke(u),e.editMode||e.setEditMode(!0),e.focus(),!0}},{name:"refresh-record",labelKey:"APEX.RV.REFRESH",action:function(){e.model.fetchRecords([e.getRecord()])}},{name:"revert-record",labelKey:"APEX.RV.REVERT",action:function(){t.editable&&e.model.revertRecords([e.getRecord()])}},{name:c,labelKey:"APEX.RV.DELETE",action:function(){t.editable&&e.model.deleteRecords([e.getRecord()])}},{name:"duplicate-record",labelKey:"APEX.RV.DUPLICATE",action:function(){if(t.editable){var i=e.getRecord();return e.model.copyRecords([i],null,i),e.actions.invoke(u),e.editMode||e.setEditMode(!0),e.focus(),!0}}}]),this._updateMenuActions(),this._initModel(t.modelName),this._on(this._eventHandlers),this.direction=1,this.refresh(),t.disabled&&this._setOption("disabled",t.disabled)},_eventHandlers:{resize:function(e){e.target===this.element[0]&&(this.resize(),e.stopPropagation())},dblclick:function(e){var t=this.options;s(e.target).closest(d).length&&!t.alwaysEdit&&t.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0))},click:function(e){var t=s(e.target).closest(".u-Form-label");t.length&&t.closest(d).find(":tabbable").first().focus()},keydown:function(e){var t,i,o=this.options,r=e.which;if(r===p.ENTER){if(s(e.target).closest("a,button").length>0)return;s(e.target).closest(d).length&&!o.alwaysEdit&&o.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0))}else if(113===r)s(e.target).closest(d).length&&!o.alwaysEdit&&o.editable&&!this.editMode&&(e.preventDefault(),this.setEditMode(!0));else if(r===p.ESCAPE)!o.alwaysEdit&&o.editable&&this.editMode&&(this.setEditMode(!1),e.stopPropagation());else if(112===r&&e.altKey&&(t=s(e.target).closest(d).find(".js-itemHelp")).length&&(i=t.attr("data-itemhelp")))return apex.theme.popupFieldHelp(i,$v("pInstance")),!1},focusin:function(e){var t,i,o=this;function r(){o.deactivateDelayTimer&&(clearTimeout(o.deactivateDelayTimer),o.deactivateDelayTimer=null)}0!==(i=s(e.target).closest(d)).length?(i.addClass("is-focused"),this.lastFocused=i[0],i[0]!==this.lastField?(this.lastField=i[0],this.editMode&&(r(),(t=this.element.find(".is-active")).length&&this._deactivateField(t),this._activateField(i))):r()):this.lastField=null},focusout:function(e){var t=this,i=s(e.target).closest(d);0!==i.length&&(i.removeClass("is-focused"),this.editMode&&(this.deactivateDelayTimer=setTimeout((function(){t.lastField=null,t._deactivateField(i),t.deactivateDelayTimer=null}),10)))}},_destroy:function(){this.element.removeClass("a-RV is-disabled u-RTL a-RV--excludeHidden a-RV--excludeNull").empty(),this._initModel(null)},_setOption:function(e,t){"editable"===e&&!t&&this.editMode&&this.setEditMode(!1),this._super(e,t),"disabled"===e?(this.element.toggleClass("is-disabled",t),t&&this.resize()):"showExcludeNullValues"===e||"showExcludeHiddenFields"===e?this._updateMenuActions():"recordOffset"===e||"recordParent"===e?this.refresh():"modelName"===e?(this.editMode&&this.setEditMode(!1),this._initModel(t),this.refresh()):"editable"!==e&&"alwaysEdit"!==e&&"toolbar"!==e&&"formCssClasses"!==e&&"labelAlignment"!==e||this._refreshView()},getActions:function(){return this.actions},getToolbar:function(){return this.toolbar$},refresh:function(e){var t,i=this,o=this.options,r=this.element;this._refreshCheckIfVisible()&&((t=r.find(".u-Form-fieldContainer.is-active")).length&&this._deactivateField(t),this.fields||this._initView(),!this.editMode&&o.alwaysEdit&&this.setEditMode(!0),this._updateRecord(null,null,(function(){e&&i.focus()})))},focus:function(){this.lastField=null,this.body$.find(":tabbable").first().focus()},gotoField:function(e,t){var o,r,l,s,d,n=this.options,a=null;if(r=this.model.getRecord(e)){if(e!==this.currentRecordId&&(n.recordOffset=this.model.indexOf(r),this.refresh()),t)if(s=n.fields[0][t]){for(s.hidden&&s.canHide&&this.excludeHiddenFields&&this.actions.set("exclude-hidden",!1),null!==(d=this.model.getValue(r,t))&&""!==d||!this.excludeNullValues||this.actions.set("exclude-null-values",!1),o=0;o<this.fields.length;o++)if(!((l=this.fields[o]).virtual||!l.canHide&&l.hidden)&&l.property===t){a=this.element.find("[data-idx='"+o+"']");break}o>=this.fields.length&&i.warn("Warning field is hidden "+t)}else i.warn("Warning field not found "+t);a?(this.lastField=null,a.find(":tabbable").first().focus()):this.focus()}else i.warn("Warning record not found "+e)},getFields:function(){return this.fields},refreshFields:function(){this.fields=null},fieldElement:function(e){return this.mapFieldToLabelId&&this.mapFieldToLabelId[e]?s("#"+this.mapFieldToLabelId[e]).closest(d):s()},inEditMode:function(){return this.editMode},setEditMode:function(e){var t,o,r=this.element,l=this;this.scrollWrap$&&(this.options.editable?(e=!!e,o=this.editMode,e!==o&&((t=s(this.lastFocused)).length&!e&&l._deactivateField(t),this._updateRecord(e,o,(function(){l.editMode=e,r.toggleClass("a-RV--editMode",e),e&&!t.length&&(l.focus(),t=s(l.lastFocused)),t.length&&(t.find(":tabbable").first().focus(),l.deactivateDelayTimer&&(clearTimeout(l.deactivateDelayTimer),l.deactivateDelayTimer=null),e&&l._activateField(t)),e?l.body$.on("change.rvedit",(function(e){var t,i,o;if(l.activeRecord&&!s(e.target).closest(".u-Form-fieldContainer.is-active").length)for(t=0;t<l.fields.length;t++)if((i=l.fields[t]).elementId===e.target.id){o=i.property,l.setActiveRecordValue(o);break}})):(l._forEachField(!0,(function(e,t){l.columnItems.hasOwnProperty(t.property)&&l._deactivateColumnItem(l.columnItems[t.property])})),l.body$.off("change.rvedit"),l.activeRecord=null,l.activeRecordId=null),l._trigger("modeChange",null,{editMode:e})})))):e&&i.warn("View is not editable."))},getRecord:function(){return this.currentRecord},resize:function(){var e,t=this.element,i=t.height();null!==t[0].offsetParent&&(this.scrollWrap$&&!this.pendingRefresh||(this.refresh(),this.fields))&&this.options.hasSize&&(e=i-(this.toolbar$?this.toolbar$.outerHeight():0),this.scrollWrap$.height(e))},expandGroup:function(e){},collapseGroup:function(e){},_initModel:function(t){var i,o=this.options,r=this;this._super(t,(function(t,l){var s,d,n,a,c,f,p,m;function g(e,s){var d,n;for(d=0;d<e.length;d++)(n=e[d])===r.currentRecordId&&("delete"===t?i&&o.skipDeletedRecords?(r.currentRecord=null,r.currentRecordId=null,r.activeRecord=null,r.activeRecordId=null,r.actions.invoke(u),null===r.currentRecord&&r.actions.invoke(h)):r._updateRecord():"clearChanges"===t&&s?r.actions.invoke(u):"refreshRecords"===t?(n=l.newIds[n]||n,r._updateRecord()):"revert"===t?r._updateRecord():r._updateRecordState())}r.pendingRefresh||("refresh"===t?("tree"===r.modelShape?(r.recordOffset=-1,r.recordParent=null):"table"===r.modelShape&&r.currentRecordId?(p=r.model.getRecord(r.currentRecordId),m=r.model.indexOf(p),o.recordOffset=m>-1?m:0):o.recordOffset=0,r.refresh(!0)):"insert"===t||"copy"===t?r.noData&&r.refresh():"refreshRecords"===t?g(l.recordIds):"clearChanges"===t?(g(l.deletedIds,!0),g(l.changedIds)):l.recordIds?g(l.recordIds):"set"===t?null!==r.ignoreFieldChange&&r.ignoreFieldChange===l.field||(l.oldIdentity&&r._identityChanged(l.oldIdentity,r.model.getRecordId(l.record)),r.model.getRecordId(l.record)===r.currentRecordId&&(s=r.columnItems[l.field],r.editMode&&s?r.ignoreItemChange||r._setColumnItemValue(s.item,l.record,l.field):(a=r.fieldElement(l.field)).length&&(n=r._getFieldMetadata(a),f=null,(c=r.model.getRecordMetadata(r.currentRecordId)).fields&&(f=c.fields[n.property]),d=e.htmlBuilder(),r._renderFieldDataValue(d,n,l.record,c,f),a.find(".a-RV-fieldValue").html(d.toString())),r._updateRecordState())):"metaChange"===t&&(null!==r.ignoreFieldChange&&r.ignoreFieldChange===l.field||l.recordId!==r.currentRecordId||r._updateRecordState()))})),t&&(i=this.model.getOption("onlyMarkForDelete"),this.modelShape=this.model.getOption("shape"),"record"===this.modelShape&&(this.actions.hide(u),this.actions.hide(h),this.actions.hide(f),this.actions.hide("duplicate-record"),this.actions.hide(c)))},_updateMenuActions:function(){var e=this.options;this.actions[e.showExcludeNullValues?n:a]("exclude-null-values"),this.actions[e.showExcludeHiddenFields?n:a]("exclude-hidden")},_updateFields:function(){var e,t,i,o=this.options,r={},l=o.fields[0];for(t in this.fields=[],l)l.hasOwnProperty(t)&&((e=l[t]).property=t,this.fields.push(e),(i=g(e))&&(!r[i]||e.seq<r[i])&&(r[i]=e.seq));this.fields.sort((function(e,t){return g(e)===g(t)?e.seq-t.seq:g(e)?g(t)?(r[g(e)]||0)-(r[g(t)]||0):-1:1}))},_initView:function(){var e=this.options,t=this.editMode;this._updateFields(),this.columnItems||this._initColumnItems(this.fields),this.toolbar$=null,t&&this.setEditMode(!1),this._renderView(),(t||e.alwaysEdit)&&this.setEditMode(!0),e.toolbar&&(this.toolbar$=this.element.children(".a-RV-toolbar").toolbar({idPrefix:this._getIdPrefix()+"tb",actionsContext:this.actions,data:e.toolbar,small:!0}),"record"===this.modelShape&&this.toolbar$.toolbar("hideControl","recordNumber")),this.resize()},_refreshView:function(){this.refreshFields(),this.refresh()},_forEachField:function(e,t){var i,o,r,l,s,d=this.fields;for(e&&(l=this.element.find(".a-RV-fieldValue")),r=0,i=0;i<d.length;i++)(o=d[i]).virtual||!o.canHide&&o.hidden||(s=null,e&&(s=l.eq(r)),t.call(this,i,o,s),r+=1)},_getIdPrefix:function(){return(this.options.idPrefix||this.element[0].id||"rv")+"_"},_renderView:function(){var t,i,r,l=this.options,d=this.element,n=e.htmlBuilder();function a(){n.markup("<div").attr("class","u-Form"+(l.formCssClasses?" "+l.formCssClasses:"")).markup(">"),i=!0}l.toolbar&&n.markup("<div class='a-RV-toolbar'></div>"),this._renderAltDataMessages(n),n.markup("<div class='a-RV-w-scroll'>").markup("<div class='a-RV-body'>"),this.mapFieldToLabelId={},t=null,i=!1,this._forEachField(!1,(function(e,s){var d,c,u,h,f,p,m,v=this._getIdPrefix()+e,R=this.columnItems[s.property];if(this.mapFieldToLabelId[s.property]=v,r=g(s),t!==r){if(r){if(!(c=l.fieldGroups[r]))throw new Error("Unknown field group name: "+r);u=c.label||c.heading}else u=o.getMessage("APEX.RV.NOT_GROUPED_LABEL");i&&n.markup("</div>"),n.markup("<h3 class='u-Form-groupHeading'><button type='button'>").content(u).markup("</button></h3>"),a(),t=r}i||a(),d="u-Form-fieldContainer",s.hidden&&(d+=" a-RV-field--hidden"),s.fieldCssClasses&&(d+=" "+s.fieldCssClasses),s.isRequired&&(d+=" is-required"),h=s.label||s.heading,f=null,s.fieldColSpan&&((f=parseInt(s.fieldColSpan,10))>0&&f<13?n.markup("<div class='apex-col apex-col-"+f+"'>"):f=null),n.markup("<div").optionalAttr("id",s.elementId?s.elementId+"_CONTAINER":null).attr("data-idx",e).attr("class",d).markup("><div").attr("id",v).attr("class","u-Form-labelContainer "+function(e,t){var i="";return"start"===e?i=" u-tS":"end"===e?i=" u-tE":"left"===e?i=" u-tL":"right"===e?i=" u-tR":"center"!==e||t||(i=" u-tC"),i}(l.labelAlignment)).markup(">"),m=null,R&&R.item.setLabel||(m=s.elementId?s.elementId+"_LABEL":null,n.markup("<span").optionalAttr("id",m).attr("class","u-Form-label").markup(">").content(h).markup("</span>")),n.markup("</div><div class='u-Form-inputContainer'><div class='a-RV-fieldValue'></div>"),s.helpid&&(p=o.formatMessage("APEX.ITEM.HELP_TEXT",h),n.markup("<button class='t-Button t-Button--noUI t-Button--helpButton js-itemHelp' tabindex='-1' type='button'").attr("data-itemhelp",s.helpid).attr("aria-label",p).attr("title",p).markup("><span class='a-Icon icon-help' aria-hidden='true'></span></button>")),n.markup("</div></div>"),f&&n.markup("</div>")})),i&&n.markup("</div>"),n.markup("</div></div>"),d.html(n.toString()).find(".u-Form-groupHeading").each((function(){var e=s(this);e.collapsible({heading:".u-Form-groupHeading",controllingElement:"button",universalTheme:!0,collapsed:!1,content:e.next()})})),this.scrollWrap$=d.find(".a-RV-w-scroll"),this.body$=d.find(".a-RV-body"),this.noData$=d.find(".a-GV-noDataMsg")},_updateRecord:function(e,t,i){var o,r=this,l=this.currentRecordId,s=this.options;function d(){var e,t,i,o,l,s;for(o=r.model.getRecordMetadata(r.currentRecordId),e=0;e<r.fields.length;e++)t=r.fields[e].property,(i=r.columnItems[t])&&(s=i.item.isDisabled(),i.element$.is(":visible")&&!s?i.item.getValidity().valid||r.model.setValidity("error",r.currentRecordId,t,i.item.getValidationMessage()):r.model.setValidity("valid",r.currentRecordId,t),o&&((l=o.fields?o.fields[t]:null)&&l.hasOwnProperty("disabled")||s)&&(l||(o.fields||(o.fields={}),l={},o.fields[t]=l),l.disabled=s));r._triggerEndEditing(r.currentRecord,r.currentRecordId),r.activeRecord=null,r.activeRecordId=null}function n(o,n,a){var c,u,h,f=r.body$;if(o){if(c=r.model.getRecordMetadata(a)||{},r.scrollWrap$.show(),r.noData$.hide(),c.agg||c.deleted&&s.skipDeletedRecords)return"tree"===r.modelShape?(u=r[r.direction>0?"_nextTreeRecord":"_previousTreeRecord"]())&&(s.recordParent=u.parent,s.recordOffset=u.offset):(s.recordOffset+=r.direction,h=r.model.getTotalRecords(),s.recordOffset<0?(s.recordOffset=0,r.direction=-r.direction):h>=0&&s.recordOffset>=h&&(s.recordOffset=h-1,r.direction=-r.direction)),r._updateRecord(e,t,i),void r._updateRecord();s.editable&&r.currentRecord&&(e&&!1!==t||!0===t)&&d(),s.recordOffset=n,r.currentRecordId=a,r.currentRecord=null,r.activeRecord=null,r._renderRecordFields(e,o,n,a,c),r.currentRecord=o,e&&(r.activeRecord=o,r.activeRecordId=a),f.children(".t-Alert").remove(),f.find(".t-Form-error").remove(),r._updateRecordState(),r._updateRecordNumber(),s.editable&&e&&r._triggerBeginEditing(r.currentRecord,r.currentRecordId),null!==l&&l===r.currentRecordId||setTimeout((function(){r._trigger("recordChange",null,{recordOffset:s.recordOffset,recordId:r.currentRecordId})}),1)}else s.editable&&r.currentRecord&&(e&&!1!==t||!0===t)&&d(),r.currentRecordId=null,r.currentRecord=null,r._renderRecordFields(e,null,-1,null,{}),r.scrollWrap$.hide(),r.noData$.show(),r._updateActions(),r._updateRecordNumber()}if(null==e&&(e=this.editMode),this.activeLockCount>0)this.activeUnlockCallback=function(){r._updateRecord(e,t,i)};else{switch(this.modelShape){case"record":n(o=this.model.getRecord(),0,o?this.model.getRecordId(o):null);break;case"table":this.model.forEachInPage(s.recordOffset,1,(function(e,t,i){n(e,t,i)}),this);break;case"tree":null===s.recordParent?(o=this.model.root(),s.recordOffset=-1,n(o,s.recordOffset,o?this.model.getRecordId(o):null)):n(o=this.model.child(s.recordParent,s.recordOffset),s.recordOffset,o?this.model.getRecordId(o):null)}i&&i()}},_renderRecordFields:function(t,i,o,r,l){var d=null,n=this.options.tabbableFieldContent,a=!1,c=e.htmlBuilder(),u=this.columnItemsContainer$?this.columnItemsContainer$[0]:null;t&&i&&(a=this.model.allowEdit(i)),this._forEachField(!0,(function(e,t,o){var r,h,f,p,m=null,g=!1;r="u-Form-fieldContainer",i&&(null!==(h=this.model.getValue(i,t.property))&&""!==h||(r+=" a-RV-field--null"),t.hidden&&(r+=" a-RV-field--hidden"),t.fieldCssClasses&&(r+=" "+t.fieldCssClasses),t.isRequired&&(r+=" is-required"),l.fields&&(d=l.fields[t.property]),d&&(d.disabled&&(r+=" is-disabled"),g=d.ck),(g||t.readonly)&&(r+=" is-readonly",g=!0)),(f=this.columnItems[t.property])&&f.item.setLabel||(m=t.elementId+"_LABEL"),a&&f&&!g&&!t.volatile?f.element$.parent()[0]===u&&(o.empty().append(f.element$),this._activateColumnItem(f,m),m||f.item.setLabel(t.label||t.heading)):(f&&f.element$.closest(this.element).length&&(this._deactivateColumnItem(f),m||f.item.setLabel(null)),i?(c.clear(),m||((d=s.extend(!0,{},d)).ck="X"),this._renderFieldDataValue(c,t,i,l,d),m||c.markup("<span class='u-Form-label'>").content(t.label||t.heading).markup("</span>"),o.html(c.toString()),(p=o.find(n)).length&&(o.attr("aria-labelledby",m).attr("role","group"),p.filter("[tabindex]").attr("tabindex",0))):o.empty()),o.parent().parent().attr("class",r)})),a&&i&&(this._beginSetColumnItems(),this._forEachField(!0,(function(e,t,o){var r=this.columnItems[t.property];!r||o.hasClass("is-readonly")||t.volatile||this._setColumnItemValue(r.item,i,t.property,a?l:null)})),this._endSetColumnItems())},_updateRecordState:function(){var e,t,i,r,l,d="",n=this.body$;if(t=this.model.getRecordMetadata(this.currentRecordId)||{},n.removeClass("is-deleted is-inserted is-updated is-error is-warning is-readonly"),t.deleted?(n.addClass("is-deleted"),d=o.getMessage("APEX.GV.ROW_DELETED")):t.inserted?(n.addClass("is-inserted"),d=o.getMessage("APEX.GV.ROW_ADDED")):t.updated&&(n.addClass("is-updated"),d=o.getMessage("APEX.GV.ROW_CHANGED")),this.model.allowEdit(this.currentRecord)||n.addClass("is-readonly"),t.error||t.warning?((i=n.children(".t-Alert")).length||(i=s("<div class='t-Alert'></div>"),n.prepend(i)),i.text(t.message),n.addClass(t.error?"is-error":"is-warning")):n.children(".t-Alert").remove(),t.fields)for(e in t.fields)t.fields.hasOwnProperty(e)&&(r=t.fields[e],(l=this.fieldElement(e)).removeClass("is-changed is-stale is-error is-warning is-readonly"),r.error||r.warning?((i=l.find(".t-Form-error")).length||(i=s("<span class='t-Form-error'></span>"),l.find(".u-Form-inputContainer").append(i)),i.text(r.message),l.addClass(r.error?"is-error":"is-warning")):(l.find(".t-Form-error").remove(),r.changed?l.addClass("is-changed"):r.stale&&l.addClass("is-stale")),r.ck&&l.addClass("is-readonly"));this._updateActions(),this.toolbar$&&this.toolbar$.toolbar("findElement","status").text(d)},_hasPrevious:function(){var e=this.options;switch(this.modelShape){case"record":return!1;case"table":return e.recordOffset>0;case"tree":return null!==this._previousTreeRecord()}},_hasNext:function(){var e,t=this.options;switch(this.modelShape){case"record":return!1;case"table":return(e=this.model.getTotalRecords())<0||t.recordOffset+1<e;case"tree":return null!==this._nextTreeRecord()}},_nextTreeRecord:function(){var e,t,i=this.options,o=i.recordOffset,r=i.recordParent;if(t=null===r?this.model.root():this.model.child(r,o),this.model.childCount(t)>0)return{parent:t,offset:0};for(;r;){if((e=this.model.childCount(r))>0&&o+1<e)return{parent:r,offset:o+1};o=this.model.indexOf(r),r=this.model.parent(r)}return null},_previousTreeRecord:function(){var e=this,t=this.options,i=t.recordOffset,o=t.recordParent;return null===o?null:o&&i>0?function t(i){var o=e.model.childCount(i);return o>0?t(e.model.child(i,o-1)):{parent:e.model.parent(i),offset:e.model.indexOf(i)}}(this.model.child(o,i-1)):{parent:this.model.parent(o),offset:this.model.indexOf(o)}},_updateActions:function(){var e=this.options,t=this.actions,i=this.currentRecord,o=e.editable,r=this.model,l="tree"===this.modelShape?e.recordParent:null,s=o&&r.allowAdd(l,"new"),d=o&&i&&r.allowAdd(l,"copy"),n=o&&i;function a(e,i){t[e?"enable":"disable"](i)}a(n&&r.canRevertRecord(i),"revert-record"),a(n&&r.allowDelete(i),c),a(s,f),a(d,"duplicate-record"),a(i&&this._hasNext(),u),a(i&&this._hasPrevious,h)},_getFieldMetadata:function(e){var t=parseInt(e.attr("data-idx"),10);return isNaN(t)?null:this.fields[t]},_activateField:function(e){var t,i;e.length<=0||null===this.currentRecord||((t=this._getFieldMetadata(e))&&(i=this.columnItems[t.property]),i&&this.model.allowEdit(this.currentRecord)&&!e.hasClass("is-readonly")&&e.addClass("is-active"))},_deactivateField:function(e){var t,i=null;e.length<=0||null===this.currentRecord||((t=this._getFieldMetadata(e))&&(i=this.columnItems[t.property]),i&&!e.hasClass("is-readonly")&&e.hasClass("is-active")&&(this._setModelValue(e,i.item,this.currentRecord,t.property),this._updateRecordState()))},_updateRecordNumber:function(){var e,t,i="",r=this.options;this.toolbar$&&(this.currentRecord&&("tree"===this.modelShape?(t=this.model.parent(this.currentRecord))&&(e=this.model.childCount(t)):e=this.model.getTotalRecords(),i=e>0?o.formatMessage("APEX.RV.REC_XY",r.recordOffset+1,e):o.formatMessage("APEX.RV.REC_X",r.recordOffset+1)),this.toolbar$.toolbar("findElement","recordNumber").text(i))},_identityChanged:function(e,t){e===this.currentRecordId&&(this.currentRecordId=t,this.activeRecordId&&(this.activeRecordId=t))}}),s.apex.recordView.copyDefaultToolbar=function(){var e,t=[];for(e=0;e<m.length;e++)t.push(s.extend(!0,{},m[e]));return t},s.apex.recordView.createModelEditDialog=function(i,r){var d,u,h,m,g,v,R,b,E,C,y,x,_,I,w,V,O,M=s,T=[],F=M("#"+i),P=r.modelOptions.shape||"table",A=r.okLabelKey?o.getMessage(r.okLabelKey):null,D=e.htmlBuilder();function S(e){I&&(v&&I.expand(I.getSelection().first()),O&&clearTimeout(O),O=setTimeout((function(){I[v?"setSelectedNodes":"setSelectedRecords"]([e]),O=null}),1))}r.appendToTop&&(M=e.getTopApex().jQuery),x=M("body").context,F.length||(F=M("<div id='"+i+"'></div>"),M(r.appendTo||"body").append(F)),"tree"===P?u=s.apex.treeView.makeModelNodeAdapter(r.modelName,r.modelOptions,null):("record"===P&&(T=null),u=t.create(r.modelName,r.modelOptions,T,0,!1)),E=u.getOption("shape"),C=u.getOption("fields"),y=u.getOption("editable"),_=y&&u.getOption("sequenceField"),D.markup("<form novalidate><section class='a-IGDialog-region a-IGDialog-body'>"),"record"!==E&&D.markup("<aside class='a-IGDialog-side resize'><div class='nav resize'></div><div class='tb'></div></aside>"),D.markup("<main class='a-IGDialog-main resize'><div class='rv resize'></div></main></section></form>"),(d=s.extend({closeText:o.getMessage("APEX.DIALOG.CLOSE"),noDataMessage:null},r,{autoOpen:!1,modal:!0,create:function(){var e,t,o,d,p=l.createContext("ModelEditDialog",F[0]);if(M(this).closest(".ui-dialog").css("position","fixed"),(g=s("#"+i,x).find(".rv")).recordView({modelName:r.modelName,noDataMessage:r.noDataMessage,idPrefix:r.idPrefix||r.modelName,fields:[C],actionsContext:p,toolbar:null,editable:!0,alwaysEdit:!0,hasSize:!0,skipDeletedRecords:!0,formCssClasses:r.formCssClasses,labelAlignment:r.labelAlignment,recordChange:function(t,i){var o;"nav"!==e&&(o=g.recordView("getRecord"))&&(e="rv",S(o),e=null)}}),"record"!==E&&(R=s("#"+i,x).find(".tb"),p.add([{name:"move-up",labelKey:"APEX.RV.MOVE_UP",hide:!0,action:function(){var e,t=null,i=h.grid("getSelection"),o=h.grid("getSelectedRecords");i[0].prev().length&&((e=i[0].prev().prev()).length&&(t=h.grid("getRecords",[e])[0]),u.moveRecords(o,null,t),h.grid("setSelectedRecords",o))}},{name:"move-down",labelKey:"APEX.RV.MOVE_DOWN",hide:!0,action:function(){var e,t=null,i=h.grid("getSelection"),o=h.grid("getSelectedRecords");(e=i[i.length-1].next()).length&&(t=h.grid("getRecords",[e])[0],u.moveRecords(o,null,t),h.grid("setSelectedRecords",o))}}]),t=[{type:"BUTTON",iconOnly:!0,icon:"icon-plus",action:f},{type:"BUTTON",iconOnly:!0,icon:"icon-copy",action:"duplicate-record"},{type:"BUTTON",iconOnly:!0,icon:"icon-minus",action:c},{type:"BUTTON",iconOnly:!0,icon:"icon-up-chevron",action:"move-up"},{type:"BUTTON",iconOnly:!0,icon:"icon-down-chevron",action:"move-down"}],p[y?n:a](c),p[y?n:a](f),p[y&&r.includeCopy?n:a]("duplicate-record"),p[_?n:a]("move-up"),p[_?n:a]("move-down"),R.toolbar({actionsContext:p,data:[{align:"start",controls:t}]})),"table"===E)if(r.useList){if(m=s("#"+i,x).find(".nav"),!(d=r.recordTemplate)){if(!r.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");d="<li data-id='&APEX$ROW_ID.' class='&APEX$ROW_STATE_CLASSES.'>",r.iconClassColumn&&(d+="<span class='a-IconList-icon'><span class='&"+r.iconClassColumn+".'></span></span>"),r.enabledCheckbox&&(d+="<span class='ro-checkbox &\"enabledClass\".'></span><span class='u-vh'>&\"enabledText\".</span>"),d+="<span class='a-IconList-label'>&"+r.labelColumn+".</span></li>"}m.tableModelView({modelName:r.modelName,columns:[C],hasSize:!0,footer:!1,pagination:{scroll:!0},useIconList:!0,recordTemplate:d,collectionClasses:r.collectionClasses||"a-RVDialog-list",selectionChange:function(){var t,i;"rv"!==e&&(i=m.tableModelView("getSelectedRecords")[0])&&(e="nav",t=u.indexOf(i),g.recordView("option","recordOffset",t),e=null)}}),I=m.data("apex-tableModelView")}else(h=s("#"+i,x).find(".nav")).grid({modelName:r.modelName,noDataMessage:r.noDataMessage,columns:[C],editable:!1,hasSize:!0,footer:!1,pagination:{scroll:!0},reorderColumns:!1,columnSort:!1,hideDeletedRows:!0,selectionChange:function(){var t,i;"rv"!==e&&(i=h.grid("getSelectedRecords")[0])&&(e="nav",t=u.indexOf(i),g.recordView("option","recordOffset",t),e=null)}}),I=h.data("apex-grid");else"tree"===E&&(s("#"+i,x).find(".nav").addClass("a-RVDialog-scroll").html("<div class='a-RVDialog-tree'></div>"),o={showRoot:!0,collapsibleRoot:!0,expandRoot:!0,getNodeAdapter:function(){return u},selectionChange:function(){var t,i,o;"rv"!==e&&(i=v.treeView("getSelectedNodes")[0])&&(o=u.parent(i),e="nav",o!==g.recordView("option","recordParent")&&g.recordView("option","recordParent",o),t=u.indexOf(i),g.recordView("option","recordOffset",t),e=null)}},(v=s("#"+i,x).find(".a-RVDialog-tree")).treeView(o),s.apex.treeView.treeModelListener(r.modelName,v),I=v.data("apex-treeView"));this.initDone=!1},open:function(){var e,t=null;R&&R.toolbar("refresh"),h&&h.grid("refreshColumns"),d.resize(),r.init&&!this.initDone&&r.init.call(this,u,h||m||v||null,g,R),this.initDone=!0,r.load&&(t=r.load.call(this,u)),"record"!==E&&(e=t?u.getRecord(t):g.recordView("getRecord"))&&setTimeout((function(){S(e)}),10),setTimeout((function(){g.recordView("focus")}),100)},close:function(){"table"===E?u.setData([],0):u.setData(null)},resize:function(){var t=F.width(),i=F.height();b?F.find("section").height(i).width(t).resize():(F.find("section,main,aside").height(i),t-=F.find("aside").outerWidth()||0,F.find("main").width(t),g.width(t),g.height(i).recordView("resize"),t=F.find("aside").width(),i-=F.find(".tb").outerHeight(),h?h.width(t).height(i).grid("resize"):v&&v.width(t).height(i),e.setOuterWidth(F.find(".tb"),t))}})).buttons=y?[{text:o.getMessage("APEX.DIALOG.CANCEL"),click:function(){g.recordView("setEditMode",!1),M(this).dialog("close")}},{text:A||o.getMessage("APEX.DIALOG.SAVE"),class:"ui-button--hot",click:function(){var e="",t=!0;g.recordView("setEditMode",!1),r.validate&&"string"==typeof(t=r.validate.call(this,u,(function(e,t){u.setValidity("valid",e,t)}),(function(e,t,i){u.setValidity("error",e,t,i)})))&&(e=t+"\n\n",t=!1),t&&!u.hasErrors()?(r.store&&r.store.call(this,u),M(this).dialog("close")):(g.recordView("refresh"),e+=apex.lang.getMessage("APEX.CORRECT_ERRORS"),apex.message.alert(e,(function(){var e,t=u.getErrors()[0];if(t){for(e in t.fields)if(t.fields[e].error)break;setTimeout((function(){g.recordView("gotoField",u.getRecordId(t.record),e)}),1)}})))}}]:[{text:A||o.getMessage("APEX.DIALOG.OK"),class:"ui-button--hot",click:function(){M(this).dialog("close")}}],d.dialogHelp&&d.buttons.unshift({text:o.getMessage("APEX.DIALOG.HELP"),class:"ui-button-help",click:function(){var e=d.dialogHelp;o.loadMessagesIfNeeded([e.titleKey,e.helpTextKey],(function(){var t={title:e.title,helpText:e.helpText};e.titleKey&&(t.title=o.getMessage(e.titleKey)),e.helpTextKey&&(t.helpText=o.getMessage(e.helpTextKey)),apex.theme.popupFieldHelp(t)}))}}),d.titleKey&&(d.title=o.getMessage(d.titleKey),delete d.titleKey),F.html(D.toString()).dialog(d).on("dialogopen",(function(){apex.navigation.beginFreezeScroll()})).on("dialogresize",(function(){M(this).closest(".ui-dialog").css("position","fixed")})).on("dialogclose",(function(){apex.navigation.endFreezeScroll()})),F.on("keydown",(function(e){var t;e.which===p.ENTER&&"INPUT"===e.target.nodeName&&(r.defaultButton&&(t=F.parent().find(".ui-button--hot").eq(0).focus(),setTimeout((function(){t.click()}),50)),e.preventDefault())})),r.useSplitter&&"record"!==E&&s.apex.splitter&&(w=r.splitterPosition||200,r.persistSplitter&&(V=apex.storage.getScopedSessionStorage({prefix:"ORA_WWV_apex.MED_"+r.persistSplitter,useAppId:!0}),w=parseInt(V.getItem("splitterPosition")||w,10)),b=F.find(".a-IGDialog-body").splitter({position:w,collapsed:!1,minSize:120,orientation:"horizontal",positionedFrom:"begin",noCollapse:!0,change:function(e,t){V&&V.setItem("splitterPosition",t.lastPosition-t.lastPosition%1+"")}}),F.on("resize",(function(t){var i,o,r,l,d=s(t.target);i=d.height(),o=d.width(),(r=d.children(".resize").filter(":visible")).length>0&&(d.children(":not(.resize)").filter(":visible").each((function(){"fixed"!==(l=s(this).css("position"))&&"absolute"!==l&&(i-=s(this).outerHeight(!0))})),i=Math.floor(i/r.length),r.each((function(){var t=s(this);e.setOuterHeight(t,i),e.setOuterWidth(t,o),t.filter(":visible").trigger("resize")}))),t.stopPropagation()})));var k=F.data("ui-dialog"),N=k._destroy;return k._destroy=function(){N.call(k),t.destroy(r.modelName)},F}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.actions,apex.jQuery);
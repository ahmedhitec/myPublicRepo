!function(t,e,i,s,n){"use strict";var o="is-selected",a="aria-multiselectable",r=n.ui.keyCode,l=0;function c(t){return t.parent().children().index(t)}function h(t){var e=t.find("a");return e.length?e[0]:t[0]}function d(t){return n(t).closest(".a-IconList-item")}var u=function(t,e){t._trigger("selectionChange",e)},f=s.debounce(u,1),m=s.debounce(u,350),g={begin:function(){this.text="<ul>\r\n"},item:function(t,e,i){this.text+="<li>"+s.escapeHTML(i)+"</li>\r\n"},end:function(){this.text+="</ul>\r\n"},toString:function(){return this.text}};n.widget("apex.iconList",n.extend(!0,{version:"19.1",widgetEventPrefix:"iconlist",options:{multiple:!1,itemSelector:!1,addItemSelector:!0,label:!0,navigation:!1,tabbableContent:null,noNavKeyContent:null,allowCopy:!0,dataTransferFormats:[{format:"text/plain",writer:Object.create({begin:function(){this.text=""},item:function(t,e,i){e>0&&(this.text+="\r\n"),this.text+=i},end:function(){},toString:function(){return this.text}})},{format:"text/html",writer:Object.create(g)}],selectionChange:null,activate:null},_create:function(){var t,i=this,s=this.options,c=this.element;this.columns=0,this.rows=0,this.searchString="",this.searchTimerId=null,s.navigation&&(s.multiple=!1),c.addClass("a-IconList").attr("role","listbox"),s.multiple&&c.attr(a,"true"),this.forwardKey=r.RIGHT,this.backwardKey=r.LEFT,"rtl"===c.css("direction")&&(c.addClass("u-RTL"),this.forwardKey=r.LEFT,this.backwardKey=r.RIGHT),c.attr("aria-labelledby")?(t=n("#"+c.attr("aria-labelledby").split(" ").join(",#")).last(),this.infoId=t.attr("id")+"_info",t.append("<span id='"+this.infoId+"' class='u-VisuallyHidden'></span>")):(this.infoId=(c.attr("id")||"il"+l++)+"_info",c.before("<span id='"+this.infoId+"' class='u-VisuallyHidden'></span>"),c.attr("aria-labelledby",this.infoId),this.addedLabel=!0),this._initContextMenu("a-IconList-item",(function(t){return!1}),(function(t){var e=d("keydown"===t.type&&i.lastFocused?i.lastFocused:t.target);return!!e.length&&(!!e.hasClass(o)||e)})),this._on(this._eventHandlers),s.allowCopy&&e.addHandler(c[0],(function(t){return i._copy(t),!0})),this.refresh(),s.disabled&&this._setOption("disabled",s.disabled)},_eventHandlers:{resize:function(t){t.target===this.element[0]&&(this._dim(),t.stopPropagation())},click:function(t){var e,i=this.options,s=i.navigation,o=n(t.target);s&&o.closest("a").length>0&&(t.shiftKey||t.ctrlKey)||(e=o.closest(".a-IconList-item")).length&&(i.itemSelector&&o.closest(".u-selector").length&&(t.ctrlKey=!0,t.shiftKey=!1),this._select(e,t,!0,!1),s&&this._activate(t),!s&&i.tabbableContent&&o.closest(i.tabbableContent).length?i.tabbableContent&&o.closest(i.tabbableContent).length&&o.focus():t.preventDefault())},dblclick:function(t){this.options.navigation||d(t.target).length&&this._activate(t)},mousedown:function(t){t.preventDefault()},keydown:function(t){var e,i,s,o=this.element,a=this.options,l=n(t.target),h=null,u=t.which;!a.navigation&&a.noNavKeyContent&&l.closest(a.noNavKeyContent).length||(u===r.HOME?h=o.children().first():u===r.END?h=o.children().last():u===r.DOWN?this.lastFocused&&(e=this._index2RowCol(c(d(this.lastFocused))),i=o.children(),e.row<Math.floor((i.length-1)/this.columns)&&((s=this._rowCol2Index(e.row+1,e.column))>=i.length&&(s=i.length-1),h=i.eq(s))):u===r.UP?this.lastFocused&&(e=this._index2RowCol(c(d(this.lastFocused))),i=o.children(),(s=this._rowCol2Index(e.row-1,e.column))>=0&&(h=i.eq(s)),h&&t.stopPropagation()):u===this.backwardKey?this.lastFocused&&(h=d(this.lastFocused).prev()):u===this.forwardKey?this.lastFocused&&(h=d(this.lastFocused).next()):u===r.SPACE?this.lastFocused&&!this.searchTimerId&&(h=d(this.lastFocused)):u===r.ENTER&&"A"!==t.target.nodeName&&this._activate(t),h&&h[0]&&(this._select(h,t,!0,!0),t.preventDefault()))},keypress:function(t){var e,i,s=this.options,o=this;if(0!==t.which&&s.label&&!t.altKey&&!t.ctrlKey&&(s.navigation||!s.noNavKeyContent||!n(t.target).closest(s.noNavKeyContent).length)){if(e=String.fromCharCode(t.which).toLowerCase(),this.searchTimerId)e!==this.searchString&&(this.searchString+=e),clearTimeout(this.searchTimerId),this.searchTimerId=null;else{if(" "===e)return;this.searchString=e}this.searchTimerId=setTimeout((function(){o.searchTimerId=null}),500),(i=this._findItem(this.searchString))&&this._select(i,t,!0,!0)}},focusin:function(t){var e=d(t.target);0!==e.length&&(e.addClass("is-focused"),this._setFocusable(t.target))},focusout:function(t){d(t.target).removeClass("is-focused")}},_destroy:function(){var t=this.element,i=this.options;t.removeClass("a-IconList is-disabled u-RTL").removeAttr("role").removeAttr(a).children().removeClass("a-IconList-item").removeAttr("role").removeAttr("aria-selected").removeAttr("tabindex"),t.find("a").removeAttr("tabindex").removeAttr("role"),i.itemSelector&&i.addItemSelector&&t.find(".u-selector").remove(),e.removeHandler(t[0]),this._destroyContextMenu(),n("#"+this.infoId).remove(),this.addedLabel&&t.removeAttr("aria-labelledby")},_setOption:function(t,e){var i,s,n=this.options,o=this.element;if(this._checkContextMenuOptions(t,e),"multiple"===t)n.navigation&&(e=!1);else if("allowCopy"===t||"addItemSelector"===t||"navigation"===t)throw new Error("IconList "+t+" option cannot be set");this._super(t,e),"disabled"===t?(o.toggleClass("is-disabled ui-state-disabled",e).attr("aria-disabled",e),this.lastFocused&&(e?this.lastFocused&&((i=!n.navigation&&n.tabbableContent)?(s=d(this.lastFocused)).add(s.find(i).not(":disabled")).prop("tabIndex",-1):this.lastFocused.tabIndex=-1):this._setFocusable(this.lastFocused)),e&&this._dim()):"multiple"===t?e?o.attr(a,"true"):o.removeAttr(a):"itemSelector"===t&&this.refresh()},refresh:function(){var t,e,i,s=this.options,o=this.element;s.multiple&&!s.itemSelector&&apex.userHasTouched()&&(s.itemSelector=!0,s.addItemSelector=!0),o.find("a").attr("tabindex",-1).attr("role","option"),o.find(s.tabbableContent).attr("tabindex",-1),(i=o.children()).addClass("a-IconList-item").filter((function(){return 0===n(this).find("a").length})).attr("role","option").attr("tabindex",-1),s.addItemSelector&&(s.itemSelector?(e=n("<span class='"+(s.multiple?"u-selector":"u-selector u-selector--single")+"'></span>"),i.filter((function(){return n(this).find(".u-selector").length<=0})).prepend(e)):o.find(".u-selector").remove()),this._dim(),(t=o.find(".is-selected.a-IconList-item")).length>0?this.setSelection(t,!1):(this.lastFocused&&n(this.lastFocused).is(":visible")||(this.lastFocused=h(o.children().first())),this.selectAnchor=this.lastFocused,this.lastFocused&&!s.disabled&&this._setFocusable(this.lastFocused))},resize:function(){this._dim()},focus:function(){this.lastFocused&&this.lastFocused.focus()},getColumns:function(){return this.columns},getRows:function(){return this.rows},getSelection:function(){return this.element.find(".is-selected.a-IconList-item")},getSelectionValues:function(){var t=[];return this.getSelection().each((function(){t.push(n(this).attr("data-value"))})),t},setSelection:function(t,e,i){e=!!e,this._select(t,null,e,!1,i)},_copy:function(t){var e,i,s=this.getSelection(),n=this.options.dataTransferFormats;if(s.length){for(n.forEach((function(t){t.writer.begin(s)})),e=0;e<s.length;e++)i=s.eq(e),n.forEach((function(t){t.writer.item(i,e,i.text())}));n.forEach((function(e){e.writer.end(),t.setData(e.format,e.writer.toString())}))}},_rowCol2Index:function(t,e){return t*this.columns+e},_index2RowCol:function(t){var e=Math.floor(t/this.columns);return{row:Math.floor(t/this.columns),column:t-e*this.columns}},_dim:function(){var t,e,s,o=this,a=this.element,r=a.width(),l=a.children(),c=l.length;c&&(t=l.first().position().top,s=l.first().outerWidth()),this.columns=c,l.each((function(e){var i=n(this).position().top;if(i>t)return t=i,o.columns=e,!1})),this.rows=c>0?Math.floor((c+this.columns-1)/this.columns):0,1===this.rows&&(this.columns=Math.floor(r/s)),e=1===this.columns?i.formatMessage("APEX.ICON_LIST.LIST_DIM",this.rows):i.formatMessage("APEX.ICON_LIST.GRID_DIM",this.columns,this.rows),n("#"+this.infoId).text(e)},_findItem:function(t){var e,i,s=this.element,n=t.length,o=this.options.label;for(e=i=d(this.lastFocused),1===n&&(e=e.next()),0===e.length&&(e=s.children().first());e.length>0;){if((!0===o?e.text().trim():e.find(o).text()).substring(0,n).toLowerCase()===t)return e;if(0===(e=e.next()).length&&(e=s.children().first()),e[0]===i[0])break}return null},_setFocusable:function(t){var e,i=this.options,s=!i.navigation&&i.tabbableContent;this.lastFocused&&this.lastFocused!==t&&(s?(e=d(this.lastFocused)).add(e.find(s).not(":disabled")).prop("tabIndex",-1):this.lastFocused.tabIndex=-1),s?(e=d(t)).find(s).not("disabled").prop("tabIndex",0).length||e.prop("tabIndex",0):t.tabIndex=0,this.lastFocused=t},_activate:function(t){var e,i;this._trigger("activate",t,{values:this.getSelectionValues()}),this.options.navigation&&!t.isDefaultPrevented()&&(i=(e=this.getSelection()).attr("href")||e.find("a").attr("href"))&&(t.preventDefault(),apex.navigation.redirect(i))},_select:function(t,e,i,a,r){var l,d,u,g,p,b,v,C,x,I="set",y=this.element,_=this.options,w=y.find(".is-selected.a-IconList-item");t=t.filter(":visible"),e&&_.multiple&&("click"===e.type?e.ctrlKey||e.metaKey?I="toggle":e.shiftKey&&(I="range"):"keydown"===e.type&&(e.keyCode===n.ui.keyCode.SPACE?I=e.ctrlKey?"toggle":e.shiftKey?"range":"add":e.ctrlKey?I="none":e.shiftKey&&(I="range"))),"range"!==I||this.selectAnchor||(I="set"),"set"!==I&&"range"!==I||w.removeClass(o).removeAttr("aria-selected").find(".u-selector").removeClass(o),l=t.hasClass(o),"set"===I||"add"===I||"toggle"===I&&!l?(t.addClass(o).attr("aria-selected",!0).find(".u-selector").addClass(o),this.selectAnchor=t[0]):"range"===I?(y.children().removeClass(o).removeAttr("aria-selected").find(".u-selector").removeClass(o),b=c(n(this.selectAnchor)),v=c(t.last()),b>v&&(C=v,v=b,b=C),y.children().filter((function(t){return t>=b&&t<=v})).addClass(o).attr("aria-selected",!0).find(".u-selector").addClass(o)):"toggle"===I&&l&&(t.removeClass(o).removeAttr("aria-selected").find(".u-selector").removeClass(o),this.selectAnchor=t[0]),t.length>0&&(x=h(t.first()),i?(x.tabIndex=0,x.focus()):this._setFocusable(x),(g=(u=y.scrollParent())[0]===document?{left:0,top:0}:u.offset())&&(p=y.offset(),((d=t.first().offset()).top<g.top||d.top>g.top+u[0].offsetHeight)&&(u[0].scrollTop=d.top-p.top),(d.left+t[0].offsetWidth<g.left||d.left>g.left+u[0].offsetWidth)&&(u[0].scrollLeft=d.left-p.left))),r||_.navigation&&e&&"click"===e.type||("toggle"===I||"range"===I&&!l||"add"===I&&!l||"set"===I&&!s.arrayEqual(w,t))&&(a?m(this,e):f(this,e))}},apex.widget.contextMenuMixin))}(apex.debug,apex.clipboard,apex.lang,apex.util,apex.jQuery);
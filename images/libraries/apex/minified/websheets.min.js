function ws_Spreadsheet(e,t){function a(e){return apex.lang.getMessage(e)}var i,n=this,r=t,o=$("#pFlowStepId").val(),l="2"===o||"3000"===o,c="2"===o,s="20"===o;r&&r.regionId&&(i=$("#"+r.regionId,apex.gPageContext$)),this.spreadsheet_id=e||!1,this.currentRow=!1,this.classArray=!1,this.currentCell=!1,this.currentForm=!1,this.currentCol=!1,this.currentColType=!1,this.spinner$;var _={BUTTON:{CANCEL:a("CANCEL"),DELETE:a("DELETE"),APPLY:a("APPLY"),COPY:a("COPY")},DIALOG_TITLE:{PROPERTIES:a("DATA_GRID_PROPERTIES"),ADD_COLUMN:a("ADD_COLUMN"),COLUMN_PROPERTIES:a("COLUMN_PROPERTIES"),LOV:a("LIST_OF_VALUES"),COLUMN_GROUPS:a("COLUMN_GROUPS"),VALIDATION:a("VALIDATION"),DELETE_COLUMNS:a("DELETE_COLUMNS"),SET_COLUMN_VALUES:a("SET_COLUMN_VALUES"),REPLACE:a("REPLACE"),FILL:a("FILL"),DELETE_ROWS:a("DELETE_ROWS"),COPY_DATA_GRID:a("COPY_DATA_GRID"),DELETE_DATA_GRID:a("DELETE_DATA_GRID"),ADD_FILE:a("ADD_FILE"),ADD_NOTE:a("ADD_NOTE"),ADD_LINK:a("ADD_LINK"),ADD_TAGS:a("ADD_TAGS")}};function E(e){1==e?$x_Show("apexir_LOADER"):($x_Hide("apexir_LOADER"),reInitWS())}function u(){$("div.edit:not(div.readonly)",$("#"+n.spreadsheet_id)[0]).unbind("click").click((function(e){O(this,e)}))}function d(){$("#a-IRR-dialog-js",apex.gPageContext$).dialog("isOpen")&&$("#a-IRR-dialog-js",apex.gPageContext$).dialog("close")}function T(e,t){var a;if(n.currentValue!=t.value||$(t).hasClass("apex-tabular-form-error")){n.currentValue=$v(t);var i=new htmldb_Get(null,$v("pFlowId"),"APPLICATION_PROCESS=CELL",o);i.AddNameValue("ACTION","SAVE"),i.AddNameValue("ROW",n.currentRow.id.substring(3)),i.AddNameValue("COLUMN",n.currentCol),i.AddNameValue("VALUE",t.value),i.AddNameValue("CHANGE",$(n.currentRow).attr("apex:c"));var r=i.get();if("true"!=r)(a=$(t)).addClass("apex-tabular-form-error"),$("#ajaxMESSAGE").show(),$("#theMESSAGE").html(r),t.focus(),"date"===n.currentColType&&a.datepicker("show");else(a=$(n.currentRow)).attr("apex:c",parseInt(a.attr("apex:c"))+1),$(t).removeClass("apex-tabular-form-error"),$("#ajaxMESSAGE").hide(),I();i=null}else I()}function L(e,t){s?"true"==e.responseText?($x_Remove("actionsMenu"),n.row($v("apexir_current_row"),t)):($s("apexir_DIALOG_MESSAGE",e.responseText),$x_Show("apexir_DIALOG_MESSAGE")):"true"==e.responseText?"delete_websheet"==t?document.location="f?p="+$v("pFlowId")+":902:"+$v("pInstance")+"::NO:::":"save_checked"==t||("toggle_checkboxes"!=t&&d(),i.trigger("apexrefresh")):($s("apexir_DIALOG_MESSAGE",e.responseText),$x_Show("apexir_DIALOG_MESSAGE"))}function A(e,t){switch(t&&e.ajax.addParam("p_widget_action",t),t){case"set_geocode":e.ajax.addParam("x01",$v("apexir_SHUTTLE_RIGHT"));break;case"reset_geocode":break;default:"delete_rows"!=t&&"set_column_value"!=t&&"replace_column_value"!=t||e.ajax.addParam("x01",$u_ArrayToString(function(){for(var e=[],t=$x_FormItems(n.spreadsheet_id,"CHECKBOX"),a=0,i=t.length;a<i;a++)t[a].checked&&t[a].id&&(e[e.length]=t[a].value);return e}(),":")),"column_groups_save"==t&&$("#apexir_SHUTTLE_RIGHT option").prop("selected",!0),s&&e.ajax.addParam("x03","DETAIL"),e.ajax.AddArrayItems2($x_FormItems("a-IRR-dialog-js"),1)}e._get()}function O(e,t){var a,i,r,o,l,c;I(),n.currentRow=e.parentNode.parentNode,n.currentCell=e,n.classArray=e.className.split(" "),n.currentCol=n.classArray[0],n.currentColTest=!isNaN(n.currentCol.substring(1)),n.currentColType=n.classArray[1],n.currentColMaxLength=n.classArray[3],a=$(e).unbind("click"),"text"==n.currentColType&&n.currentColTest?(i=$(e.parentNode).outerWidth(),r=a.text(),a.html("").css("padding","0"),(o=$($dom_AddInput(e,"TEXT","","",r))).css("width",i).attr("maxlength",n.currentColMaxLength).blur((function(e){T(0,this)})).keypress((function(e){if(13==e.which)return!1})).focus(),n.currentForm=o[0],n.currentValue=r):"textarea"==n.currentColType&&n.currentColTest?(r=a.html(),a.html("").css("padding","0"),(l=$($dom_AddTag(e,"TEXTAREA"))).css("width","100%").val(r).attr("maxlength",n.currentColMaxLength).blur((function(e){T(0,this)})).focus(),n.currentForm=l[0],n.currentValue=r):"date"==n.currentColType&&n.currentColTest?(i=$(e.parentNode).outerWidth(),r=a.text(),a.html("").css("padding","0"),(o=$($dom_AddInput(e,"TEXT","theCal","",r))).css("width",i),n.currentForm=o[0],n.currentValue=r,c=new apex.ajax.ondemand("get_dtFmt",(function(){var e=p.readyState;if(1==e);else if(2==e);else if(3==e);else{if(4!=e)return!1;var t=apex.jQuery.parseJSON(p.responseText);apex.widget.datepicker("#theCal",{buttonText:"Calendar",showTime:t.showTime,time24h:t.time24h,timeFormat:t.timeFormat,defHour:t.defHour,defMinute:t.defMinute,defAmpm:t.defAmpm,defaultDate:apex.util.getDateFromISO8601String(t.defaultDate),showOn:"focus",showAnim:"drop",showOtherMonths:!1,changeMonth:!1,changeYear:!1,onClose:function(e,t){T(0,this)}},t.dtFmt,t.lang),o.focus(),E(e)}})),E(1),c.ajax.AddNameValue("COLUMN",n.currentCol),c.ajax.AddNameValue("DATE",r),c._get()):"selectlist"==n.currentColType&&n.currentColTest?(r=a.text(),$s(n.currentCell,""),apex.server.process("GET_LOV_JSON",{x01:n.spreadsheet_id,x02:n.currentCol},{dataType:"html",success:function(e){var t=new $d_LOV_from_JSON;t.l_Type="SELECT",t.create(a.parent()[0],e),$s(t.l_Dom,r),t.l_Dom.focus(),t.l_Dom.id="removeMe",$(t.l_Dom).one("blur",(function(e){T(0,this)}))}}),n.currentValue=r):I()}function I(){$("#removeMe").remove(),$(n.currentCell).text(n.currentValue).css("padding","").unbind("click").one("click",(function(){O(this)})),n.currentRow=!1,n.currentCell=!1,n.currentForm=!1,n.currentCol=!1}this.closeUpload=function(){$("#P20_X").attr("name","P20_X"),$x_Remove("actionsMenu"),$("#wwvFlowForm").removeAttr("target"),n.row($v("apexir_current_row"))},this.actions=function(e,t){var a;if(s)if("ATTACHMENT_SAVE"==e){""===$("#apexir_FILE_BUTTON").val()&&$("#P20_X").removeAttr("name"),$s("P20_DESC",$v("apexir_DESCRIPTION")),$x("apexir_DIALOG_MESSAGE").innerHTML='<iframe name="myNewWin" id="myNewWin" height="100" width="20" style="display:none;"></iframe>',n.spinner$=apex.util.showSpinner($("#a-IRR-dialog-js")),$x("wwvFlowForm").target="myNewWin";window.setTimeout((function(){apex.submit("ATTACHMENT")}),500)}else a=new apex.ajax.ondemand("websheet_detail",(function(){var t=p.readyState;if(1==t);else if(2==t);else if(3==t);else{if(4!=t)return!1;L(p,e),E(t)}})),E(1),t&&a.ajax.addParam("p_widget_action_mod",t),A(a,e);else a=new apex.ajax.ondemand("websheet",(function(){var t=p.readyState;if(1==t);else if(2==t);else if(3==t);else{if(4!=t)return!1;L(p,e),E(t)}})),E(1),A(a,e)},this.dialog=function(e,t,a){var i=new apex.ajax.ondemand("DIALOG",(function(){var t=p.readyState;if(1==t);else if(2==t);else if(3==t);else{if(4!=t)return!1;var a=p.responseText;if("LOV_TEXT"==e)$s("apexir_LOV_ENTRIES",a);else{$("#apex_popup_field_help").dialog("isOpen")&&$("#apex_popup_field_help").dialog("close"),$("#a-IRR-dialog-js",apex.gPageContext$).html(a),function(e){var t,a,i=[{text:_.BUTTON.CANCEL,click:function(){t.dialog("close")}}];function r(e,a,r,o){var l,c;l=a||_.BUTTON.APPLY,r&&(c="ui-button--hot"),i.push({text:l,class:c,click:function(){n.actions(e),o&&t.dialog("close")}})}"WEBSHEET"===e?(a=_.DIALOG_TITLE.PROPERTIES,r("websheet_properties_save",null,!0,!1)):"ADD_COLUMN"===e?(a=_.DIALOG_TITLE.ADD_COLUMN,r("column_add",null,!0,!1)):"COLUMN_PROPERTIES"===e?(a=_.DIALOG_TITLE.COLUMN_PROPERTIES,r("column_properties_save",null,!0,!1)):"LOV"===e?(a=_.DIALOG_TITLE.LOV,apex.item("apexir_LOV_ID").getValue()&&r("lov_delete",_.BUTTON.DELETE,!1,!1),r("lov_save",null,!0,!1)):"GROUP"===e||"GROUP2"===e?(a=_.DIALOG_TITLE.COLUMN_GROUPS,apex.item("apexir_GROUP_ID").getValue()&&r("column_groups_delete",_.BUTTON.DELETE,!1,!1),r("column_groups_save",null,!0,!1)):"VALIDATION"===e?(a=_.DIALOG_TITLE.VALIDATION,apex.item("apexir_VALIDATION_ID").getValue()&&r("VALIDATION_DELETE",_.BUTTON.DELETE,!1,!1),r("VALIDATION_SAVE",null,!0,!1)):"REMOVE_COLUMN"===e?(a=_.DIALOG_TITLE.DELETE_COLUMNS,r("column_remove",_.BUTTON.DELETE,!0,!1)):"SET_COLUMN_VALUE"===e?(a=_.DIALOG_TITLE.SET_COLUMN_VALUES,r("set_column_value",null,!0,!1)):"REPLACE"===e?(a=_.DIALOG_TITLE.REPLACE,r("replace_column_value",null,!0,!1)):"FILL"===e?(a=_.DIALOG_TITLE.FILL,r("fill_column_value",null,!0,!1)):"DELETE_ROWS"===e?(a=_.DIALOG_TITLE.DELETE_ROWS,r("delete_rows",_.BUTTON.DELETE,!0,!1)):"COPY"===e?(a=_.DIALOG_TITLE.COPY_DATA_GRID,r("copy",_.BUTTON.COPY,!0,!1)):"DELETE"===e?(a=_.DIALOG_TITLE.DELETE_DATA_GRID,r("delete_websheet",_.BUTTON.DELETE,!0,!1)):"ATTACHMENT"===e?(a=_.DIALOG_TITLE.ADD_FILE,r("ATTACHMENT_SAVE",null,!0,!0)):"NOTE"===e?(a=_.DIALOG_TITLE.ADD_NOTE,r("NOTE_SAVE",null,!0,!1)):"LINK"===e?(a=_.DIALOG_TITLE.ADD_LINK,r("LINK_SAVE",null,!0,!1)):"TAGS"===e&&(a=_.DIALOG_TITLE.ADD_TAGS,r("TAG_SAVE",null,!0,!1));t=$("#a-IRR-dialog-js",apex.gPageContext$).dialog({modal:!0,dialogClass:"a-IRR-dialog",width:"auto",height:"auto",minWidth:"360",title:a,buttons:i,close:function(){t.dialog("destroy")}})}(e),$x("apexir_SHUTTLE_LEFT")&&(window.g_Shuttlep_v01=new dhtml_ShuttleObject("apexir_SHUTTLE_LEFT","apexir_SHUTTLE_RIGHT")),"NOTIFY"==e&&$("#apexir_NOTIFY_INTERVAL").change((function(){$f_Hide_On_Value_Item(this,"apexir_DATEPICKERS","I")})).change();var i=$(":input:visible",$("#a-IRR-dialog-js",apex.gPageContext$));i.length>0&&i[0].focus()}E(t)}}));E(1),i.ajax.AddNameValue("DIALOG",e),i.ajax.AddNameValue("VALUE",t),i.ajax.AddNameValue("VALUE2",a),s&&i.ajax.AddNameValue("MODE","DETAIL"),i._get()},this.collectCheckedRows=function(e){$f_CheckFirstColumn(e),n.actions("save_checked")},this.selectTest=function(e){switch($v(e)){case"NEW":$x_Show("apexir_LOV_ATTRIBUTES");break;case"":case"NEW_CURRENT_VALUES":$x_Hide("apexir_LOV_ATTRIBUTES");break;default:n.dialog("LOV_TEXT",$v(e)),$s("apexir_LOV_NAME",$f_SelectedOptions(e).text),$x_Show("apexir_LOV_ATTRIBUTES")}},this.row=function(e,t){var a,i,n,r,l,c,s=[];for(E(1),(l=new htmldb_Get(null,$v("pFlowId"),"APPLICATION_PROCESS=ITEM_ROW",o)).add("GOTO_WORKSHEET_ROW",e,50),void 0!==t?l.addParam("x01",t):l.addParam("x01",""),a=$("#row")[0],i=$("input:text,input:hidden,textarea,select",a),n=$(":radio:checked",a),r=$(i).add(n),c=0;c<r.length;c++)s[0]=$(r)[c],l.AddArrayItems(s,parseInt($(s[0]).attr("name").substr(1),10));l.GetAsync((function(e){var t,a,i,n=e.readyState;if(1==n);else if(2==n);else if(3==n);else{if(4!=n)return!1;a="error"===(t=e.responseText).substr(0,5),$x_Remove("MESSAGE"),a?(i=t.substr(6),$("#ajaxMESSAGE").show(),$("#theMESSAGE").html(i)):($("#ajaxMESSAGE").hide(),$("#drop").html(t)),E(n)}})),d(),l=null},c&&(u(),i.on("apexafterrefresh.datagrid",(function(){u()}))),s&&($(document).on("click","#apexir_FILE_BUTTON, #apexir_FILE_LABEL",(function(e){$("#P20_X").trigger("click"),e.preventDefault()})),$("#P20_X").on("change",(function(e){var t;e.target.files.length>0?(t=e.target.files[0].name,$("#apexir_FILE_BUTTON").val("1"),$("#apexir_FILE_SELECTED").text(t)):($("#apexir_FILE_BUTTON").val(""),$("#apexir_FILE_SELECTED").text(a("WS_NO_FILE_CHOSEN")))}))),l&&function(){var e={items:[{type:"action",label:a("PROPERTIES"),hide:!0,icon:"icon-irr-ws-properties",action:function(){n.dialog("WEBSHEET")}},{type:"action",label:a("TOGGLE_CHECKBOXES"),hide:!0,icon:"icon-irr-ws-toggle-checkboxes",action:function(){n.actions("toggle_checkboxes")}},{type:"separator"},{type:"subMenu",label:a("COLUMNS"),hide:!0,icon:"icon-irr-ws-col",menu:{items:[{type:"action",label:a("ADD"),icon:"icon-irr-ws-col-add",action:function(){n.dialog("ADD_COLUMN")}},{type:"action",label:a("COLUMN_PROPERTIES"),icon:"icon-irr-ws-col-pros",action:function(){n.dialog("COLUMN_PROPERTIES")}},{type:"action",label:a("LIST_OF_VALUES"),icon:"icon-irr-ws-lov",action:function(){n.dialog("LOV")}},{type:"action",label:a("COLUMN_GROUPS"),icon:"icon-irr-ws-col-groups",action:function(){n.dialog("GROUP")}},{type:"action",label:a("VALIDATION"),icon:"icon-irr-ws-validation",action:function(){n.dialog("VALIDATION")}},{type:"action",label:a("DELETE_COLUMNS"),icon:"icon-irr-ws-col-delete",action:function(){n.dialog("REMOVE_COLUMN")}}]}},{type:"subMenu",label:a("ROWS"),hide:!0,icon:"icon-irr-ws-row",menu:{items:[{type:"action",label:a("ADD_ROW"),icon:"icon-irr-ws-col-add",action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"20",debug:"NO",clearCache:"20",itemNames:["WS_APP_ID","P20_IR_ID","P20_DATA_GRID_ID","CURRENT_WORKSHEET_ROW"],itemValues:[r.wsAppId,n.spreadsheet_id,r.dataGridId,""]}))}},{type:"action",label:a("SET_COLUMN_VALUES"),icon:"icon-irr-ws-col-values",action:function(){n.dialog("SET_COLUMN_VALUE")}},{type:"action",label:a("REPLACE"),icon:"icon-irr-ws-row-replace",action:function(){n.dialog("REPLACE")}},{type:"action",label:a("FILL"),icon:"icon-irr-ws-row-fill",action:function(){n.dialog("FILL")}},{type:"action",label:a("DELETE_ROWS"),icon:"icon-irr-ws-row-delete",action:function(){n.dialog("DELETE_ROWS")}}]}},{type:"action",label:a("DELETE_DATA_GRID"),hide:!0,icon:"icon-irr-ws-dg-delete",action:function(){n.dialog("DELETE")}},{type:"separator"},{type:"action",label:a("COPY"),hide:!0,icon:"icon-irr-ws-copy",action:function(){n.dialog("COPY")}},{type:"action",label:a("HISTORY"),icon:"icon-irr-ws-history",action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"14",debug:"NO"}))}}],beforeOpen:function(e,t){var a,i=t.menu.items;for(a=0;a<8;a++)i[a].hide=!r.currentUserIsNotReader}};r.websheetManageDatagridMenu&&$("#apexir_WEBSHEETMENU").menu(e);var t={items:[{type:"action",label:a("EDIT_ATTRIBUTES"),action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"3010",debug:"NO",clearCache:"3010",itemNames:["p3010_worksheet_id","p3030_worksheet_id"],itemValues:[n.spreadsheet_id,n.spreadsheet_id]}))}},{type:"action",label:a("EDIT_QUERY"),action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"3030",debug:"NO",clearCache:"3030",itemNames:["p3010_worksheet_id","p3030_worksheet_id"],itemValues:[n.spreadsheet_id,n.spreadsheet_id]}))}}]};r.websheetManageReportMenu&&r.currentUserIsNotReader&&$("#apexir_WEBSHEETMENU").menu(t)}()}
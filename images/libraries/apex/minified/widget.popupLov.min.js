!function(e,t,a,i){"use strict";var l=i.ui.keyCode;e.popupLov=function(n){var r,s,o,u,p,d,c,f,v,m,h,g=l.RIGHT,x=l.LEFT,b=!1,V=!1,y=!1,C="",S=n.itemId,T=i("#"+a.escapeCSS(S)+"_lov_btn",apex.gPageContext$),D=T.parent(),E=i("#"+a.escapeCSS(S),apex.gPageContext$),P=i("#"+a.escapeCSS(S)+"_HIDDENVALUE",apex.gPageContext$),w=i().add(T).add(E).add(P),I=i().add(T).add(E);function O(t){var a,i=!1,l=E.val();n.enterable&&l!==C?a=l:t?(a=t,i=!0):a=null,C=l,E.attr("aria-expanded","true"),V=!0,e.util.openPopupLov(b,a,i,n,(function(e){e&&(C=e.d||e.v||e,n.multiple&&E.val("")),E.attr("aria-expanded","false"),V=!1})),b=!1}function A(e,t){var i=t||e;return"<li class='apex-item-multi-item' data-value='"+a.escapeHTMLAttr(e)+"'><span>"+a.escapeHTML(i)+"<button class='apex-item-multi-remove' type='button' tabindex='-1' aria-label='"+apex.lang.formatMessage("APEX.POPUP_LOV.REMOVE_VALUE",i)+"'><span class='a-Icon icon-multi-remove'></span></button></span></li>"}function L(){var e,t;(e=E.data("popupLovModelName"))&&(t=apex.model.get(e))&&(t.setData([]),apex.model.release(e)),b=!0}function j(){r.refresh()}(n=i.extend({dependingOnSelector:null,pageItemsToSubmit:null,height:n.isPopup?280:380,width:null,isPopup:!1,display:"list",nullValue:"",dynamicDefault:!1,initialFetch:"empty",multiple:!1,separator:":",enterable:!1,incrementalSearch:!1,minSearchChars:0,displayColumn:null,iconColumn:null,extraOut:{},persistState:!0},n)).width||n.isPopup||(n.width="grid"===n.display?500:300),void 0===n.nullDisplayValue&&(n.nullDisplayValue=n.nullValue),n.hasDisplayValue=!n.enterable&&n.displayColumn,E.attr("role","combobox").attr("aria-autocomplete","list").attr("aria-expanded","false").attr("aria-haspopup","dialog"),n.multiple&&(f=E.attr("placeholder"),"rtl"===(o=E.parent().parent()).css("direction")&&(g=l.LEFT,x=l.RIGHT),(p=o.parent()).css("position","relative"),E.css("flex-grow",0),d=function(){var e=p.width()-T.outerWidth(!0);o.css("max-width",e),u=e-parseInt(o.css("border-left-width"),10)-parseInt(o.css("border-right-width"),10)-parseInt(o.css("padding-left"),10)-parseInt(o.css("padding-right"),10)},e.util.onElementResize(p[0],(function(){d(),r.afterModify()})),e.util.onVisibilityChange(p[0],(function(t){t&&e.util.updateResizeSensors(p[0])})),d(),m=[],h=[],o.children().not(":last").each((function(){var e=i(this);m.push(e.attr("data-value")),h.push(e.text())})).remove(),o.click((function(e){var t=!1,a=i(e.target),l=a.closest(".apex-item-multi-remove"),n=a.closest(".apex-item-multi-item");r.isDisabled()||(l[0]?(r.removeValue(n.attr("data-value")),t=!0):n.find("input")[0]||(o.children(".is-active").removeClass("is-active"),n.addClass("is-active"),t=!0),t&&setTimeout((function(){E.focus()}),1))})).keydown((function(e){var t=e.which,a=o.children(".is-active");r.isDisabled()||(""===E.val()?t===l.DELETE||t===l.BACKSPACE?(e.target!==E[0]||t!==l.BACKSPACE||a[0]||(a=E.parent().prev()),a[0]&&r.removeValue(a.attr("data-value"))):t===x?a[0]?a.prev()[0]&&(a.removeClass("is-active"),a.prev().addClass("is-active")):E.parent().prev().addClass("is-active"):t===g&&a[0]&&a.next()[0]&&(a.removeClass("is-active"),(a=a.next()).find("input")[0]||a.addClass("is-active")):n.enterable&&t===l.ENTER&&E.val()&&(r.addValue(E.val()),E.val(""),e.stopPropagation()),t===l.ENTER&&e.preventDefault())})).focusin((function(e){o.addClass("is-focused"),"INPUT"!==e.target.nodeName.toUpperCase()&&E.focus()})).focusout((function(e){o.removeClass("is-focused").children(".is-active").removeClass("is-active"),n.enterable&&E.val()&&!V&&(r.addValue(E.val()),E.val(""))}))),n.initialSearch="",b=!0,"value"!==n.initialFetch||n.multiple||(n.initialSearch=E.val()),(n.pageItemsToSubmit||n.dependingOnSelector)&&(s=n.pageItemsToSubmit||"",n.dependingOnSelector&&(s.length>0&&(s+=","),s+=n.dependingOnSelector),n.itemsToSubmit=s.replace(/#/g,"").split(/\s*,\s*/)),n.itemsToSubmit&&(n.pluginTarget=E[0]),n.isPopup&&!n.enterable?D.mousedown((function(e){0!==e.button||r.isDisabled()||(O(),e.preventDefault())})):T.click((function(){y||O(),y=!1})).mousedown((function(){V&&(y=!0)})),E.keydown((function(e){var t,a=e.which,r=!1;a===l.DOWN||a===l.UP?O():a===l.ENTER?e.preventDefault():n.enterable||((r=!(a>=112&&a<=123||a>=33&&a<=46||a<32))&&(e.ctrlKey||e.metaKey)&&{65:1,67:1,86:1,88:1,89:1,90:1}[a]&&(r=!1),r&&((t=i("#apexPopupLovInputTrap"))[0]||(t=i("<input id='apexPopupLovInputTrap' type='text' class='u-vh' aria-hidden='true' tabindex='-1'>")),t.insertAfter(E).focus(),setTimeout((function(){var e=t.val();t.val(""),e.length>0?O(e):document.activeElement===t[0]&&E.focus()}),10)))})),T.on("focus",(function(){E.focus()})),v={enable:function(){w.prop("disabled",!1),E.removeClass("apex_disabled"),n.multiple&&o.find(".apex-item-multi-remove").prop("disabled",!1)},disable:function(){w.prop("disabled",!0),E.addClass("apex_disabled"),n.multiple&&o.find(".apex-item-multi-remove").prop("disabled",!0)},isDisabled:function(){return E.prop("disabled")},show:function(){I.show()},hide:function(){I.hide()},refresh:function(){E.trigger("apexbeforerefresh"),n.dynamicDefault?setTimeout((function(){r.setValue("TODO","To do")}),900):r.setValue(n.nullValue,n.nullDisplayValue),function(e){var t,a,i,l;if(a=n.extraOut)for(t in a)a.hasOwnProperty(t)&&(e?(i="",l=null):(l=null,null!==(i=a[t].initialValue)&&"object"==typeof i&&i.hasOwnProperty("d")&&(l=(i=i.v).d)),$s(a[t].item,i,l))}(!0),L(),E.trigger("apexafterrefresh")},setValue:function(e,t){var l,r,s,u;if(n.multiple){if(r=a.toArray(e,n.separator),t&&(u=a.toArray(t,n.separator)),E.val(""),o.children().not(":last").remove(),s="",""!==e){for(l=0;l<r.length;l++)s+=A(r[l],u?u[l]:null);E.parent().before(i(s))}P.val(r.join(n.separator))}else n.hasDisplayValue?(P.val(e),t||e!==n.nullValue||(t=n.nullDisplayValue),E.val(t)):E.val(e)},addValue:function(e,t){var a,l;n.multiple&&(l=!0,o.children().not(":last").each((function(){if(i(this).attr("data-value")===e)return l=!1,!1})),l&&(a=i(A(e,t)),E.parent().before(a),P.val(this.getValue().join(n.separator)),E.change()))},removeValue:function(e){var t=[];n.multiple&&(o.children().not(":last").each((function(){i(this).attr("data-value")===e&&t.push(this)})),i(t).remove(),P.val(this.getValue().join(n.separator)),t.length&&E.change())},isChanged:function(){var e=this.getValue();return i.isArray(e)&&(e=e.join(n.separator)),c!==e},getValue:function(){var e;return n.multiple?(e=[],o.children().not(":last").each((function(){e.push(i(this).attr("data-value"))})),e):n.hasDisplayValue?P.val():E.val()},afterModify:function(){var e,t,a,i,l,r;if(n.multiple){if(f&&E.attr("placeholder",this.isEmpty()?f:""),a=E.parent(),r=parseInt(a.css("margin-left"),10)+parseInt(a.css("margin-right"),10),e=t=u,!this.isEmpty())for(l=(a=a.prev()).offset().top;(e-=a.outerWidth(!0),(a=a.prev()).length)&&(i=a.offset().top)===l;)l=i;e<60&&(e=t),E.css("max-width",e-r)}},setFocusTo:function(){return E},displayValueFor:function(e){var t,l,r;if(n.hasDisplayValue){if(n.multiple){if(l=a.toArray(e,n.separator),(r=this.getValue()).length!==l.length)return e;for(t=0;t<l.length;t++)if(l[t]!==r[t])return e;return i.map(o.children().not(":last"),(function(e){return i(e).text()})).join(", ")}if(e===this.getValue())return i(this.node).val()}return e},getPopupSelector:function(){return".ui-dialog-popuplov"},nullValue:n.nullValue,separator:n.multiple?n.separator:null},n.itemsToSubmit&&(v.reinit=function(e,t){return this.setValue(e,t,!0),function(){L()}}),t.create(S,v),r=apex.item(S),n.multiple&&(r.setValue(m,h,!0),r.afterModify()),C=E.val(),c=r.getValue(),i.isArray(c)&&(c=c.join(n.separator)),n.dependingOnSelector&&i(n.dependingOnSelector).change(j),E.on("apexrefresh",j)}}(apex.widget,apex.item,apex.util,apex.jQuery);
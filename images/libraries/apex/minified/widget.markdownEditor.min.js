!function(e,t,o,r,n,i){var a={version:"1.0.0",C_RENDERED_CLASS:"is-markdownified",C_EVENT_NAME:"markdownified",C_BASIC_HTML_ESCAPE_MODE:"B",C_EXTENDED_HTML_ESCAPE_MODE:"E"},c=navigator.appVersion.indexOf("Mac")>=0;function s(e){return{getPreviewLabel:function(){return e.toolbar$.find('[data-action="preview"] label')},getPreviewInput:function(){return e.toolbar$.find('[data-action="preview"] input')},getActionContext:function(){return e.options.toolbar.actionsContext},setOption:function(e,t){this.getCodeMirror().setOption(e,t)},getValue:function(){return e.codeMirrorContainer.codeMirrorDocument.getValue()},getWrapperElement:function(){return e.codeMirrorContainer.codeMirror.getWrapperElement()},getCodeMirror:function(){return e.codeMirrorContainer.codeMirror},toggleAction:function(e){this.getActionContext().toggle(e)}}}function l(e){var t=s(e.editor);return{getCodeEditorInstance:function(){return e.getCodeEditorInstance()},refresh:function(){this.getCodeEditorInstance().refresh()},lineInfo:function(t){return e.getCodeEditorInstance().lineInfo(t)},setSize:function(t,o){return e.getCodeEditorInstance().setSize(t,o)},adjustHeight:function(){e.editor.codeMirrorContainer.adjustHeight()},getCodeMirror:function(){return t.getCodeMirror()}}}a.C_HTML_TAGS_WHITELIST=["b","strong","i","em","p","span","hr","h1","h2","h3","h4","h5","h6"],a.htmlEscapeMode=a.C_EXTENDED_HTML_ESCAPE_MODE,e.fn.hasScrollBar=function(){return!!this[0]&&this[0].scrollHeight>this.innerHeight()};var d={getEditorUtils:s,getMarkdownUtils:l};function u(e){if(document.activeElement&&document.activeElement.form){var t=Array.prototype.filter.call(document.activeElement.form.querySelectorAll('a:not([disabled]), button:not([disabled]), input[type=text]:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])'),(function(e){return e.offsetWidth>0||e.offsetHeight>0||e===document.activeElement})),o=t.indexOf(document.activeElement);if(o>-1)(t[o+(e?-1:1)]||t[0]).focus()}}function h(e,t){var o=-1;try{o=parseInt(e.attr(t))}catch(e){console.log(e)}return o}function p(t,o){var r=function(e){var t=[];return"BASIC"===e.whitelist?t=["b","i","u","em","strong","p","br"]:"IMAGE"===e.whitelist&&(t=["img"]),{preview:{parsing:{escapeInputHtml:"NONE"!==e.escapeInputHtml,htmlEscapeMode:a.C_EXTENDED_HTML_ESCAPE_MODE,htmlTagsWhitelisting:{enabled:"ALLOW_WHITELIST"===e.escapeInputHtml,allowAttributes:!0,whitelist:t},markedOptions:{gfm:!0,breaks:!0}},rendering:{highlightFencedCodeBlocks:!1}},designerOptions:e}}(o),n=this;n.onBeforePreviewText=function(e){return e};var i=e.extend({readOnly:{enabled:!1},textarea:{useCodeEditor:!0},designerOptions:o,markDownEditor:n},r);n.editor=new a.Editor(t,i),n.getCodeEditorInstance=function(){return n.editor.codeMirrorContainer.codeMirror},n.getPreviewMode=function(){return n.editor.showingPreview},n.setPreviewMode=function(e){m(n.editor,n.onBeforePreviewText)(e)},n.getCodeEditorDocument=function(){return n.editor.codeMirrorContainer.codeMirrorDocument},n.setCodeEditorDocumentValue=function(e){n.getCodeEditorDocument().setValue(e)},n.getCodeEditorDocumentValue=function(){return n.getCodeEditorDocument().getValue()},function(e,t){var o=e.getCodeEditorInstance(),r=[];r.push({validate:function(e,o){var r=h(t,"maxlength");if(r>=0&&o.update){var n=o.text.join("\n"),i=n.length-(e.indexFromPos(o.to)-e.indexFromPos(o.from));if(i<=0)return!0;(i=e.getValue().length+i-r)>0&&(n=n.substr(0,n.length-i),o.update(o.from,o.to,n.split("\n")))}return!0}}),o.on("beforeChange",(function(e,t){for(var o=0;o<r.length;o++){r[o].validate(e,t)}}))}(n,t),n.itemize=function(){return function(t,o){var r={refresh:function(){l(t).refresh()},setStyleTo:function(){return t.editor.content$},setFocusTo:function(){return t.getCodeEditorInstance().focus(),e(this)},getValue:function(){return o.val()},setValue:function(e){var r=h(o,"maxlength");r>=0&&e.length>r||(t.setCodeEditorDocumentValue(e),t.getPreviewMode()&&M(!0,t.editor,t.onBeforePreviewText))}};return r}(n,t)},o.readOnly&&m(n.editor,n.onBeforePreviewText)(!0)}marked.setOptions({gfm:!0,sanitize:!1,silent:!1}),o.markdown=function(t,o){o=e.extend(!0,{initJavascriptCode:function(){},readOnly:!0},o);var r=e(t),i=new p(r,o),a=r.attr("id");return n.create(a,i.itemize()),i},o.markdown.render=function(t){C(e(t))},a.parserOptions={escapeInputHtml:!0,htmlEscapeMode:a.htmlEscapeMode,htmlTagsWhitelisting:{enabled:!1,allowAttributes:!1,whitelist:a.C_HTML_TAGS_WHITELIST},markedOptions:{gfm:!0,breaks:!0,sanitize:!0}};var g=new marked.Renderer,f=g.link;function C(t){t.each((function(){var t=e(this);t.html(a.parse(t.text())).addClass(a.C_RENDERED_CLASS),e(document).trigger(a.C_EVENT_NAME,t.get(0))}))}function m(e,t){return function(o){M(o,e,t)}}function M(t,o,r){var n;o.showingPreview=t,o.showingPreview?o.toolbar$.find('.a-Toolbar-item:not([data-action="preview"])').attr("disabled","disabled"):o.toolbar$.find('.a-Toolbar-item:not([data-action="preview"])').removeAttr("disabled");var i=d.getEditorUtils(o),c=i.getValue(),s=e(i.getWrapperElement());n=e(s).outerHeight();var l="";if(o.showingPreview){i.setOption("scrollbarStyle","null");var u=r(c);if(u.length>0)l=a.parse(u,o.options.preview.parsing);else l='<p style="color: #959595">'+o.getPreviewEmptyMessage()+"</p>"}else i.setOption("scrollbarStyle","native");o.previewPanel$.html(l).css("height",o.showingPreview?n:"").toggleClass("a-MDEditor-previewPanel--hide",!o.showingPreview).toggleClass(a.C_RENDERED_CLASS,o.showingPreview),o.showingPreview?(o.previewPanel$.hasScrollBar()&&o.previewPanel$.focus(),i.setOption("readOnly",!0)):i.setOption("readOnly",!1)}function v(e){return e.getSelectionProperties().selectedText}function E(e,t,o){(function(e,t,o){o=o||t;var r=!1,n=v(e);return 0===n.indexOf(t)&&n.lastIndexOf(o)===n.length-o.length&&(r=!0),r})(e,t,o=o||t)?function(e,t,o){o=o||t;var r=v(e),n=r.substring(t.length,r.length-o.length);e.codeMirrorDocument.replaceSelection(n)}(e,t,o):e.wrapSelection(t,o),e.adjustHeight()}function w(t){var o=e(t.target);setTimeout((function(){o.find("input").first().focus()}),1)}function S(t,o){return[{name:"bold",action:function(){E(t.codeMirrorContainer,"**")}},{name:"italics",action:function(){E(t.codeMirrorContainer,"_")}},{name:"strikethrough",action:function(){E(t.codeMirrorContainer,"~~")}},{name:"inlineCode",action:function(){E(t.codeMirrorContainer,"```\n","\n```")}},{name:"addHeader",action:function(){t.codeMirrorContainer.prefixLines((t.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"# "),t.codeMirrorContainer.adjustHeight()}},{name:"unorderedList",action:function(){t.codeMirrorContainer.prefixLines((t.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"- "),t.codeMirrorContainer.adjustHeight()}},{name:"orderedList",action:function(){t.codeMirrorContainer.prefixLines((t.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"1. ",!0),t.codeMirrorContainer.adjustHeight()}},{name:"codeBlock",action:function(){var e=t.codeMirrorContainer.getSelectionProperties();t.codeMirrorContainer.wrapSelection((e.selectionStartsInZero?"":"\n\n")+"```\n","\n```"),t.codeMirrorContainer.adjustHeight()}},{name:"codeBlockHtml",action:function(){var e=t.codeMirrorContainer.getSelectionProperties();t.codeMirrorContainer.wrapSelection((e.selectionStartsInZero?"":"\n\n")+"```html\n","\n```"),t.codeMirrorContainer.adjustHeight()}},{name:"codeBlockCss",action:function(){var e=t.codeMirrorContainer.getSelectionProperties();t.codeMirrorContainer.wrapSelection((e.selectionStartsInZero?"":"\n\n")+"```css\n","\n```"),t.codeMirrorContainer.adjustHeight()}},{name:"codeBlockJs",action:function(){var e=t.codeMirrorContainer.getSelectionProperties();t.codeMirrorContainer.wrapSelection((e.selectionStartsInZero?"":"\n\n")+"```js\n","\n```"),t.codeMirrorContainer.adjustHeight()}},{name:"blockquote",action:function(){t.codeMirrorContainer.prefixLines((t.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"> "),t.codeMirrorContainer.adjustHeight()}},{name:"link",action:function(){var o=t.codeMirrorContainer.getSelectionProperties(),r=a.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_LINK_TEXT",label:"Text",placeholder:"Link Description"}),n=a.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_LINK_URL",label:"URL",placeholder:"http://..."}),c=e("<form></form>").append(r.field).append(n.field);if(o.selectedText.match(/^[a-z]+:\/\//))t.codeMirrorContainer.wrapSelection("[](",")");else if(o.selectionLength>0)t.codeMirrorContainer.wrapSelection("[","]()");else{function s(){var e=r.input.val().trim(),o=n.input.val().trim();t.codeMirrorContainer.wrapSelection("["+e,"]("+o+")"),l.dialog("close").remove()}var l=c.dialog({autoOpen:!0,height:"auto",width:350,modal:!0,title:i.getMessage("APEX.MARKDOWN.INSERT_LINK"),buttons:{Cancel:function(){l.dialog("close").remove()},OK:s},focus:function(e,t){w(e)},close:function(){c.get(0).reset()},create:function(){e(this).parents(".ui-dialog").find(".ui-button:contains(OK)").addClass("ui-button--hot")}});T(l,s),l.parent().addClass("ui-dialog--markdown")}}},{name:"image",action:function(){var o,r=t.codeMirrorContainer.getSelectionProperties(),n=a.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_IMAGE_TEXT",label:"Text",placeholder:"Image Description"}),c=a.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_IMAGE_URL",label:"URL",placeholder:"http://..."}),s=e("<form></form>").append(n.field).append(c.field);if(r.selectedText.match(/^[a-z]+:\/\//))t.codeMirrorContainer.wrapSelection("![](",")");else if(r.selectionLength>0)t.codeMirrorContainer.wrapSelection("![","]()");else{function l(){var r,i;e("<img>").attr({src:c.input.val(),alt:n.input.val()});r="!["+n.input.val(),i="]("+c.input.val()+")",t.codeMirrorContainer.wrapSelection(r,i),o.dialog("close").remove()}T(o=s.dialog({autoOpen:!0,height:"auto",width:400,modal:!0,title:i.getMessage("APEX.MARKDOWN.INSERT_IMAGE"),buttons:{Cancel:function(){o.dialog("close").remove()},OK:l},close:function(){s.get(0).reset()},focus:function(e,t){w(e)},create:function(){e(this).parents(".ui-dialog").find(".ui-button:contains(OK)").addClass("ui-button--hot")}}),l),o.parent().addClass("ui-dialog--markdown")}}},{name:"preview",get:function(){return t.showingPreview},set:m(t,o.onBeforePreviewText)}]}function T(t,o){t.on("keydown",(function(t){switch(t.keyCode){case e.ui.keyCode.ENTER:o()}}))}function x(){var e={bold:{shortCut1:"Cmd-B",shortCut2:"Ctrl-B"},italics:{shortCut1:"Cmd-I",shortCut2:"Ctrl-I"},strikethrough:{shortCut1:"Shift-Cmd-X",shortCut2:"Shift-Ctrl-X"}};return e}function O(e,t){var o=x()[e];return function(e,t){var o=t.shortCut1,r=t.shortCut2;return i.getMessage(e)+" ("+(c?o:r)+")"}("APEX.MARKDOWN."+(t||e.toUpperCase()),o)}function b(e,t){var o=[{type:"BUTTON",label:i.getMessage("APEX.MARKDOWN.LINK"),iconOnly:!0,icon:"icon-link",action:"link"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.IMAGE",iconOnly:!0,icon:"icon-picture",action:"image"}],r=[{groupTogether:!0,controls:[{type:"BUTTON",label:O("bold"),iconOnly:!0,icon:"icon-bold",action:"bold"},{type:"BUTTON",label:O("italics","ITALIC"),iconOnly:!0,icon:"icon-italic",action:"italics"},{type:"BUTTON",label:O("strikethrough"),iconOnly:!0,icon:"icon-strikethrough",action:"strikethrough"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.INLINE_CODE",iconOnly:!0,icon:"icon-code",action:"inlineCode"}]},{groupTogether:!0,controls:[{type:"BUTTON",labelKey:"APEX.MARKDOWN.UNORDERED_LIST",iconOnly:!0,icon:"icon-list-ul",action:"unorderedList"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.ORDERED_LIST",iconOnly:!0,icon:"icon-list-ol",action:"orderedList"}]},{groupTogether:!0,controls:[{type:"BUTTON",label:"Blockquote",iconOnly:!0,icon:"icon-quote",action:"blockquote"}]},{groupTogether:!0,controls:o}];e.getReadOnlyMode()||r.push({groupTogether:!1,align:"end",controls:[{type:"TOGGLE",labelKey:"APEX.MARKDOWN.PREVIEW",action:"preview"}]});var n=t.designerOptions.toolbar;return"SIMPLE"!=n&&void 0!==n||o.pop(),"NONE"==n&&(r=[],e.getReadOnlyMode()||r.push({groupTogether:!1,align:"end",controls:[{type:"TOGGLE",labelKey:"APEX.MARKDOWN.PREVIEW",action:"preview"}]})),r}g.link=function(e,t,o){return f.call(g,e,t,o).replace(/^<a /,'<a target="_blank" ')},DOMPurify.setConfig({ADD_ATTR:["target"]}),a.parse=function(e,t){t=void 0===t||!!t;var o=marked(e,{renderer:g});return DOMPurify.sanitize(o,{SAFE_FOR_JQUERY:!0})},a.render=function(t){C(e(t).filter(':not([data-markdown]), [data-markdown="true"]').filter(":not( ."+a.C_RENDERED_CLASS+" )"))},a.CodeMirrorContainer=function(o){if(this.textarea$=e(o).filter("textarea").eq(0),this.textareaPollingInterval=null,this.codeMirror=null,this.codeMirrorDocument=null,!(this.textarea$.length>0))throw"ERROR: markdownify.Textarea: No textarea element was found in the passed argument. A textarea selector, element or jQuery object must be passed";var r="rtl"==e("html").attr("dir");this.codeMirror=t.fromTextArea(this.textarea$.get(0),{tokenTypeOverrides:{emoji:"emoji"},direction:r?"rtl":"ltr"}),this.codeMirrorDocument=this.codeMirror.getDoc(),this.codeMirror.setOption("mode","text/x-gfm"),this.codeMirror.setOption("lineWrapping",!0),this.codeMirror.on("change",(function(e,t){e.save()}))},a.CodeMirrorContainer.maximumHeight=320,a.CodeMirrorContainer.prototype.adjustHeight=function(e){if(void 0===e&&(e=a.CodeMirrorContainer.maximumHeight),null!==this.codeMirror){var t=this.codeMirror.getWrapperElement().offsetHeight;if(this.codeMirror.getScrollInfo().height>t&&t<e){var o=t+this.codeMirror.defaultTextHeight();this.codeMirror.setSize(null,o)}}},a.CodeMirrorContainer.prototype.getSelectionProperties=function(){var e,t,o=null;return this.codeMirror.execCommand("singleSelection"),(e={selectionStart:(t=this.codeMirrorDocument.listSelections()[0]).anchor,selectionEnd:t.head,textareaValue:this.codeMirrorDocument.getValue(),textBeforeSelection:"",textAfterSelection:"",selectedText:this.codeMirrorDocument.getSelections()[0],selectionLength:0,numberOfSelectedLines:0,selectionStartsInZero:!1}).selectionStartsInZero=0==e.selectionStart.line&&0==e.selectionStart.ch,e.selectionStart.ch>e.selectionEnd.ch&&(o=e.selectionStart,e.selectionStart=e.selectionEnd,e.selectionEnd=o),e.textBeforeSelection=this.codeMirrorDocument.getRange({line:0,ch:0},e.selectionStart),e.textAfterSelection=this.codeMirrorDocument.getRange(e.selectionEnd,{line:this.codeMirrorDocument.lastLine(),ch:this.codeMirrorDocument.getLine(this.codeMirrorDocument.lastLine()).length}),e.selectionLength=e.selectedText.length,e.numberOfSelectedLines=e.selectedText.split("\n").length,e},a.CodeMirrorContainer.prototype.wrapSelection=function(e,t){var o,r=this.getSelectionProperties();this.codeMirrorDocument.replaceSelection((e||"")+r.selectedText+(t||""),"end"),o=this.codeMirrorDocument.listSelections()[0],0==r.selectionLength&&this.codeMirrorDocument.setSelection({line:o.anchor.line,ch:o.anchor.ch-(t?t.length:0)},{line:o.anchor.line,ch:o.anchor.ch-(t?t.length:0)});var n=this;setTimeout((function(){n.codeMirror.focus()}),1)},a.CodeMirrorContainer.prototype.prefixLines=function(e){var t=this.getSelectionProperties(),o=this;t.selectionLength>0&&(t.selectedText=t.selectedText.split("\n").join("\n"+e)),this.codeMirrorDocument.replaceSelection((e||"")+t.selectedText,"end"),setTimeout((function(){o.codeMirror.focus()}),1)},a.Editor=function(t,o){var n=o.markDownEditor;this.getPreviewEmptyMessage=function(){var e=o.designerOptions.previewEmptyMessage;return e.length>1&&(e=(e=e.substring(1)).substring(0,e.length-1)),e};var i,c,s=o.designerOptions.readOnly;this.getReadOnlyMode=function(){return s},this.options=e.extend(!0,{textarea:{},preview:{parsing:a.parserOptions},toolbar:(i=this,c=o,{data:b(i,c),actions:S(i,c.markDownEditor),cursorKeyNavigation:!1})},o),o.designerOptions.initJavascriptCode.call(n,this.options),this.showingPreview=!1,this.editor$=e("<div></div>").addClass("a-MDEditor apex-item-markdown-editor"),this.toolbar$=e("<div></div>").addClass("a-MDEditor-toolbar"),this.options.toolbar.actionsContext=r.createContext("apex.markdown.Editor.toolbar",this.toolbar$.get(0)),this.options.toolbar.actionsContext.add(this.options.toolbar.actions),this.previewPanel$=e("<div></div>").addClass("a-MDEditor-previewPanel a-MDEditor-previewPanel--hide");var l=d.getEditorUtils(this);function p(e){(e.ctrlKey||e.metaKey)&&80===e.which&&(l.toggleAction("preview"),l.getCodeMirror().focus(),e.preventDefault(),e.stopPropagation())}if(this.previewPanel$.keydown(p),this.content$=e("<div></div>").addClass("a-MDEditor-content"),this.editorContainer$=this.content$,this.content$=e(t).filter("textarea").addClass("a-MDEditor-textarea").wrap(this.content$).parent().wrap(this.editor$).before(this.toolbar$).prepend(this.previewPanel$),this.codeMirrorContainer=new a.CodeMirrorContainer(t,this.options.textarea),!1===this.getReadOnlyMode()){for(var g=x(),f=function(){var e={preview:{shortCut1:"Cmd-P",shortCut2:"Ctrl-P"},focusnext:{shortCut1:"Shift-Cmd-.",shortCut2:"Shift-Ctrl-."},focusprev:{shortCut1:"Shift-Cmd-,",shortCut2:"Shift-Ctrl-,"}};return e}(),C=this.options.toolbar.actionsContext,m=0;m<this.options.toolbar.actions.length;m++){var M=this.options.toolbar.actions[m],v=this.codeMirrorContainer.codeMirror,E=g[M.name];E&&A(v,function(e){return function(){C.invoke(e)}}(M.name),E),"preview"===M.name&&A(v,(function(){C.toggle("preview")}),f.preview)}A(v,(function(){u()}),f.focusnext),A(v,(function(){u(!0)}),f.focusprev),this.toolbar$.toolbar(this.options.toolbar),l.getPreviewInput().keydown(p)}if(null!==this.codeMirrorContainer.codeMirror){var w={width:void 0,height:void 0},T=h(e(t),"rows");T>=0&&(w.height=this.codeMirrorContainer.codeMirror.defaultTextHeight()*(T+2));var O=h(e(t),"cols");if(O>=0){var D=e(t).closest(".a-MDEditor"),I=this.codeMirrorContainer.codeMirror.defaultTextHeight()*O,P=D.find(".a-Toolbar-groupContainer"),y=12;P.each((function(){y+=e(this).outerWidth()})),D.css("max-width",Math.max(I,y))}this.codeMirrorContainer.codeMirror.setSize(w.width,w.height),this.editor$.addClass("a-MDEditor--codeEditor"),this.codeMirrorContainer.textarea$.parents(".u-Form-itemWrapper").css({"flex-wrap":"wrap",position:"relative"})}function A(e,t,o){var r=o.shortCut1,n=o.shortCut2;_(e,t,r),n&&_(e,t,n)}function _(e,t,o){var r={};r[o]=function(){t()},e.addKeyMap(r)}},a.Editor.createTextInput=function(t){var o=e("<input />").addClass("text_field apex-item-text").attr({type:"text",id:t.id,name:t.id}),r=e("<div></div>").addClass("u-Form-itemWrapper").append(o),n=e("<div></div>").addClass("u-Form-inputContainer col col-null").append(r),i=e("<label></label>").addClass("u-Form-label").attr("for",t.id).text(t.label),a=e("<div></div>").addClass("u-Form-labelContainer col col-null").append(i),c=e("<div></div>").addClass("u-Form-fieldContainer rel-col  lto46434665622631032_0 apex-item-wrapper apex-item-wrapper--text-field").append(a).append(n);return"placeholder"in t&&n.attr("placeholder",t.placeholder),{field:c,label:i,input:o}}}(apex.jQuery,CodeMirror,apex.widget,apex.actions,apex.item,apex.lang);
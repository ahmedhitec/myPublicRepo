!function(t,e,i,r){"use strict";var a="a-PopupLOV",s="a-Button";function l(t){return r.getMessage("LOV_DIALOG."+t)}t.widget("apex.lovDialog",t.ui.dialog,{version:"5.2",widgetEventPrefix:"lovdialog",baseId:null,filterHasSubFilter:[],filterIsSearch:[],filterFiltersOnChange:[],currentFilters:{},deferredFilterLov:t.Deferred(),options:{filterLov:null,idPrefix:null,multiValue:!1,filters:[],columnDefinitions:[],resultsDisplay:"table"},_create:function(){var e,i=this.options;if(!t.isFunction(i.filterLov))throw"Missing required 'filterLov' option.";if(0===i.columnDefinitions.length)throw"Missing required 'columnDefinitions' option.";this.baseId=(i.idPrefix||this.element[0].id||"lovDialog")+"_",this.element.addClass(a);for(var s=0;s<this.options.columnDefinitions.length;s++)this.options.columnDefinitions[s]=t.extend({alignment:"left",escape:!0},this.options.columnDefinitions[s]);return this.filterHasSubFilter=[],this.filterIsSearch=[],this.filterFiltersOnChange=[],this.currentFilters={},this.resultsDisplayTableMode="table"===this.options.resultsDisplay,this.options.closeText=r.getMessage("APEX.DIALOG.CLOSE"),e=this._super(),this.element.closest(".ui-dialog").attr("aria-modal",this.options.modal),this._renderLovDialog(),e},_renderLovDialog:function(){var i,r,s,n,o,u,p=this,m=e.htmlBuilder();if(m.markup("<div").attr("class",a).markup(">"),this._renderFilters(m,this.options.filters),m.markup("<div").attr("class","a-PopupLOV-results").markup(">"),this.resultsDisplayTableMode){for(m.markup("<table").attr("class","a-PopupLOV-resultsSet").attr("id",p.baseId+"lovEntries").markup(">").markup("<caption").attr("class","visuallyhidden").markup(">").content(l("LOV_ENTRIES")).markup("</caption>"),m.markup("<tr>"),this.options.multiValue&&m.markup("<th>").content(l("SELECT")).markup("</th>"),i=0;i<this.options.columnDefinitions.length;i++)u=this.options.columnDefinitions[i].title,o="left"===this.options.columnDefinitions[i].alignment?"u-textLeft":"u-textCenter",m.markup("<th").attr("class",o).optionalAttr("width",this.options.columnDefinitions[i].width).markup(">"),this.options.columnDefinitions[i].escape?m.content(u):m.markup(u),m.markup("</th>");m.markup("</tr>"),m.markup("</table>")}else m.markup("<div").attr("class","a-PopupLOV-resultsGrid-wrap").markup("><ul").attr("class","a-PopupLOV-resultsGrid").markup("></ul></div>");for(m.markup("</div>"),this.element.empty().append(m.toString()),this._lovEntries$=t("#"+this.baseId+"lovEntries"),this._filterLov(this.options.filters),this._on({click:this._resultsLinkClick}),r=0;r<this.filterIsSearch.length;r++)this._on("#"+this.filterIsSearch[r]+"_button",{click:this._doSearch}),this._on("#"+this.filterIsSearch[r],{keypress:function(t){13===t.which&&(p._doSearch(t),t.preventDefault())}});for(n=0;n<this.filterFiltersOnChange.length;n++)this._on("#"+this.filterFiltersOnChange[n],{change:this._doSearch});for(s=0;s<this.filterHasSubFilter.length;s++)this._on("#"+this.filterHasSubFilter[s],{change:this._filterHasSubFilterChange})},_resultsLinkClick:function(e){var i,r,a,s,l=t(e.target),n=!1;if(l.hasClass("a-PopupLOV-resultsSet-link")){for(var o in i=this.lovEntries[l.data("lov-entry-idx")],this.currentFilters){for(r=0;r<this.options.filters.length;r++)if(this.options.filters[r].name===o){if(n=!0,this.options.filters[r].lov)for(a=0;a<this.options.filters[r].lov.length;a++)if(this.options.filters[r].lov[a].value===this.currentFilters[o]){this.options.filters[r].lov[a].valueFormatting&&(s=this.options.filters[r].lov[a].valueFormatting);break}break}if(n)break}s&&t.extend(i,{valueFormatting:s}),this._trigger("valueSelected",{},i),!1===this.options.multiValue&&this.close()}},_doSearch:function(t){this._filterLov(this.options.filters)},_filterHasSubFilterChange:function(i){for(var r=e.htmlBuilder(),a=this.options.filters,s=t(i.target),l=s.data("filter-name"),n=0;n<a.length;n++)if(a[n].name===l)for(var o=0;o<a[n].lov.length;o++)if(a[n].lov[o].filters)if(s.val()===a[n].lov[o].value)this._renderFilters(r,a[n].lov[o].filters,!0),s.closest("div.a-PopupLOV-filterGroup").after(r.toString());else for(var u=0;u<a[n].lov[o].filters.length;u++)this.element.find("[data-filter-name="+a[n].lov[o].filters[u].name+"]").closest("div.a-PopupLOV-filterGroup").remove()},_filterLovEntries:function(t){var e,i,r,a=[];if(""!==t){for(r=t instanceof RegExp?t:new RegExp(t,"i"),e=0;e<this.lovEntries.length;e++)for(i=0;i<this.options.columnDefinitions.length;i++)if((this.lovEntries[e][this.options.columnDefinitions[i].name]+"").match(r)){a.push(this.lovEntries[e]);break}this.lovEntries=a}},_renderLovEntries:function(t,i){var r,a,s,n,o,u,p=e.htmlBuilder(),m=this;if(this.lovEntries=t.slice(),i&&this._filterLovEntries(i),this.resultsDisplayTableMode){for(r=0;r<this.lovEntries.length;r++){for(p.markup("<tr>"),this.options.multiValue&&p.markup("<td>").markup("<input").attr("type","checkbox").attr("title",l("SELECT")).attr("data-lov-row",r).markup(" />").markup("</td>"),a=0;a<this.options.columnDefinitions.length;a++)o=this.options.columnDefinitions[a].cellFormatting?function(t){p.markup(m.options.columnDefinitions[a].cellFormatting(t))}:this.options.columnDefinitions[a].escape?function(t){p.content(t)}:function(t){p.markup(t)},n=0!==(n=this.lovEntries[r][this.options.columnDefinitions[a].name])?n||"":n,"left"===this.options.columnDefinitions[a].alignment?s="u-textLeft":"right"===this.options.columnDefinitions[a].alignment?s="u-textRight":"center"===this.options.columnDefinitions[a].alignment&&(s="u-textCenter"),p.markup("<td").attr("class",s).markup(">"),0===a?(p.markup("<a").attr("class","a-PopupLOV-resultsSet-link").attr("href","#").attr("data-lov-entry-idx",r).markup(">"),o(n),p.markup("</a>")):o(n),p.markup("</td>");p.markup("</tr>")}this._lovEntries$.find("tr").after(p.toString())}else{for(r=0;r<this.lovEntries.length;r++)p.markup("<li").attr("class","a-PopupLOV-iconGrid-item").markup(">"),n=this.lovEntries[r].r,u=this.lovEntries[r].d,n=0!==n?n||"":n,p.markup("<a").attr("class","a-PopupLOV-resultsSet-link").attr("href","#").attr("data-lov-entry-idx",r).markup(">"),p.markup("<span").attr("class","fa "+n).attr("aria-hidden","true").markup("></span>"),p.content(u),p.markup("</a>"),p.markup("</li>");this.element.find(".a-PopupLOV-resultsGrid").append(p.toString())}},_updateCurrentFilters:function(e){var i,r,a,s;for(i=0;i<e.length;i++)if(r=e[i].name,t("#"+this.baseId+r).length>0&&(a=t("#"+this.baseId+e[i].name),t.inArray(e[i].type,["text","select","search"])>-1?s=a.val():"buttonset"===e[i].type&&(s=a.find("input:checked").val()),this.currentFilters[r]=s,e[i].lov))for(var l=0;l<e[i].lov.length;l++)e[i].lov[l].value===s&&e[i].lov[l].filters&&this._updateCurrentFilters(e[i].lov[l].filters)},_filterLov:function(i){var r,a=this;a.deferredFilterLov.reject({status:0},"superseded",null),a.deferredFilterLov=t.Deferred().always((function(){e.delayLinger.finish("lovDialog",(function(){r.remove()}))})).done((function(t,e){a._renderLovEntries(t,e)})),this.resultsDisplayTableMode?this._lovEntries$.find("tr").not(":first").remove():this.element.find(".a-PopupLOV-resultsGrid").empty(),this._updateCurrentFilters(i),e.delayLinger.start("lovDialog",(function(){r=e.showSpinner(t(".a-PopupLOV-results"))})),this.options.filterLov(this.currentFilters,(function(t,e){a.deferredFilterLov.resolve(t,e)}))},_renderSearch:function(t,e){t.markup("<div").attr("class","a-PopupLOV-search").markup(">"),t.markup("<div").attr("class","a-SearchBox").markup(">"),t.markup("<div").attr("class","a-SearchBox-field").markup(">"),t.markup("<span").attr("class","a-SearchBox-icon").markup(">"),t.markup("<span").attr("class","a-Icon icon-search").markup(">").markup("</span>"),t.markup("</span>"),t.markup("<input").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("type","text").attr("class","a-SearchBox-input").attr("title",e.title).attr("placeholder",e.title).attr("aria-controls",this.baseId+"lovEntries").attr("value",e.defaultValue?e.defaultValue:"").optionalBoolAttr("aria-required",e.isRequired).markup(" />"),t.markup("</div>"),t.markup("<button").attr("class",s+" a-Button--noLabel a-Button--withIcon a-Button--slim a-Button--pillEnd a-Button--primary").attr("value",l("GO")).attr("type","button").attr("id",this.baseId+e.name+"_button").attr("title",l("GO")).attr("aria-controls",this.baseId+"lovEntries").markup(">"),t.markup("<span").attr("class","a-Icon icon-right-chevron").markup(">").markup("</span>"),t.markup("<span").attr("class","visuallyhidden").markup(">").content("Go").markup("</span>"),t.markup("</button>"),t.markup("</div>"),t.markup("</div>"),this.filterIsSearch.push(this.baseId+e.name)},_renderText:function(t,e){t.markup("<div").attr("class","a-PopupLOV-filterGroup a-PopupLOV-filterGroup--lineFilter").markup(">"),t.markup("<span").attr("class","a-PopupLOV-filterLabel").markup(">"),t.markup("<label").attr("for",this.baseId+e.name).attr("class","a-Form-label a-PopupLOV-filterItem-label").markup(">").content(e.title).markup("</label>"),t.markup("</span>"),t.markup("<span").attr("class","a-PopupLOV-filterItem").markup(">"),t.markup("<input").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("type","text").attr("class","a-Form-field a-PopupLOV-filterItem-text").attr("value",e.defaultValue?e.defaultValue:"").optionalBoolAttr("aria-required",e.isRequired).markup(" />"),t.markup("</span>"),t.markup("</div>")},_renderSelect:function(t,e){var i,r=[];function a(i){var a=e.defaultValue===i.value;t.markup("<option").attr("value",i.value).optionalAttr("selected",a).markup(">").content(i.display).markup("</option>"),i.filters&&(this.filterHasSubFilter.push(this.baseId+e.name),a&&(r=i.filters))}for(this.filterFiltersOnChange.push(this.baseId+e.name),t.markup("<div").attr("class","a-PopupLOV-filterGroup a-PopupLOV-filterGroup--lineFilter").markup(">"),t.markup("<span").attr("class","a-PopupLOV-filterLabel").markup(">"),t.markup("<label").attr("for",this.baseId+e.name).attr("class","a-Form-label a-PopupLOV-filterItem-label").markup(">").content(e.title).markup("</label>"),t.markup("</span>"),t.markup("<span").attr("class","a-PopupLOV-filterItem").markup(">"),t.markup("<select").attr("id",this.baseId+e.name).attr("data-filter-name",e.name).attr("size","1").attr("class","a-Form-field a-Form-select a-PopupLOV-filterItem-select").attr("aria-controls",this.baseId+"lovEntries").optionalBoolAttr("aria-required",e.isRequired).markup(">"),e.isRequired||a({display:l("SELECT_VALUE"),value:""}),i=0;i<e.lov.length;i++)a(e.lov[i]);return t.markup("</select>"),t.markup("</span>"),t.markup("</div>"),r},_renderButtonSet:function(t,e){var i,r,a=[];for(this.filterFiltersOnChange.push(this.baseId+e.name),t.markup("<div").attr("class","a-PopupLOV-filterGroup a-PopupLOV-filterGroup--lineFilter").markup(">"),t.markup("<span").attr("class","a-PopupLOV-filterItem apex-button-group").attr("id",this.baseId+e.name).attr("role","group").attr("aria-label",e.title).attr("aria-controls",this.baseId+"lovEntries").markup(">"),t.markup("<div").attr("class","apex-item-grid-row").markup(">"),i=0;i<e.lov.length;i++)r=e.defaultValue===e.lov[i].value,t.markup("<div").attr("class","apex-item-option").markup(">"),t.markup("<input").attr("id",this.baseId+e.name+"_"+e.lov[i].value).attr("type","radio").optionalAttr("checked",r).attr("value",e.lov[i].value).attr("name",this.baseId+e.name).attr("data-filter-name",e.name).markup(" />"),t.markup("<label").attr("for",this.baseId+e.name+"_"+e.lov[i].value).markup(">").content(e.lov[i].display).markup("</label>"),t.markup("</div>"),e.lov[i].filters&&(this.filterHasSubFilter.push(this.baseId+e.name),r&&(a=e.lov[i].filters));return t.markup("</div>"),t.markup("</span>"),t.markup("</div>"),a},_renderFilters:function(t,e,i){var r,a=[];for(e.length>0&&!i&&t.markup("<div").attr("class","a-PopupLOV-filters").markup(">"),r=0;r<e.length;r++){switch(a=[],e[r].type){case"search":this._renderSearch(t,e[r]);break;case"text":this._renderText(t,e[r]);break;case"select":a=this._renderSelect(t,e[r]);break;case"buttonset":a=this._renderButtonSet(t,e[r])}a.length>0&&this._renderFilters(t,a,!0)}e.length>0&&!i&&t.markup("</div>")},close:function(){return this.element.removeClass(a).empty(),this._super()}})}(apex.jQuery,apex.util,apex.debug,apex.lang);
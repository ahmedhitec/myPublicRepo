apex.issues={},function(e){"use strict";function a(e){e.toolbar.data[0].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.HEADING"),iconOnly:!0,icon:"fa fa-header",action:"addHeader"})}function t(e,a){var t=window.location.href.split("?")[0];return t+="?p=4600:100:"+$v("pInstance")+":APPLICATION_PROCESS=getAttachment:NO::P100_ISSUE_ID,P100_FILE_NAME_SLUG:"+$v(a)+","+e}apex.issues={addHeadButton:a,replacePrefixImage:function(e,a){for(var n="(#ISSUE_FILE#",i=[],o=0;o<e.length;o++){var l=e.indexOf(n,o);if(l>=0){var r=e.indexOf(")",l+1);if(r<0){o=l+n.length;continue}var s=e.substring(l+n.length,r);i.push({imageName:s,path:t(s,a)}),o=r+1}else o=e.length}return i.forEach((function(a){e=e.replace(n+a.imageName+")","("+a.path+")")})),e},addAttachButton:function(t,n,i,o){var l=$v(n);a(t),"Y"==l&&t.toolbar.data[t.toolbar.data.length-1].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.ATTACH_FILES"),iconOnly:!0,icon:"fa fa-paperclip",action:"attach_files"}),t.toolbar.actions.push({name:"attach_files",action:function(){window.location.assign($v(o)),apex.util.getTopApex().gPageContext$.off("apexclosedialoginternal").on("apexclosedialoginternal",(function(a,t){var n,o,l,r,s,c;if(t&&t.P109_FILES_INFO){for(l=(n=JSON.parse(t.P109_FILES_INFO)).length,o=0;o<l;o++){s=(r=n[o]).n,c="#ISSUE_FILE#"+r.slug;t=(r.isImage?"!":"")+"["+s+"]("+c+")";var f=apex.item(i),g=f.getValue();f.setValue(g+t)}e("#issueTimeline").trigger("apexrefresh")}}))}})}}}(apex.jQuery);
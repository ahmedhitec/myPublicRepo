!function(t,e,n,i,s){"use strict";var o="a-GridLayout",r="a-GridLayout-pageItem",a="a-GridLayout-region",l="a-GridLayout-button",h="a-GridLayout-buttonContainer",p=".a-GridLayout-buttonGroup,.a-GridLayout-regionContent",d=".a-GridLayout-buttonRow",c="a-GridLayout--conditional",u="a-GridLayout-items",f="a-GridLayout-regions",m="a-GridLayout-buttons",g="a-GridLayout-grid",y=".a-GridLayout-grid",v="a-GridLayout-stack",_="a-GridLayout-flow",C=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",w=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",b=".a-GridLayout-regionContainer, .a-GridLayout-itemContainer, .a-GridLayout-buttonContainer",P=".a-GridLayout-grid, .a-GridLayout-stack, .a-GridLayout-flow",k={regionContainer:["a-GridLayout-regionContainer",f],itemContainer:["a-GridLayout-itemContainer",u],buttonContainer:[h,m]},G={region:a,item:r,button:l},L=[50,75,100,125,150,175,200];function x(t,e,n){return t>e&&t<e+n}function I(t){return t.parent().children(":visible").index(t)}function D(t,e,n,i){var s,o;"string"!=typeof e&&(i=n,n=e,e="*"),(o=(s=t.children(e)).index(n))>=0&&o<i&&(i+=1),i>=s.length?t.append(n):s.eq(i).before(n)}function R(t){var e,n=t||"";if(!((e=n.indexOf("_"))<0))return n.substring(e+1)}function S(t,e){var n;for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function O(t){var e=0;return t.parent().children().each((function(){if(this===t[0])return!1;e+=this.colSpan||1})),e}function T(t,e,n,i){var s=e[n];s!==i&&(t.propertyChanges.push({component:e,property:n,oldValue:s,newValue:i}),e[n]=i)}function N(t,e,n,i){var s,o,r;if(n<0&&(n=0),i>0)for(0===(r=Math.floor(n/i))&&(r=1),s=e;s<t.length;s++)-1===(o=t[s]).span&&(o.span=r,(n-=r)>0&&n<r&&(o.span+=n))}function A(t,e){var n,i,s,o=e,r=0,a=0,l=0,h=1;for(n=0;n<t.columns.length;n++)(s=t.columns[n]).col>1&&(i=s.col-h,N(t.columns,r,i-a,l),o-=i,r=n,a=0,l=0,h=s.col),s.span>0?a+=s.span:l+=1;N(t.columns,r,o-a,l)}function F(t,e,n){var i;for(i in n)n.hasOwnProperty(i)&&e[i]&&(t+=" "+n[i]);return t}function E(t,e){var n;for(n in e)if(e.hasOwnProperty(n)&&t[n])return e[n];return null}function H(t,e){return t.types.indexOf(e)>=0}function M(t,e){var n,i="";for(n=0;n<t.length;n++)n>0&&(i+=" "),i+=k[t[n]][e];return i}function W(t){var e="";return t.hasClass(f)&&(e+=",."+a),t.hasClass(u)&&(e+=",."+r),t.hasClass(m)&&(e+=",."+l),e.substr(1)}function q(t){var e="",n=t.closest(b);return n.hasClass("a-GridLayout-regionContainer")&&(e+=" "+f),n.hasClass("a-GridLayout-itemContainer")&&(e+=" "+u),n.hasClass(h)&&(e+=" "+m),e.substr(1)}t.widget("apex.gridlayout",t.ui.mouse,{version:"18.1",widgetEventPrefix:"gridlayout",dragging:!1,animating:!1,nodeMap:{},nextId:1,dragComponent:null,helper:null,fromOutside:!1,isOver:!1,lastZoom:"",pageRoot:null,options:{getPageRoot:null,getIconForComponent:function(t){var e="",n=t.type;return"region"===n?e="region":"item"===n?e="page-item":"button"===n?e="button":"page"===n&&(e="page"),e},makeComponent:null,updateComponentCopy:null,deleteKeyAction:null,contextMenuAction:null,stateClassMap:{},stateIconMap:{},displayFrom:null,hideLegacyDisplayPoints:!1,hideEmptyDisplayPoints:!1,hideButtons:!1,hideItems:!1,zoom:100,iconType:"a-GIcon",appendTo:"parent",containment:!1,cursor:"auto",cursorAt:!1,gridTolerance:10,idPrefix:null,multiple:!0,opacity:!1,animate:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:20,tolerance:"intersect",zIndex:1e3,activate:null,deactivate:null,out:null,over:null,start:null,beforeStop:null,stop:null,selectionChange:null,added:null,removed:null,moved:null,copied:null},_create:function(){var e=this.options,n=this;if(!e.makeComponent||!e.updateComponentCopy||!e.getPageRoot)throw"Missing required options.";this.pageRoot=e.getPageRoot(),this.containerCache={},this.element.addClass(o),this.baseId=(e.idPrefix||this.element[0].id||"glv")+"_",this.refresh(!1),this._setZoom(),this.offset=this.element.offset(),this._mouseInit(),this.element.on("keydown.glv",(function(i){var s=t.ui.keyCode,o=i.which;i.altKey||(o===s.HOME?(n._select(t(".a-GridLayout-page:first"),i,!0,!0),i.preventDefault()):o===s.END?(n._select(n.element.find(w).last(),i,!0,!0),i.preventDefault()):o===s.DOWN?(n._traverseDown(i),i.preventDefault()):o===s.UP?(n._traverseUp(i),i.preventDefault(),i.stopPropagation()):o===s.LEFT?(n._traverseLeft(i),i.preventDefault()):o===s.RIGHT?(n._traverseRight(i),i.preventDefault()):o===s.SPACE?(n.lastFocused&&n._select(t(n.lastFocused),i,!0,!0),i.preventDefault()):e.deleteKeyAction&&o===s.DELETE?(n.lastFocused&&e.deleteKeyAction(i),i.preventDefault()):e.contextMenuAction&&i.shiftKey&&121===o&&(n.lastFocused&&!t(n.lastFocused).is(".is-selected")&&n._select(t(n.lastFocused),{},!1,!0),e.contextMenuAction(i),i.preventDefault()))})).on("focusin",(function(e){var i=t(e.target).closest(w);0!==i.length&&(i.addClass("is-focused"),n._setFocusable(i[0]))})).on("focusout",(function(e){t(e.target).closest(w).removeClass("is-focused")})).on("contextmenu",(function(i){var s;e.contextMenuAction&&((s=t(i.target).closest(w).not(".is-selected")).length&&n._select(s,{},!1,!1),e.contextMenuAction(i),i.preventDefault())}))},_destroy:function(){return this.element.removeClass(o).empty(),this._mouseDestroy(),this},_setOption:function(e,n){"disabled"===e?(this.options[e]=n,this.widget().toggleClass("is-disabled",!!n)):t.Widget.prototype._setOption.apply(this,arguments),"displayFrom"===e?this.refresh(!1):"hideLegacyDisplayPoints"===e||"hideButtons"===e||"hideItems"===e||"hideEmptyDisplayPoints"===e?this._showOrHideDisplayPoints():"zoom"===e&&this._setZoom()},pageDataChanged:function(){var t=this.options;this.pageRoot=this.options.getPageRoot(),t.displayFrom&&(this._find(t.displayFrom,!0)||(t.displayFrom=null)),this.refresh(!1)},getPageData:function(){return this.pageRoot},refresh:function(t){var i,s,o,r,a,l,h,p=this.options,d=e.htmlBuilder();if(n.info("Gridlayout refresh"),!t)for(a=[],r=this.getSelectedComponents(),i=0;i<r.length;i++)a.push(r[i].id);if(this._layoutPage(),this.nodeMap={},p.displayFrom){if(!(s=this._find(p.displayFrom,!0)))throw"No such region in displayFrom option: "+p.displayFrom;for(l=!0,h=s._parent;h;){if(h.components&&!h.isGrid){l=!1;break}h=h._parent}this._renderRegion(d,s,l,!0)}else this._renderPage(d,this.pageRoot);return this.element.html(d.toString()),this._showOrHideDisplayPoints(),o=this.element.children().eq(0),t?(this._select(o,t),this._trigger("selectionChange")):(this._setFocusable(o[0]),a.length>0&&this.element.is(":visible")&&(this.setSelectedComponents(a,!1),a.length!==this.getSelection().length&&this._trigger("selectionChange"))),this},dump:function(){n.log("Page: \r\n"+JSON.stringify(this.pageRoot,(function(t,e){return"_parent"===t?"-> "+(this._parent.id||this._parent.title):"_modelComponent"===t?"[id="+e.id+"]":"_parentGrid"===t?"-> "+S(this._parentGrid._parent._grids,this._parentGrid):"_parentRow"===t?"-> "+S(this._parentRow._parentGrid.rows,this._parentRow):"_parentColumn"===t?"-> "+S(this._parentColumn._parentRow.columns,this._parentColumn):e}),2))},findById:function(e){var n=this._find(e);return n?this._getElement(n):t()},findComponentById:function(t){return this._find(t)},getContainer:function(t){return t.closest(b)},findContainer:function(t,e){var n,i,s,o=this.pageRoot;if(i=o.id===t?o:this._find(t,!0))for(n=0;n<i.displayPoints.length;n++)if((s=i.displayPoints[n]).id===e)return s;return null},getComponents:function(t){var e=this,n=[];return t.each((function(){n.push(e._getNode(this))})),n},getSelection:function(){return this.element.find(".is-selected")},getSelectedComponents:function(){return this.getComponents(this.getSelection())},setSelection:function(t,e){e=!!e,this._select(t,null,e,!1,!0)},setSelectedComponents:function(e,n){var i,s,o,r=[];for(n=!!n,i=0;i<e.length;i++)(s=this._find(e[i]))&&(o=this._getElement(s)).length>0&&r.push(o[0]);this._select(t(r),null,n,!1,!0)},focus:function(){this.lastFocused&&this.lastFocused.focus()},makeHelper:function(n,i,s,o){var r,a,l=this.options.getIconForComponent,h=new e.htmlBuilder;return n||(n=(r=this._getNode(this.dragComponent[0])).type,i=l(r),s=r.title),a=G[n]+" a-GridLayout-helper",h.markup("<div").attr("class",a).optionalAttr("data-type-id",o).markup(">"),this._renderHeader(h,i,s,!0),h.markup("<div").attr("class","a-GridLayout-dragAction").markup("></div></div>"),t(h.toString())},getDropTargets:function(e,n){var s,o,h,p,c,y,C,w,P=[];function k(n){h=n,t(this).children().eq(0).children(c).each((function(n){C&&this===e[0]?y=!0:s.items.push({element:t(this),row:o,col:h,index:n,name:t(this).children("h3").text()})}))}function G(e){o=e,t(this).children("td").each(k)}if(C="move"===(n=n||"move"),"add"===n&&"string"==typeof e&&(w=e),"item"===w||!w&&e.hasClass(r))p=u;else if("region"===w||!w&&e.hasClass(a))p=f;else{if("button"!==w&&(w||!e.hasClass(l)))throw"Invalid component or component type";p=m}return c="."+c,t(p="."+p,this.element).filter(":visible").each((function(){var n,o,r,a,l,h=t(this),p=null;c=W(h),h.hasClass(g)?o="grid":h.hasClass(v)?o="stack":h.hasClass(_)&&(o="flow"),"stack"===o&&"TD"===h.parent()[0].nodeName||C&&0!==h.parents().filter(e[0]).length||(l="",""!==(a=h.parent().closest(".a-GridLayout-region").find(".a-GridLayout-label").eq(0).text())&&(l=a+" > "),"flow"===o&&"TD"===h.parent()[0].nodeName?(r=h.closest(d).prev().text(),h.parent().next().length>0?(r=i.formatMessageNoEscape("GL.BTN_POS_L",r),p="left"):(r=i.formatMessageNoEscape("GL.BTN_POS_R",r),p="right")):r=h.prev().text(),l+=r,s={element:h.closest(b),type:o,region:a,name:r,label:l},y=!1,"grid"===o?(s.items=[],h.children("tbody").children("tr").each(G)):(s.items=[],p&&(s.alignment=p),h.children(c).each((function(i){C&&this===e[0]?y=!0:(n={element:t(this),index:i,name:t(this).children("h3").text()},p&&(n.alignment=p),s.items.push(n))}))),y&&0===s.items.length||P.push(s))})),P},update:function(i,s,o){var r,a,l,h,p,d,u=this.options,f=!1;if("string"==typeof i&&(i=this._find(i)),!i)throw"Nothing to update";if(n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout update component: "+i.title+", layoutChange: "+s+", childrenOnly: "+o),s&&(o&&!i._parent||(i=i._parent._parent),f="page"===i.type||t.isArray(i._parent._grids),this._layoutDisplayPoints(i.displayPoints,i,f,12)),(l=this._getElement(i)).length)if(s)p=this.getSelectedComponents(),a=e.htmlBuilder(),"page"===i.type?this._renderPage(a,i):this._renderComponent(a,i,f),h=t(a.toString()),l.hasClass("is-selected")&&h.addClass("is-selected"),h[0].tabIndex=l[0].tabIndex,l.replaceWith(h),this._showOrHideDisplayPoints(h),this.setSelectedComponents(p);else{for(r in l.find(".a-GridLayout-label").first().html(e.escapeHTML(i.title)),l.toggleClass(c,!!i.isConditional),u.stateClassMap)u.stateClassMap.hasOwnProperty(r)&&l.toggleClass(u.stateClassMap[r],!!i[r]);l.find("."+u.iconType)[0].className=u.iconType+" "+u.getIconForComponent(i),(d=E(i,u.stateIconMap))&&l.find(".a-GridLayout-label").first().prepend("<span class='a-Icon "+d+"'></span>")}},add:function(t,e,i,s,o,r,a,l,h){var p,d,c;if("string"!=typeof e&&"number"!=typeof e||(d=e,e=this.options.makeComponent(d)),!(i=this._getContainerElement(i))||!i.is(b))throw"Invalid add destination";return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout add component: "+e.title+" to: "+i[0].id+", g/r/c/i: "+s+"/"+o+"/"+r+"/"+a),c=(p=this._add(e,i,s,o,r,a,l,h)).newComponent$,p.lastChange=!0,this._trigger("added",t,p),this._select(c,t,!0),this},remove:function(e,i){var s,o,r,a,l,h=[],p=t(this.lastFocused).hasClass("is-focused"),d=this;if(n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout remove "+(i?i.length+" component(s).":"selection")),i=i||this.getSelection(),t.isArray(i)){for(a=[],s=0;s<i.length;s++)(l=this.findById(i[s])).length>0&&a.push(l[0]);i=t(a)}if(!i||0===i.filter(C).length)throw"Nothing to remove";for(r=i.filter(".is-selected").eq(0);r&&r.length&&r.hasClass("is-selected")&&!r.is(".a-GridLayout-page");)(r=t(this._traverseUp(e,!0)))&&(this.lastFocused=r[0]);for(i.filter(C).each((function(){var e;(e=d._getNode(this))&&(n.info("Gridlayout remove component: "+e.title),o=d._remove(t(this)),h.push(o))})),s=0;s<h.length;s++)h[s].lastChange=s>=h.length-1,d._trigger("removed",e,h[s]);return r&&r.length&&this._select(r,e,p),this},move:function(e,i,s,o,r,a,l,h){var p,d;if(i=i||t(this.lastFocused),!(i=this._getComponentElement(i))||!i.is(C))throw"Nothing to move";if(!(s=this._getContainerElement(s))||!s.is(b))throw"Invalid move destination";return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout move component: "+this._getNode(i[0]).title+" to: "+s[0].id+", g/r/c/i: "+o+"/"+r+"/"+a+"/"+l),d=(p=this._moveOrCopy(i,s,o,r,a,l,h,!1)).newComponent$,p.lastChange=!0,this._trigger("moved",e,p),this._select(d,e,!0),this},copy:function(e,i,s,o,r,a,l,h){var p,d;if(i=i||t(this.lastFocused),!(i=this._getComponentElement(i))||!i.is(C))throw"Nothing to copy";if(!(s=this._getContainerElement(s))||!s.is(b))throw"Invalid copy destination";return n.getLevel()>=n.LOG_LEVEL.INFO&&n.info("Gridlayout copy component: "+this._getNode(i[0]).title+" to: "+s[0].id+", g/r/c/i: "+o+"/"+r+"/"+a+"/"+l),d=(p=this._moveOrCopy(i,s,o,r,a,l,h,!0)).newComponent$,p.lastChange=!0,this._trigger("copied",e,p),this._select(d,e,!0),this},_layoutGrid:function(t,e,n,i){var s,o,r,a,l,h,p,d,c,u,f=this.pageRoot,m=null,g={},y=0,v=null,_=null,C=null,w=0;if(n)for(m=[],a=0;a<t.length;a++)if(l=t[a],(!v||n&&"fixed"!==f.gridType&&l.newGrid)&&(v={_parent:e,rows:[]},_=null,m.push(v)),(!_||n&&l.newRow)&&(_={_parentGrid:v,columns:[]},C=null,v.rows.push(_),g={}),n&&l.col>0)if(g.hasOwnProperty(l.col))_.columns[g[l.col]].components.push(l),l._parentColumn=_.columns[g[l.col]];else if(C={_parentRow:_,col:l.col,span:f.hasColumnSpan?l.span||-1:1,rowSpan:l.rowSpan,components:[l]},l._parentColumn=C,_.columns.push(C),w=_.columns.length-1,l.col<y){for(p=w,h=l.col+1;h<=y;h++)g.hasOwnProperty(h)&&(g[h]<p&&(p=g[h]),g[h]+=1);p!==w&&(d=w,c=p,u=void 0,u=_.columns.splice(d,1),_.columns.splice(c,0,u[0])),g[l.col]=p}else y=l.col,g[l.col]=w;else(!C||n&&l.newCol)&&(C={_parentRow:_,col:-1,span:f.hasColumnSpan?l.span||-1:1,rowSpan:l.rowSpan,components:[]},_.columns.push(C)),C.components.push(l),l._parentColumn=C;if(n&&"fixed"===f.gridType&&f.hasColumnSpan)for(s=0;s<m.length;s++)for(v=m[s],o=0;o<v.rows.length;o++)A(_=v.rows[o],i);if(m)for(s=0;s<m.length;s++)for(v=m[s],o=0;o<v.rows.length;o++)for(_=v.rows[o],r=0;r<_.columns.length;r++)C=_.columns[r];for(a=0;a<t.length;a++)(l=t[a])._parent=e,l.displayPoints&&this._layoutDisplayPoints(l.displayPoints,l,n,i);return m},_layoutDisplayPoints:function(t,e,n,i){var s,o,r=this.pageRoot,a=0;for(s=0;s<t.length;s++){if((o=t[s])._parent=e,o.hasOwnProperty("span")||o.hasOwnProperty("newColumn")){if(!0===o.newGrid&&(delete o.newRow,delete o.newColumn),!0===o.newRow&&delete o.newColumn,!0!==o.newRow&&!0!==o.newGrid||(a=0),o.span=o.span||1,!1!==o.newColumn&&(a+=o.span),"fixed"===r.gridType&&a>i)throw"Fixed layout template grid exceeded max columns. Display point: "+o.title;if(n&&o.isGrid&&!o.maxColumns&&("fixed"!==r.gridType||r.alwaysUseMaxColumns?o.maxColumns=i:o.maxColumns=o.span),o.isGrid&&"fixed"===r.gridType&&!r.alwaysUseMaxColumns&&o.span!==o.maxColumns)throw"Fixed layout span and maxColumns must be the same. Display point: "+o.title}else a=0,n&&o.isGrid&&!o.maxColumns&&(o.maxColumns=i);if(o.hasRowSpan&&!r.hasRowSpan)throw"Row span not allowed for display point when page doesn't support row span. Display point: "+o.title;o._grids=this._layoutGrid(o.components,o,n&&o.isGrid,o.maxColumns||i)}},_layoutPage:function(){var t=this.pageRoot;this._layoutDisplayPoints(t.displayPoints,t,!0,t.maxColumns)},_showOrHideDisplayPoints:function(e){var n,i=this.options,s=this;(e=e||this.element).find(".a-GridLayout-regionContainer").each((function(){var e=s._getNode(this);!i.hideEmptyDisplayPoints&&t(this).is(".a-GridLayout--legacy")?t(this).toggle(!i.hideLegacyDisplayPoints||0!==e.components.length):t(this).toggle(!i.hideEmptyDisplayPoints||0!==e.components.length)})),e.find(".a-GridLayout-buttonContainer").each((function(){var e=s._getNode(this);(n=!(i.hideButtons||i.hideEmptyDisplayPoints&&0===e.components.length))&&e.isLegacy&&(n=!i.hideLegacyDisplayPoints||0!==e.components.length),t(this).toggle(n)})),e.find(".a-GridLayout-itemContainer").each((function(){var e=s._getNode(this);(n=!(i.hideItems||i.hideEmptyDisplayPoints&&0===e.components.length))&&e.isLegacy&&(n=!i.hideLegacyDisplayPoints||0!==e.components.length),t(this).toggle(n)})),i.hideEmptyDisplayPoints},_find:function(t,e){var n=this.pageRoot;return!e&&n===t||n.id===t?n:function n(i){var s,o,r,a,l=null;for(s=0;s<i.length;s++)if(r=i[s],!e||H(r,"regionContainer"))for(o=0;o<r.components.length;o++){if((a=r.components[o])===t||a.id===t)return a;if(a.displayPoints&&(l=n(a.displayPoints)))return l}return l}(n.displayPoints)},_getComponentElement:function(t){return"string"==typeof t?this.findById(t):t._elementId?this._getElement(t):t},_getContainerElement:function(e){var n;return t.isArray(e)?(n=this.findContainer(e[0],e[1]))?this._getElement(n):null:e._elementId?this._getElement(e):e},_addNode:function(t){var e=this.nextId;return this.nodeMap[this.nextId]=t,t._elementId=this.nextId,this.nextId+=1,this.baseId+e},_setNode:function(t){if(!t._elementId)throw"Failed to add node to nodeMap - no id";this.nodeMap[t._elementId]=t},_getNode:function(t){var e=R(t.id);return this.nodeMap[e]},_getElement:function(e){var n=this.baseId+e._elementId;return t("#"+n)},_renderHeader:function(t,e,n,i,s){t.markup("<h3").optionalAttr("class",null!==i?"is-draggable":null).optionalAttr("aria-grabbed",null!==i?""+i:null).markup("><span").attr("class",this.options.iconType+" "+e).markup("></span><span").attr("class","a-GridLayout-label").markup(">"),s&&t.markup("<span class='a-Icon ").attr(s).markup("'></span>"),t.content(n).markup("</span></h3>")},_renderRegion:function(t,e,n,i){var s,o=a;e.isConditional&&(o+=" "+c),o=F(o,e,this.options.stateClassMap),s=E(e,this.options.stateIconMap),t.markup("<div").attr("class",o).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!(!i&&!e.isReadOnly)&&null,s),this._renderDisplayPoints(t,e.displayPoints,n,e.itemsAboveContent),t.markup("</div>")},_renderItem:function(t,e){var n,i=r;e.isConditional&&(i+=" "+c),i=F(i,e,this.options.stateClassMap),n=E(e,this.options.stateIconMap),t.markup("<div").attr("class",i).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!!e.isReadOnly&&null,n),t.markup("</div>")},_renderButton:function(t,e){var n,i=l;e.isConditional&&(i+=" "+c),i=F(i,e,this.options.stateClassMap),n=E(e,this.options.stateIconMap),t.markup("<div").attr("class",i).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,!!e.isReadOnly&&null,n),t.markup("</div>")},_renderComponentsInGrid:function(t,e,n,i){var s,o,r,a,l,h,p,d,c,u,f=this.pageRoot.gridType;function m(){for(t.markup("<thead><tr>"),s=0;s<e.maxColumns;s++)t.markup("<td></td>");t.markup("</tr></thead>")}if(i.length>0)for(o=0;o<i.length;o++){for(d=i[o],t.markup("<table role='presentation'").attr("class",g+" "+n+(0===o?" first":"")).markup(">"),"fixed"===f&&m(),t.markup("<tbody>"),r=0;r<d.rows.length;r++){for(c=d.rows[r],t.markup("<tr>"),p=1,a=0;a<c.columns.length;a++){for((u=c.columns[a]).col>p&&(t.markup("<td").attr("colspan",u.col-p).markup("><div").attr("class",v+" "+n).markup("></div></td>"),p=u.col),p+=u.span>0?u.span:1,t.markup("<td").optionalAttr("colspan",u.span).optionalAttr("rowspan",u.rowSpan).markup("><div").attr("class",v+" "+n).markup(">"),l=0;l<u.components.length;l++)h=u.components[l],this._renderComponent(t,h,!0);t.markup("</div></td>")}t.markup("</tr>")}t.markup("</tbody></table>")}else t.markup("<table role='presentation'").attr("class",g+" first "+n).markup(">"),"fixed"===f&&m(),t.markup("<tbody><tr><td><div").attr("class",v+" "+n).markup("></div></td></tr></tbody></table>")},_renderComponent:function(t,e,n){if("region"===e.type)this._renderRegion(t,e,n);else if("item"===e.type)this._renderItem(t,e);else{if("button"!==e.type)throw"Unknown component type";this._renderButton(t,e)}},_renderComponents:function(t,e,n,i){var s,o;if(t.markup("<div").attr("class",e).markup(">"),n&&n.length>0)for(s=0;s<n.length;s++)o=n[s],i&&o.alignment!==i||this._renderComponent(t,o,!1);t.markup("</div>")},_renderDisplayPoints:function(t,e,n,s){var o,r,a,l,h,p=this,d=null,c=!1,u=!1,f=!1;function m(){var e;h=i.getMessage("GL.REGION_CONTENT"),t.markup("<div").attr("class","a-GridLayout-regionContent").markup("><h3>").content(h).markup("</h3>"),d&&(e=d.types[0],t.markup("<div").attr("class",k[e][0]).attr("id",p._addNode(d)).markup(">"),t.markup("<h3>").content(d.title).markup("</h3>"),p._renderComponents(t,_+" "+k[e][1],d.components),t.markup("</div>")),t.markup("</div>")}for(o=0;o<e.length;o++){if((r=e[o]).hasOwnProperty("span")||r.hasOwnProperty("newColumn")?(f&&!1!==r.newColumn&&(t.markup("</td>"),f=!1),u?!0===r.newGrid&&t.markup("</tr></tbody></table><table role='presentation'").attr("class","a-GridLayout-templateGrid").markup("><tbody><tr>"):(t.markup("<table role='presentation'").attr("class","a-GridLayout-templateGrid").markup("><tbody><tr>"),u=!0,r.newColumn=!0),!0===r.newRow&&t.markup("</tr><tr>"),!1!==r.newColumn&&(t.markup("<td colspan='"+r.span+"'>"),f=!0)):u&&(t.markup("</tr></tbody></table>"),u=!1),r.types.length>1||H(r,"regionContainer")||H(r,"itemContainer"))c&&(t.markup("</div>"),c=!1);else if("buttonContainer"===r.types[0]){if("RIGHT_OF_IR_SEARCH_BAR"===r.id){d=r;continue}c?r.hasAlignment&&(t.markup("</div>"),c=!1):r.hasAlignment||(t.markup("<div").attr("class","a-GridLayout-buttonGroup").markup(">"),c=!0)}if(H(r,"itemContainer")&&"BODY"===r.id&&!s&&m(),a=M(r.types,0),r.isLegacy&&(a+=" a-GridLayout--legacy"),l=M(r.types,1),t.markup("<div").attr("class",a).attr("id",this._addNode(r)).markup(">"),t.markup("<h3>").content(r.title).markup("</h3>"),r.types.length>1||H(r,"regionContainer")||H(r,"itemContainer"))r.isGrid&&n?this._renderComponentsInGrid(t,r,l,r._grids):this._renderComponents(t,v+" "+l,r.components);else{if("buttonContainer"!==r.types[0])throw"Unknown display point type: "+r.types[0];r.hasAlignment?(t.markup("<table role='presentation'").attr("class","a-GridLayout-buttonRow").markup("><tbody><tr><td>"),this._renderComponents(t,_+" "+l,r.components,"left"),t.markup("</td><td>"),this._renderComponents(t,_+" "+l,r.components,"right"),t.markup("</td></tr></tbody></table>")):this._renderComponents(t,_+" "+l,r.components)}t.markup("</div>"),H(r,"itemContainer")&&"BODY"===r.id&&s&&m()}c&&t.markup("</div>"),u&&t.markup("</tr></tbody></table>")},_renderPage:function(t,e){var n,i="a-GridLayout-page";e.isConditional&&(i+=" "+c),i=F(i,e,this.options.stateClassMap),n=E(e,this.options.stateIconMap),t.markup("<div").attr("class",i).attr("id",this._addNode(e)).markup(" tabindex='-1'>"),this._renderHeader(t,this.options.getIconForComponent(e),e.title,null,n),this._renderDisplayPoints(t,e.displayPoints,!0),t.markup("</div>")},_setFocusable:function(t){this.lastFocused&&this.lastFocused!==t&&(this.lastFocused.tabIndex=-1),t.tabIndex=0,this.lastFocused=t},_select:function(e,n,i,s,o){var r,a,l,h,p,d,c="set",u=this;e=e.filter(":visible"),n&&this.options.multiple&&("mousedown"===n.type?n.ctrlKey||n.metaKey?c="toggle":n.shiftKey&&(c="add"):"keydown"===n.type&&(n.keyCode===t.ui.keyCode.SPACE?c="toggle":n.ctrlKey?c="none":n.shiftKey&&(c="add"))),r=this.element.find(".is-selected"),"set"===c&&r.removeClass("is-selected").removeAttr("aria-selected"),a=e.hasClass("is-selected"),"set"===c||"add"===c||"toggle"===c&&!a?e.addClass("is-selected").attr("aria-selected",!0):"toggle"===c&&a&&e.removeClass("is-selected").removeAttr("aria-selected"),e.length>0&&(i?(e[0].tabIndex=0,e[0].focus()):this._setFocusable(e[0]),(p=(h=this.element.scrollParent())[0]===document?{left:0,top:0}:h.offset())&&(d=this.element.offset(),((l=e.first().offset()).top<p.top||l.top>p.top+h[0].offsetHeight)&&(h[0].scrollTop=l.top-d.top),(l.left+e[0].offsetWidth<p.left||l.left>p.left+h[0].offsetWidth)&&(h[0].scrollLeft=l.left-d.left))),o||("toggle"===c||"add"===c&&!a||"set"===c&&(r[0]!==e[0]||r.length!==e.length))&&(u.triggerTimerId&&(clearTimeout(u.triggerTimerId),u.triggerTimerId=null),u.triggerTimerId=setTimeout((function(){u.triggerTimerId=null,u._trigger("selectionChange",n)}),s?350:1))},_traverseRight:function(e){var n,i,s=null;if(this.lastFocused)if((n=t(this.lastFocused)).parent().hasClass(_))this._traverseDown(e);else{for(i=n.closest("td");i.length;){if((n=i.next().find(C).first()).length){s=n;break}i=i.parent().closest("td")}s&&s.length>0&&this._select(s.eq(0),e,!0,!0)}},_traverseLeft:function(e){var n,i,s=null;if(this.lastFocused)if((n=t(this.lastFocused)).parent().hasClass(_))this._traverseUp(e);else{for(i=n.closest("td");i.length;){if((n=i.prev().find(C).first()).length){s=n;break}i=i.parent().closest("td")}s&&s.length>0&&this._select(s.eq(0),e,!0,!0)}},_traverseDown:function(e){var n,i,s,o,r,a,l;if(this.lastFocused){if(s=t(this.lastFocused),e.which!==t.ui.keyCode.RIGHT&&(0===(l=s.closest(p)).length&&(l=s.closest("."+h)),l.length>0&&(s=l.find(C).last())),(o=s.find(C).filter(":visible").first()).length>0)s=o;else if((o=s.nextAll(":visible").first()).length>0)s=o;else if(s.closest(d).length>0&&(o=s.closest("td").next().find(C).filter(":visible").first()),o.length>0)s=o;else for(;s.length>0;){if((o=s.nextAll(C).filter(":visible").first()).length>0){s=o;break}if((o=s.nextAll(":visible").find(C).filter(":visible").first()).length>0){s=o;break}if((r=s.parent().parent().parent("tr").first().next().first()).length>0&&(a=r.prev()[0],n=O(s.parents("td").filter((function(){return this.parentNode===a}))),i=0,r.children().each((function(){if((i+=this.colSpan||1)>n)return o=t(this).find(C).first(),!1})),0===o.length&&(o=r.children().last().find(C).first())),o.length>0){s=o;break}s=s.parent().closest(C+","+b+","+p)}s&&s.length>0&&this._select(s,e,!0,!0)}},_traverseUp:function(e,n){var i,s,o,r,a,l,c;if(this.lastFocused&&(o=t(this.lastFocused),e.which!==t.ui.keyCode.LEFT&&(0===(c=o.closest(p)).length&&(c=o.closest("."+h)),c.length>0&&(o=c.find(C).first())),(r=o.prevAll(":visible").first()).length>0?0===(o=r.find(C).filter(":visible").last()).length&&(o=r):((a=o.closest("tr").prev()).length>0&&(i=O(o.closest("td")),s=0,a.children().each((function(){if((s+=this.colSpan||1)>i)return r=t(this).find(C).filter(":visible").last(),!1})),0===r.length&&(r=a.children().last().find(C).filter(":visible").last())),r.length>0?o=r:(o.closest(d).length>0&&(r=o.closest("td").prev().find(C).filter(":visible").last()),0===r.length&&(l=c&&c.length>0?c:o.parent().closest(b),0===(r=l.prevAll(":visible").find(C).filter(":visible").last()).length&&l.parent().is(p)&&(l=l.parent(),r=l.prevAll(":visible").find(C).filter(":visible").last())),o=0===r.length?o.parent().closest(w):r)),o&&o.length>0)){if(n)return o[0];this._select(o,e,!0,!0)}},_setZoom:function(){var t,e,n=1*this.options.zoom;for(t=0;t<L.length;t++)if(n<=L[t]){n=L[t];break}t>=L.length&&(n=L[L.length-1]),e=o+"--z"+n,this.element.removeClass(this.lastZoom).addClass(e),this.lastZoom=e},_mouseCapture:function(e,n){var i,s=null;return!this.animating&&!this.options.disabled&&("H3"===e.target.nodeName?i=t(e.target):"H3"===e.target.parentNode.nodeName&&(i=t(e.target.parentNode)),i&&i.length&&(s=i.parent(w)),s&&s.length&&!n&&this._select(s,e,!0,!1),i&&i.length&&(s=i.parent(C)),!(!(i&&i.is(".is-draggable")&&s&&1===s.length)||s.parent().hasClass(o))&&(this.dragComponent=s,this._initDragTargets(this.dragComponent),!0))},_mouseStart:function(e,n,i){var s,o,r,a=this.options,l=this;return i||(t("body").on("keydown.glv",(function(e){e.keyCode!==t.ui.keyCode.ESCAPE?l._dragCopyOrMove(e.ctrlKey):l._cancel(e)})),t("body").on("keyup.glv",(function(t){l._dragCopyOrMove(t.ctrlKey)}))),this.helper||(this.helper=this._createHelper()),this.margins={left:parseInt(this.dragComponent.css("marginLeft"),10)||0,top:parseInt(this.dragComponent.css("marginTop"),10)||0},this.scrollParent=this.helper.scrollParent(),this.offset=this.dragComponent.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:n.pageX-this.offset.left,top:n.pageY-this.offset.top},parent:this._getParentOffset()}),this.helper.css("position","absolute"),this._cacheHelperProportions(),this.originalPosition=this._generatePosition(n),a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.dragging=!0,o=this.dragComponent.children("h3").outerHeight(),this.dragComponent.hide(),this._createPlaceholder(o),r=this.placeholder.offset().top,this._initTargetContainers(),(r=this.placeholder.offset().top-r)>0&&(this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop+r),this._refreshPositions(),a.containment&&this._setContainment(),i||a.cursor&&"auto"!==a.cursor&&(s=t("body"),this.storedCursor=s.css("cursor"),s.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(s)),a.opacity&&this.helper.css("opacity",a.opacity),a.zIndex&&this.helper.css("zIndex",a.zIndex),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",n,this._uiHashDnD()),this._mouseDrag(n),!0},_mouseDrag:function(e){var n,i,s,o,r,a,l,h,p,d,c,u,f=0,m=0,g=this.options,y=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._adjustPositionForScroll(),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop+g.scrollSpeed:e.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop-g.scrollSpeed),m=this.scrollParent[0].scrollTop-this.dropPositionsOrigin.y,this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=this.scrollParent[0].scrollLeft+g.scrollSpeed:e.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=this.scrollParent[0].scrollLeft-g.scrollSpeed),f=this.scrollParent[0].scrollLeft-this.dropPositionsOrigin.x):(e.pageY-t(document).scrollTop()<g.scrollSensitivity?t(document).scrollTop(t(document).scrollTop()-g.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<g.scrollSensitivity&&t(document).scrollTop(t(document).scrollTop()+g.scrollSpeed),m=t(document).scrollTop()-this.dropPositionsOrigin.y,e.pageX-t(document).scrollLeft()<g.scrollSensitivity?t(document).scrollLeft(t(document).scrollLeft()-g.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<g.scrollSensitivity&&t(document).scrollLeft(t(document).scrollLeft()+g.scrollSpeed),f=t(document).scrollLeft()-this.dropPositionsOrigin.x)),this.positionAbs=this._adjustPositionForScroll(),this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",this._dragCopyOrMove(e.ctrlKey),n=0;n<this.containers.length;n++)if(s=this.containers[n],a=this._intersectsWithPointer(s,null,f,m)){if("grid"===(u=s.type))for(c=this.positionAbs.top+this.offset.click.top+m,d=this.positionAbs.left+this.offset.click.left+f,l=0;l<s.rows.length;l++){if(x(c,(h=s.rows[l]).y-g.gridTolerance,2*g.gridTolerance)){y=this._movePlaceholder(s,null,"row",l);break}if(l<s.rows.length-1&&x(c,h.y,s.rows[l+1].y-h.y))for(p=0;p<h.columns.length;p++)if(x(d,h.columns[p]-g.gridTolerance,2*g.gridTolerance)){y=this._movePlaceholder(s,null,"column",l,p);break}}if(y)break;if(s.items)for(i=0;i<s.items.length;i++)if(o=s.items[i],a=this._intersectsWithPointer(o,u,f,m)){(r=o.element[0])!==this.dragComponent[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==r&&("pointer"===this.options.tolerance||this._intersectsWithSides(o,u))&&(y=this._movePlaceholder(s,o,1===a?"before":"after"));break}if(y)break;if("grid"!==s.type&&(y=this._movePlaceholder(s)),y)break;s!==this.curContainer&&(this.curContainer=s);break}return this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,n){if(n||t("body").off(".glv"),this._deactivate(),this.storedCursor&&(t("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),!e.target)return this.fromOutside=!1,void(this.dragging=!1);if(this.options.animate){var i=this,s=this.placeholder.offset(),o={};o.left=s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),o.top=s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop),this.animating=!0,t(this.helper).animate(o,parseInt(this.options.animate,10)||500,(function(){i._finishDrag(e)}))}else this._finishDrag(e);return!1},_initDragTargets:function(t){t.hasClass(r)?(this.targetClass=u,this.itemClass=r):t.hasClass(a)?(this.targetClass=f,this.itemClass=a):t.hasClass(l)&&(this.targetClass=m,this.itemClass=l)},_dragCopyOrMove:function(t){this.isOver||this.prevCopy===t||(t?(this.dragComponent.show(),this.helper.find(".a-GridLayout-dragAction").text(i.getMessage("GL.DRAG_COPY"))):(this.dragComponent.hide(),this.helper.find(".a-GridLayout-dragAction").text("")),this.prevCopy=t)},_cancel:function(e){this.dragging&&(this._mouseUp(t.Event("mouseup",{target:null})),this.dragComponent.show(),this._select(this.dragComponent,null,!0)),this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper&&this.helper[0].parentNode&&this.helper.remove(),this.helper=null,this.dragging=!1,this.animating=!1),this._trigger("stop",e,this._uiHashDnD())},_intersectsWith:function(t){var e=this.positionAbs.left,n=this.positionAbs.top,i=t.left,s=i+t.width,o=t.top,r=o+t.height,a=this.offset.click.top,l=this.offset.click.left,h="x"===this.options.axis||n+a>o&&n+a<r,p="y"===this.options.axis||e+l>i&&e+l<s;return h&&p},_intersectsWithPointer:function(t,e,n,i){var s=x(this.positionAbs.top+this.offset.click.top+i,t.top,t.height),o=x(this.positionAbs.left+this.offset.click.left+n,t.left,t.width),r=s&&o,a=this._getDragVerticalDirection(),l=this._getDragHorizontalDirection();return!!r&&("flow"===e&&l?"right"===l||"down"===a?2:1:a&&"down"===a?2:1)},_intersectsWithSides:function(t,e){var n=x(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=x(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return"flow"===e&&o?"right"===o&&i||"left"===o&&!i:s&&("down"===s&&n||"up"===s&&!n)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},_initTargetContainers:function(){var e,n=this,i="."+this.targetClass,s=t(i,this.element),o=null;this.helper&&(s=s.not(this.helper.find(i))),this.dragComponent&&(s=s.not(this.dragComponent.find(i)),o=this.dragComponent.closest(i)[0]),s.addClass("is-active"),this.containers=[],this.curContainer=null,s.each((function(){var i,s,r;(s=t(this)).hasClass(g)?i="grid":s.hasClass(v)?i="stack":s.hasClass(_)&&(i="flow"),e={element:s,type:i,name:t(this).prev().text(),width:0,height:0,left:0,top:0},n.containers.unshift(e),this===o&&(n.curContainer=e),"grid"===i?e.rows=[]:(e.items=[],r=W(s),s.children(r).each((function(){e.items.push({element:t(this),name:t(this).children("h3").text(),width:0,height:0,left:0,top:0})})))}))},_deactivate:function(){t("."+this.targetClass).removeClass("is-active")},_refreshPositions:function(){var e,n,i,s,o,r,a,l,h,p;function d(){h=t(this),o=h.offset(),a.columns.push(o.left)}function c(){l=t(this),o=l.offset(),a={y:o.top,columns:[]},i.rows.push(a),l.children("td").each(d),a.columns.push(o.left+h.outerWidth())}for(l=t(),e=0;e<this.containers.length;e++)if(s=(i=this.containers[e]).element,i.width=s.outerWidth(),i.height=s.outerHeight(),o=s.offset(),i.left=o.left,i.top=o.top,"grid"===i.type)i.rows=[],s.children("tbody").children("tr").each(c),i.rows.push({y:o.top+l.outerHeight()});else for(n=0;n<i.items.length;n++)s=(r=i.items[n]).element,r.width=s.outerWidth(),r.height=s.outerHeight(),o=s.offset(),r.left=o.left,r.top=o.top;this.dropPositionsOrigin={x:0,y:0},(p=this.element.scrollParent())[0]===document?p=this.element:this.dropPositionsOrigin={x:p[0].scrollLeft,y:p[0].scrollTop},o=p.offset(),this.containerCache.left=o.left,this.containerCache.top=o.top,this.containerCache.width=p.outerWidth(),this.containerCache.height=p.outerHeight()},_createPlaceholder:function(e){this.placeholder=t("<div class='a-GridLayout-placeholder'>&nbsp;</div>"),this.dragComponent.after(this.placeholder),e&&this.placeholder.height(e)},_createHelper:function(){var e=this.options,n=this.makeHelper();return n.parents("body").length||t("parent"!==e.appendTo?e.appendTo:this.element[0].parentNode)[0].appendChild(n[0]),n[0].style.width,n[0].style.height,n},_adjustOffsetFromHelper:function(t){"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var e;return this.offsetParent=this.helper.offsetParent(),e=this.offsetParent[0]===document||this.offsetParent[0]===document.firstElementChild?{left:0,top:0}:this.offsetParent.offset(),this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,i,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),"document"!==s.containment&&"window"!==s.containment||(this.containment=[0-this.offset.parent.left,0-this.offset.parent.top,t("document"===s.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===s.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(e=t(s.containment)[0],n=t(s.containment).offset(),i="hidden"!==t(e).css("overflow"),this.containment=[n.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,n.left+(i?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(i?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_generatePosition:function(e){var n=e.pageX,i=e.pageY,s=this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return this.originalPosition&&this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(i=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(i=this.containment[3]+this.offset.click.top)),{top:i-this.offset.click.top-this.offset.parent.top-(o?0:s.scrollTop()),left:n-this.offset.click.left-this.offset.parent.left-(o?0:s.scrollLeft())}},_adjustPositionForScroll:function(){var e=this.position,n=this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(n[0].tagName);return{top:e.top+this.offset.parent.top-(i?0:n.scrollTop()),left:e.left+this.offset.parent.left-(i?0:n.scrollLeft())}},_makeTempDragComponent:function(){var n,i,s=e.htmlBuilder();return s.markup("<div").attr("class",this.itemClass).markup("><h3 class='is-draggable'><span>&nbsp;</span></h3></div>"),n=t(s.toString()),!!(i=this.element.find("."+this.targetClass).not(y).filter(":visible").first()).length&&(i.append(n),this.dragComponent=n,!0)},_movePlaceholder:function(e,n,i,s,o){var r,a,l,h,p,d,c=null,u=null,f=!1;if(n)(r=n.element[0]).parentNode.insertBefore(this.placeholder[0],"before"===i?r:r.nextSibling),f=!0;else if(p=W(e.element),d=q(e.element),"grid"===e.type){if(a=e.element.children("tbody").children("tr"),"row"===i){if(s>=a.length?h=a.last().find(p).filter(":visible").length:(h=a.eq(s).find(p).filter(":visible").length)>0&&s>0&&(h=a.eq(s-1).find(p).filter(":visible").length),0===h)return!1;c=t("<tr><td><div class='"+v+" "+d+"'></div></td></tr>"),s>=a.length?a.last().after(c):a.eq(s).before(c),c.find("div").append(this.placeholder[0]),this.containers.unshift({element:c.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),f=!0}else if("column"===i){if(o>=(l=a.eq(s).children("td")).length?h=l.last().find(p).filter(":visible").length:(h=l.eq(o).find(p).filter(":visible").length)>0&&o>0&&(h=l.eq(o-1).find(p).filter(":visible").length),0===h)return!1;u=t("<td><div class='"+v+" "+d+"'></div></td>"),o>=l.length?l.last().after(u):l.eq(o).before(u),u.find("div").append(this.placeholder[0]),this.containers.unshift({element:u.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),f=!0}}else(!e.items||0===e.items.length||1===e.items.length&&e.items[0].element[0]===this.dragComponent[0])&&(e.element.append(this.placeholder[0]),f=!0);return e!==this.curContainer&&(this.curContainer=e),f&&(this.tempGridRow&&0===this.placeholder.closest(this.tempGridRow).length&&(this.tempGridRow.remove(),this.tempGridRow=null),c&&(this.tempGridRow=c),this.tempGridColumn&&0===this.placeholder.closest(this.tempGridColumn).length&&(this.tempGridColumn.remove(),this.tempGridColumn=null),u&&(this.tempGridColumn=u)),f&&this._refreshPositions(),f},_copyComponent:function(t,e){var n,i,s,o,r={};for(s in t)if(o=t[s],"displayPoints"===s)for(i=r.displayPoints=[],n=0;n<t.displayPoints.length;n++)i.push(this._copyComponent(t.displayPoints[n],r));else if("components"===s)for(i=r.components=[],n=0;n<t.components.length;n++)i.push(this._copyComponent(t.components[n],r));else"_parent"===s?r._parent=e:"_"!==s.substring(0,1)&&(r[s]=o);return this.options.updateComponentCopy(r,t),r},_insert:function(t,e,n,i,s,o,r){var a,l,h,p,d,c,u=this.pageRoot,f=t.component,m=t.newParentContainer;if("button"===f.type&&(T(t,f,"alignment",r),r&&(t.newAlignment=r)),e){for(-1===o||0===m._grids.length?(a={_parent:m,rows:[]},m._grids.splice(n,0,a),T(t,f,"newGrid",!0),t.newGridInserted=!0,o=-2):(T(t,f,"newGrid",!1),a=m._grids[n]),-2===o||i>=a.rows.length?(l={_parentGrid:a,columns:[]},a.rows.splice(i,0,l),t.newRowInserted=!0,o=-3,T(t,f,"newRow",!0)):(T(t,f,"newRow",!1),l=a.rows[i]),-3===o?(h={_parentRow:l,span:-1,col:-1,components:[]},l.columns.splice(s,0,h),t.newColumnInserted=!0,o=0,T(t,f,"newCol",!0),0!==s||t.newRowInserted||T(t,f,"newRow",!0)):(d=(h=l.columns[s]).components[o],0===o?(T(t,f,"newCol",!0),d&&(T(t,f,"newRow",d.newRow),T(t,f,"newGrid",d.newGrid),T(t,f,"col",d.col),T(t,f,"span",d.span),void 0!==d.rowSpan&&T(t,f,"rowSpan",d.rowSpan),T(t,d,"newCol",!1),T(t,d,"newRow",!1),T(t,d,"newGrid",!1),T(t,d,"col",-1),T(t,d,"span",-1),void 0!==d.rowSpan&&T(t,d,"rowSpan",-1))):T(t,f,"newCol",!1)),(void 0===f.col||f.col>=0&&(0!==o||!d)&&!f.forceColumn)&&T(t,f,"col",-1),delete f.forceColumn,void 0===f.span&&T(t,f,"span",-1),f._parentColumn=h,t.newGrid=n,t.newRow=i,t.newColumn=s,t.newIndex=o,!d&&s+1<l.columns.length&&(d=l.columns[s+1].components[0],t.newColumnInserted&&0===s&&T(t,d,"newRow",!1)),!d&&i+1<a.rows.length&&(d=a.rows[i+1].columns[0].components[0]),!d&&n+1<m._grids.length&&(d=m._grids[n+1].rows[0].columns[0].components[0]),c=d?S(m.components,d):m.components.length,t.newComponentIndex=c,h.components.splice(o,0,f),m.components.splice(c,0,f),d&&d._parentColumn!==f._parentColumn&&0===s&&f.newCol&&T(t,d,"newCol",!0),p=0;p<l.columns.length;p++)(h=l.columns[p]).col=h.components[0].col,h.span=h.components[0].span||-1;"fixed"===u.gridType&&u.hasColumnSpan&&A(l,m.maxColumns)}else t.newIndex=o,m.components.splice(o,0,f);return f._parent=m,o},_getTableColumnFromColumn:function(t,e,n,i){var s,o,r=1,a=0,l=t._grids[e].rows[n].columns;for(s=0;s<=i&&s<l.length;s++)(o=l[s]).col>r&&(a+=1,r=o.col),r+=o.span>0?o.span:1,a+=1;return a-1},_insertInDom:function(e,n,i,s,o,r,a,h,p){var c,u,f,m,g,_,w,b,k,G,L,x=this.pageRoot;m=e.hasClass(l)&&n.children(d).length?n.find(d).find("td").eq("left"===p?0:1).children(P):n.children(P),this.placeholder?this.placeholder.before(e):m.is(y)?(k=q(n),(G=a)<0&&(G=0),-1===a&&i._grids.length>1?(g=t("<table role='presentation'><tbody></tbody></table>"),D(m.parent(),"table",g,s),a=-2,G=0):g=m.parent().children("table").eq(s),-2===a&&0===s&&i._grids[s].rows.length>1?(u="<td><div class='"+v+" "+k+"'></div></td>",i._grids[s].rows[o].columns[0].col>=0&&(u+=u),_=t("<tr>"+u+"</tr>"),D(g.children("tbody"),_,o),G=0):_=g.children("tbody").children("tr").eq(o),L=this._getTableColumnFromColumn(i,s,o,r),-3===a?(i._grids[s].rows[o].columns[r].col>=0&&D(_,w=t("<td><div class='"+v+" "+k+"'></div></td>"),L-1),D(_,w=t("<td><div class='"+v+" "+k+"'></div></td>"),L),G=0):w=_.children().eq(L),D(w.children().eq(0),e,G)):D(m,e,a),"fixed"===x.gridType&&x.hasColumnSpan&&m.is(y)&&(_=(g=m.parent().children("table").eq(s)).children("tbody").children("tr").eq(o),b=i._grids[s].rows[o].columns,c=0,f=1,_.children("td").each((function(){b[c].col>f&&(this.colSpan=b[c].col-f,f=b[c].col),f+=b[c].span>0?b[c].span:1,t(this).find(C).length>0&&(this.colSpan=b[c].span,c+=1)}))),h&&this._showOrHideDisplayPoints(e)},_add:function(n,i,s,o,r,a,l,h){var p,d,c=!1,u=e.htmlBuilder(),f={container$:i,propertyChanges:[]};return f.newParentContainer=p=this._getNode(i[0]),d=t.isArray(p._grids),n.displayPoints&&(12,this._layoutDisplayPoints(n.displayPoints,n,d,12)),h?(this._setNode(n),h[0].id=this.baseId+n._elementId):(this._renderComponent(u,n,d),h=t(u.toString()),c=!0),f.newComponent$=h,f.component=n,this._insert(f,d,s,o,r,a,l),this._insertInDom(f.newComponent$,i,p,s,o,r,a,c,l),f},_remove:function(e,n,i){var s,o,r,a,l,h,p,d,c,u,f,m,g,v,_,w=this.pageRoot,P=this,k=!!i;if(n=n||{propertyChanges:[]},r=this._getNode(e[0]),i=i||e.parent(),k?e.hide():(n.component$=e,n.component=r,n.prevContainer$=e.closest(b),delete this.nodeMap[R(e[0].id)],e.find(C).each((function(){delete P.nodeMap[R(this.id)]})),e.remove()),_="TD"===i[0].parentNode.nodeName&&i.closest("table").is(y),n.prevParentContainer=u=r._parent,n.prevComponentIndex=m=S(u.components,r),n.prevIndex=n.prevComponentIndex,"button"===r.type&&r.alignment&&(n.prevAlignment=r.alignment),_&&0===i.children(":visible").length&&((o=i.parent().parent()).parent().children("tr").length>1&&0===o.find(C).filter(":visible").length?o.remove():o.children("td").length>1&&(c=i.parent().prev().eq(0),i.parent().remove(),0===c.find(C).filter(":visible").length&&c.remove())),_){if(f=S((a=r._parentColumn).components,r),0,g=S(a._parentRow._parentGrid.rows,a._parentRow),v=S(a._parentRow.columns,a),n.prevGrid=0,n.prevRow=g,n.prevColumn=v,n.prevIndex=f,0===f&&a.components.length>1&&(T(n,p=a.components[1],"newGrid",r.newGrid),T(n,p,"newRow",r.newRow),T(n,p,"newCol",r.newCol),T(n,p,"col",r.col),T(n,p,"span",r.span),r.rowSpan&&T(n,p,"rowSpan",r.rowSpan)),(a=(l=(h=u._grids[0]).rows[g]).columns[v]).components.splice(f,1),0===a.components.length&&(l.columns.splice(v,1),0===v&&l.columns.length>0&&T(n,p=l.columns[v].components[0],"newRow",!0),n.prevColumnRemoved=!0,l.columns.length>0)){if("fixed"===w.gridType&&w.hasColumnSpan){for(s=0;s<l.columns.length;s++)(a=l.columns[s]).col=a.components[0].col,a.span=a.components[0].span||-1;A(l,u.maxColumns)}d=l.columns,s=0,o.children("td").each((function(){t(this).find(C).length>0&&(d[s].span>0&&(this.colSpan=d[s].span),s+=1)}))}0===l.columns.length&&(h.rows.splice(g,1),n.prevRowRemoved=!0),0===h.rows.length&&(u._grids.splice(0,1),n.prevGridRemoved=!0)}return k&&e.show(),u.components.splice(m,1),delete r._parent,n},_moveOrCopy:function(n,i,s,o,r,a,l,h){var p,d,c,u,f,m=!1,g=!1,y=e.htmlBuilder(),v={container$:i,propertyChanges:[]};return p=this._getNode(n[0]),v.newParentContainer=u=this._getNode(i[0]),c=t.isArray(u._grids),v.prevContainer$=n.closest(b),h?(v.originalComponent=p,f=12,(p=this._copyComponent(p)).displayPoints&&this._layoutDisplayPoints(p.displayPoints,p,c,f),this._renderComponent(y,p,c),v.newComponent$=t(y.toString()),m=!0):(g="TD"===(d=n.parent())[0].parentNode.nodeName,v.newComponent$=n,p.displayPoints&&c!==g&&(f=12,this._layoutDisplayPoints(p.displayPoints,p,c,f),this._renderComponent(y,p,c),v.newComponent$=t(y.toString()),m=!0,n.remove(),delete this.nodeMap[R(n[0].id)])),v.component=p,h||(this._remove(v.newComponent$,v,d),g&&v.prevParentContainer===v.newParentContainer&&(v.prevColumnRemoved&&v.prevColumn<r&&o===v.prevRow&&(r-=1),v.prevRowRemoved&&v.prevRow<o&&s===v.prevGrid&&(o-=1),v.prevGridRemoved&&v.prevGrid<s&&(s-=1))),this._insert(v,c,s,o,r,a,l),this._insertInDom(v.newComponent$,i,u,s,o,r,a,m,l),v},_finishDrag:function(e){var n,i,s,o,r,a,l,h,p,d,c,u,f,m=e.ctrlKey,g=[];for(this.animating=!1,(this.dragComponent.next()[0]!==this.placeholder[0]||m||this.fromOutside)&&(h=this.placeholder.closest(b),d=I(this.placeholder),r=null,a=null,l=null,h.children("table.a-GridLayout-grid").length>0?(i=this.placeholder.closest("td"),l=0,i.parent().children("td").each((function(){if(this===i[0])return!1;t(this).children("."+v).children().length>0&&(l+=1)})),a=I(s=i.parent()),r=h.children("table").index(s.parent().parent()),0===d&&1===this.placeholder.parent().children(":visible").length&&(d=1===s.parent().children().length&&1===s.children().length?-1:1===s.children().length?-2:-3)):h.children("table.a-GridLayout-buttonRow").length>0&&(f=0===I(i=this.placeholder.closest("td"))?"left":"right"),this.fromOutside?(u=this.helper.attr("data-type-id"),o=this.options.makeComponent(u),this.dragComponent.remove(),c=this._add(o,h,r,a,l,d,f),g.push((function(t){this._trigger("added",t,c)}))):(c=this._moveOrCopy(this.dragComponent,h,r,a,l,d,f,m),g.push((function(t){this._trigger(m?"copied":"moved",t,c)})))),c&&(p=c.newComponent$),this.fromOutside&&g.push((function(t){this._trigger("deactivate",t,this._uiHashDnD(this))})),this.dragComponent.show(),this.dragging=!1,this.tempGridRow=null,this.tempGridColumn=null,this._trigger("beforeStop",e,this._uiHashDnD()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.placeholder=null,this.helper.remove(),this.helper=null,n=0;n<g.length;n++)g[n].call(this,e);return this._trigger("stop",e,this._uiHashDnD()),c&&this._select(p,e,!0),this.fromOutside=!1,!0},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHashDnD:function(e){var n=e||this;return{helper:n.helper,placeholder:n.placeholder||t([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.dragComponent,sender:e?e.element:null}}}),t.apex.gridlayout.INDEX={NEW_GRID:-1,NEW_ROW:-2,NEW_COLUMN:-3},t.ui.plugin.add("draggable","connectToGridlayout",{start:function(e,n){var i=t(this).data("ui-draggable"),s=i.options,o=t.extend({},n,{item:i.element});t("body").on("keydown.glvplug",(function(e){e.keyCode===t.ui.keyCode.ESCAPE&&(i.dropped=!1,i.cancel())})),i.grids=[],t(s.connectToGridlayout).each((function(){var s=t.data(this,"apex-gridlayout");s&&!s.options.disabled&&(i.grids.push({instance:s}),s._initDragTargets(n.helper),s._initTargetContainers(),s._refreshPositions(),s._trigger("activate",e,o))}))},stop:function(e,n){var i,s=t(this).data("ui-draggable");t("body").off(".glvplug"),t.each(s.grids,(function(){this.instance.isOver&&!this.invalid?(this.instance.isOver=!1,s.cancelHelperRemoval=!0,e.target?this.instance._mouseStop(e,!0):(this.instance._mouseStop(e,!0),this.instance.dragComponent.remove(),this.instance._cancel(e))):(this.instance._deactivate(),i=t.extend({},n,{item:s.element}),this.instance._trigger("deactivate",e,i))}))},drag:function(e,n){var i=t(this).data("ui-draggable");t.each(i.grids,(function(){var t=!1;if(!this.invalid)if(this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(t=!0),t){if(!this.instance.isOver){if(this.instance.isOver=!0,!this.instance._makeTempDragComponent())return this.instance.isOver=!1,void(this.invalid=!0);if(this.instance.helper=n.helper,this.instance.helper.css("position","relative"),e.target=this.instance.dragComponent.children("h3")[0],!this.instance._mouseCapture(e,!0))return this.instance.isOver=!1,void(this.invalid=!0);this.instance._trigger("over",e,this.instance._uiHashDnD(this.instance)),this.instance._mouseStart(e,e,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i}this.instance.dragComponent&&this.instance._mouseDrag(e)}else this.instance.isOver&&(this.instance.isOver=!1,this.instance._trigger("out",e,this.instance._uiHashDnD(this.instance)),e.target=null,this.instance._mouseStop(e,!0),this.instance.dragComponent.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i.dropped=!1)}))}})}(apex.jQuery,apex.util,apex.debug,apex.lang);
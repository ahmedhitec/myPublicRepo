!function(e,n,t,o,a,p){"use strict";var i="COMPONENT_VIEW",r="is-selected",P=[e.PROP.WHEN_REGION,e.PROP.WHEN_BUTTON,e.PROP.WHEN_ITEMS,e.PROP.WHEN_DOM_OBJECT,e.PROP.WHEN_JQUERY_SELECTOR,e.PROP.WHEN_JAVASCRIPT_EXPRESSION],d=[];function s(e){return a.getMessage("PD.CV."+e)}function E(n,t){var o,p;n.markup('<div class="a-CV-group"><div class="a-CV-groupHeader"><h3 class="a-CV-groupTitle">'),t.title?n.content(t.title):n.content(e.getComponentType(t.componentTypeId).title.plural),n.markup("</h3>"),!e.isPageReadOnly()&&t.componentTypeId&&(o=e.getComponentType(t.componentTypeId).createUrl,n.markup('<a class="a-Button a-Button--regionHeader create" href="#" '),o?n.attr("data-url",o):(n.attr("data-componenttypeid",t.componentTypeId),t.property&&n.attr("data-propertyid",t.property.id).attr("data-propertyvalue",t.property.value)),p=function(e){var n=s(e),t=[n].concat(Array.prototype.slice.call(arguments,1));return a.format.apply(this,t)}("CREATE_COMPONENT",e.getComponentType(t.componentTypeId).title.singular),n.markup(' title="'+p+'" aria-label="'+p+'"><span class="a-Icon icon-plus" aria-hidden="true"></span></a>')),n.markup('</div><div class="a-CV-groupBody" '),t.domId&&n.attr("id",t.domId),n.markup(">")}function c(e){e.markup("</div></div>")}function O(e){return"CVT"+e.typeId+"_"+e.id}function T(t,o,a){var i,r,P,d,s,E,c,T,l="",I=[];n.isNever(o)?l+=" "+n.CSS.IS_NEVER:n.isConditional(o)&&(l+=" "+n.CSS.IS_CONDITIONAL),o.hasChanged()&&(l+=" "+n.CSS.IS_CHANGED),o.hasErrors()&&(l+=" "+n.CSS.IS_ERROR),o.hasWarnings()&&(l+=" "+n.CSS.IS_WARNING),t.markup("<li ").attr("id",O(o)).attr("class","a-CV-component"+l).attr("data-componenttypeid",o.typeId).attr("data-componentid",o.id).markup(">"),a.type&&(r=p.isArray(a.type)?o.getProperty(a.type[0])||o.getProperty(a.type[1]):o.getProperty(a.type)),a.seq&&t.markup('<span class="a-CV-cell a-CV-cell--seq u-tE">').content(o.getProperty(a.seq).getDisplayValue()).markup("</span>"),a.name&&(t.markup('<span class="a-CV-cell a-CV-cell--primary">'),a.icon&&("region"===a.icon||"item"===a.icon?(d=n.getComponentIconClass(a.icon,r.getValue()),P=r.getDisplayValue()):"button"===a.icon?(d=n.getComponentIconClass("button","Y"===o.getProperty(e.PROP.BUTTON_IS_HOT).getValue()?"hot":"normal"),P=""):(d=a.icon,P=""),t.markup('<span class="a-CV-cellWrap">'+function(){for(var e="",n=0;n<a.indent;n++)e+='<span class="a-CV-indent"></span>';return e}()+"<span ").attr("class","a-CV-icon a-Icon "+d).attr("title",P).markup('></span><span class="u-VisuallyHidden">').content(P).markup("</span>")),t.markup('<a class="edit" href="#" title="">'),o.typeId===e.COMP_TYPE.REGION||!0===a.name?t.content(o.getDisplayTitle()):t.content(o.getProperty(a.name).getDisplayValue()),t.markup("</a></span>"),a.icon&&t.markup("</span>")),a.additional&&(i=a.additional.apply(o),t.markup('<span class="a-CV-cell a-CV-cell--secondary">').content(i).markup("</span>")),r&&(t.markup('<span class="a-CV-cell a-CV-cell--secondary">'),o.typeId===e.COMP_TYPE.REGION&&(E=r.getValue(),c={NATIVE_IR:e.COMP_TYPE.IR_ATTRIBUTES,NATIVE_IG:e.COMP_TYPE.IG_ATTRIBUTES,NATIVE_SQL_REPORT:e.COMP_TYPE.CLASSIC_REPORT,NATIVE_FNC_REPORT:e.COMP_TYPE.CLASSIC_REPORT,NATIVE_TABFORM:e.COMP_TYPE.TABULAR_FORM,NATIVE_FLASH_MAP:e.COMP_TYPE.MAP_CHART,NATIVE_FLASH_CHART5:e.COMP_TYPE.CHART,NATIVE_JET_CHART:e.COMP_TYPE.JET_CHART,NATIVE_CALENDAR:e.COMP_TYPE.CLASSIC_CALENDAR},T=e.COMP_TYPE.REGION_PLUGIN_ATTR,c.hasOwnProperty(E)&&(T=c[E]),I=e.getComponents(T,{parentId:o.id})),I.length>0?t.markup('<a class="edit" href="#" title=""').attr("data-componenttypeid",I[0].typeId).attr("data-componentid",I[0].id).markup(">").content(r.getDisplayValue()).markup("</a></span>"):r.id===e.PROP.BUTTON_ACTION?t.content((s=o.getProperty(e.PROP.BUTTON_TARGET))?n.splitApexUrl(s.getValue(),!0).display:o.getProperty(e.PROP.BUTTON_ACTION).getDisplayValue()):t.content(r.getDisplayValue()),t.markup("</span>")),t.markup("</li>")}function l(t,o){var a,i,r={},P=[],d={},s=!1;if(p.isArray(o.component))for(i=0;i<o.component.length;i++)P[i]={typeId:o.component[i].typeId,filter:o.component[i].filter},d[o.component[i].typeId]=o.component[i];else P[0]={typeId:o.component.typeId,filter:o.component.filter},d[o.component.typeId]=o.component;if((a=e.getComponentsAdvanced(P)).length>0){for(i=0;i<a.length;i++)if(!a[i].isOnGlobalPage()&&n.isDisplayed(a[i])){s=!0;break}if(s){for(o.header&&((r=o.header.component instanceof e.Component?{component:o.header.component}:o.header.title?{title:o.header.title}:{title:e.getComponentType(o.component.typeId).title.plural}).hasWarnings=o.header.hasWarnings,function(t,o){var a="a-CV-componentGroup";t.markup("<div "),o.hasWarnings&&(a+=" "+n.CSS.IS_WARNING),t.attr("class",a),o.component instanceof e.Component&&t.attr("data-componenttypeid",o.component.typeId).attr("data-componentid",o.component.id),t.markup(">"),(o.component||o.title)&&(t.markup('<h4 class="a-CV-componentGroupTitle">'),o.component instanceof e.Component?t.markup('<span class="a-CV-componentGroupTitle-context">').content(e.getComponentType(o.component.typeId).title.singular).markup('</span><a class="edit" href="#" title="">').content(o.component.getDisplayTitle()).markup("</a>"):t.content(o.title),t.markup("</h4>"))}(t,r)),o.noComponentGrouping||t.markup('<ul class="a-CV-components">'),i=0;i<a.length;i++)!a[i].isOnGlobalPage()&&n.isDisplayed(a[i])&&(T(t,a[i],d[a[i].typeId].display),d[a[i].typeId].addSubComponents&&d[a[i].typeId].addSubComponents(t,a[i]));o.noComponentGrouping||t.markup("</ul>"),o.header&&function(e){e.markup("</div>")}(t)}}}function I(e,n){return n.find("#"+t.escapeCSS(O(e)))}function m(e){for(var n=0;n<d.length;n++)I(d[n],e).addClass(r)}function R(a,r){function P(e){var n=t.htmlBuilder(),i=p("#"+a.domId);o.trace("%s: CHANGE/ADD_PROP/REMOVE_PROP component notification received for display relevant properties",a.domId,e),r(n),i.empty().append(n.toString()),m(i)}function d(e){e&&O.push(e)}var s,E,c=[],O=[];if(d(a.display.seq),d(a.display.name),d(a.display.additional),d(a.display.type),d(a.pointPropertyId),c=a.componentTypeId?[{typeId:a.componentTypeId}]:a.components,a.addProperties)for(E=0;E<a.addProperties.length;E++)d(a.addProperties[E]);e.observer(i,{components:c,events:[e.EVENT.CREATE,e.EVENT.DELETE]},P,!0),e.observer(i,{components:c,events:[e.EVENT.CHANGE,e.EVENT.ADD_PROP,e.EVENT.REMOVE_PROP],properties:O},P,!0),e.observer(i,{components:c,events:[e.EVENT.ERRORS,e.EVENT.NO_ERRORS,e.EVENT.WARNINGS,e.EVENT.NO_WARNINGS]},(function(e){function t(n,t){n?I(e.component,s).addClass(t):I(e.component,s).removeClass(t)}s=p("#"+a.domId),t(e.component.hasErrors(),n.CSS.IS_ERROR),t(e.component.hasWarnings(),n.CSS.IS_WARNING)})),n.observerIsConditional(i,c,(function(e){s=p("#"+a.domId),I(e.component,s).removeClass(n.CSS.IS_CONDITIONAL),I(e.component,s).removeClass(n.CSS.IS_NEVER),n.isNever(e.component)?I(e.component,s).addClass(n.CSS.IS_NEVER):n.isConditional(e.component)&&I(e.component,s).addClass(n.CSS.IS_CONDITIONAL)}))}function u(n,t){function o(n){var o;for(o=0;o<t.points.length;o++)l(n,{header:{title:e.getLovTitle(t.componentTypeId,t.pointPropertyId,t.points[o])},component:{typeId:t.componentTypeId,filter:{properties:[{id:t.pointPropertyId,value:t.points[o]}]},display:t.display}})}E(n,{domId:t.domId,componentTypeId:t.componentTypeId,property:{id:t.pointPropertyId,value:t.defaultCreatePoint}}),o(n),c(n),R(t,o)}function C(n,t,o){var a,p={},i="";for(t instanceof e.Component?(i=t.id,p.component=t):(p.title=s("NO_REGION"),p.hasWarnings=!0),a=0;a<o.length;a++)o[a].filter.properties&&o[a].filter.properties.push({id:e.PROP.REGION,value:i});l(n,{header:p,component:o})}function _(n,t,o,a){u(n,{domId:t,componentTypeId:e.COMP_TYPE.PAGE_COMPUTATION,pointPropertyId:e.PROP.COMPUTATION_POINT,defaultCreatePoint:a,points:o,display:{seq:e.PROP.EXECUTION_SEQUENCE,icon:"icon-tree-computation",name:e.PROP.COMPUTATION_ITEM_NAME,type:e.PROP.COMPUTATION_TYPE}})}function y(n,t,o,a){u(n,{domId:t,componentTypeId:e.COMP_TYPE.PAGE_PROCESS,pointPropertyId:e.PROP.PROCESS_POINT,defaultCreatePoint:a,points:o,display:{seq:e.PROP.EXECUTION_SEQUENCE,icon:"icon-tree-process",name:e.PROP.NAME,type:e.PROP.PAGE_PROCESS_TYPE}})}function N(n,t,o){var a={},p={};t.hasOwnProperty("region")?(p=!1,a.properties=[{id:e.PROP.PARENT_REGION,value:t.region.id}]):t.hasOwnProperty("point")?(p.title=t.point.name,a.properties=[],a.properties.push({id:e.PROP.PARENT_REGION,value:""}),a.properties.push({id:e.PROP.REGION_POSITION,value:t.point.id})):t.hasOwnProperty("validPointsMap")&&(p.title=s("INVALID_POSITION"),p.hasWarnings=!0,a.filterFunction=function(){var n=this.getProperty(e.PROP.REGION_POSITION);return!!n&&!t.validPointsMap.hasOwnProperty(n.getValue())}),l(n,{header:p,component:{typeId:e.COMP_TYPE.REGION,filter:a,addSubComponents:function(e,n){N(e,{region:n},o+1)},display:{seq:e.PROP.DISPLAY_SEQUENCE,icon:"region",name:e.PROP.TITLE,type:e.PROP.REGION_TYPE,indent:o}},noComponentGrouping:o>0})}function A(n,t){C(n,t,[{typeId:e.COMP_TYPE.PAGE_ITEM,filter:{properties:[]},display:{seq:e.PROP.DISPLAY_SEQUENCE,icon:"item",name:e.PROP.ITEM_NAME,additional:function(){var n=this.getProperty(e.PROP.ITEM_LABEL);return n?n.getDisplayValue():""},type:e.PROP.ITEM_TYPE}},{typeId:e.COMP_TYPE.BUTTON,filter:{properties:[{id:e.PROP.BUTTON_POSITION,value:"BODY"}]},display:{seq:e.PROP.DISPLAY_SEQUENCE,icon:"button",name:e.PROP.BUTTON_LABEL,type:e.PROP.BUTTON_ACTION}}])}function g(n,t){var o=t instanceof e.Component?t.id:"";C(n,t,[{typeId:e.COMP_TYPE.BUTTON,filter:{filterFunction:function(){return this.getProperty(e.PROP.REGION).getValue()===o&&"BODY"!==this.getProperty(e.PROP.BUTTON_POSITION).getValue()}},display:{seq:e.PROP.DISPLAY_SEQUENCE,icon:"button",name:e.PROP.BUTTON_LABEL,type:e.PROP.BUTTON_ACTION}}])}function S(){var n,t,o,a,i,r=p(this),P=r.data("url"),d=r.data("componenttypeid")+"",s=r.data("propertyid"),E=r.data("propertyvalue"),c=[];P?(a=P,apex.navigation.redirect(a.replace(/\\u002525/g,"%").replace(/%25/g,"%").replace(/%session%/g,$v("pInstance")).replace(/%pk_value%/g,i).replace(/%application_id%/g,e.getCurrentAppId()).replace(/%page_id%/g,e.getCurrentPageId()))):(s&&c.push({id:s,value:E}),n=e.transaction.message({action:e.MESSAGE_ACTION.CREATE,component:d}),t=e.transaction.start("",n),o=new e.Component({previousComponent:"last",typeId:d,values:c}),apex.commandHistory.execute(t),window.pageDesigner.goToComponent(o.typeId,o.id))}function f(){var n=p(this).closest("[data-componentid]"),t=e.getComponents(n.data("componenttypeid"),{id:n.data("componentid")})[0];window.pageDesigner.goToComponent(t.typeId,t.id,n.data("propertyid"))}function v(e,n){e.empty().append(n.toString()).on("click","a.create",S).on("click","a.edit",f)}function M(n){var o=t.htmlBuilder();!function(n,t){function o(n){var t,o;for(N(n,{validPointsMap:(t=e.getPageTemplate()).displayPointsMap},0),o=0;o<t.displayPoints.length;o++)N(n,{point:t.displayPoints[o]},0)}E(n,{domId:t,componentTypeId:e.COMP_TYPE.REGION}),o(n),c(n),R({domId:t,components:[{typeId:e.COMP_TYPE.REGION},{typeId:e.COMP_TYPE.PAGE}],display:{seq:e.PROP.DISPLAY_SEQUENCE,name:e.PROP.TITLE,type:e.PROP.REGION_TYPE},addProperties:[e.PROP.PARENT_REGION,e.PROP.REGION_POSITION,e.PROP.PAGE_TEMPLATE,e.PROP.DIALOG_TEMPLATE]},o)}(o,"cvRenderingRegions"),function(n,t){function o(n){var t,o=e.getComponents(e.COMP_TYPE.REGION,{});for(g(n,null),t=0;t<o.length;t++)g(n,o[t])}E(n,{domId:t,componentTypeId:e.COMP_TYPE.BUTTON}),o(n),c(n),R({domId:t,components:[{typeId:e.COMP_TYPE.REGION},{typeId:e.COMP_TYPE.BUTTON}],display:{},addProperties:[e.PROP.DISPLAY_SEQUENCE,e.PROP.BUTTON_LABEL,e.PROP.BUTTON_ACTION,e.PROP.BUTTON_TARGET,e.PROP.REGION,e.PROP.TITLE]},o)}(o,"cvRenderingRegionButtons"),function(n,t){function o(n){var t,o=e.getComponents(e.COMP_TYPE.REGION,{});for(A(n,null),t=0;t<o.length;t++)A(n,o[t])}E(n,{domId:t,componentTypeId:e.COMP_TYPE.PAGE_ITEM}),o(n),c(n),R({domId:t,components:[{typeId:e.COMP_TYPE.REGION},{typeId:e.COMP_TYPE.PAGE_ITEM},{typeId:e.COMP_TYPE.BUTTON}],display:{},addProperties:[e.PROP.DISPLAY_SEQUENCE,e.PROP.ITEM_NAME,e.PROP.ITEM_LABEL,e.PROP.ITEM_TYPE,e.PROP.BUTTON_LABEL,e.PROP.BUTTON_ACTION,e.PROP.BUTTON_TARGET,e.PROP.REGION,e.PROP.TITLE]},o)}(o,"cvRenderingPageItems"),e.isGlobalPage()||(_(o,"cvRenderingComputations",["ON_NEW_INSTANCE","BEFORE_HEADER","AFTER_HEADER","BEFORE_BOX_BODY","AFTER_BOX_BODY","BEFORE_FOOTER","AFTER_FOOTER"],"AFTER_HEADER"),y(o,"cvRenderingProcesses",["ON_NEW_INSTANCE","BEFORE_HEADER","AFTER_HEADER","BEFORE_BOX_BODY","AFTER_BOX_BODY","BEFORE_FOOTER","AFTER_FOOTER"],"AFTER_HEADER"),function(n,t){var o={domId:t,componentTypeId:e.COMP_TYPE.DA_EVENT,display:{seq:e.PROP.EXECUTION_SEQUENCE,icon:"icon-tree-da-event",name:e.PROP.NAME,additional:function(){var e,n;for(e=0;e<P.length;e++)if(n=this.getProperty(P[e]))return n.getDisplayValue();return""},type:e.PROP.EVENT}};function a(e){l(e,{header:!1,component:{typeId:o.componentTypeId,display:o.display}})}E(n,{domId:o.domId,componentTypeId:o.componentTypeId}),a(n),c(n),o.addProperties=P,R(o,a)}(o,"cvRenderingDynamicActions")),v(n,o)}function V(n){var o=t.htmlBuilder();e.isGlobalPage()||(_(o,"cvProcessingComputations",["AFTER_SUBMIT"],"AFTER_SUBMIT"),function(n,t){var o={domId:t,componentTypeId:e.COMP_TYPE.VALIDATION,display:{seq:e.PROP.EXECUTION_SEQUENCE,icon:"icon-tree-validation",name:e.PROP.NAME,type:[e.PROP.VALIDATION_TYPE,e.PROP.REGION_VALIDATION_TYPE]}};function a(e){l(e,{header:!1,component:{typeId:o.componentTypeId,display:o.display}})}E(n,{domId:o.domId,componentTypeId:o.componentTypeId}),a(n),c(n),R(o,a)}(o,"cvProcessingValidations"),y(o,"cvProcessingProcesses",["ON_SUBMIT_BEFORE_COMPUTATION","AFTER_SUBMIT","ON_DEMAND"],"AFTER_SUBMIT"),function(n,t,o,a){u(n,{domId:t,componentTypeId:e.COMP_TYPE.BRANCH,pointPropertyId:e.PROP.BRANCH_POINT,defaultCreatePoint:a,points:o,display:{seq:e.PROP.EXECUTION_SEQUENCE,icon:"icon-tree-branch",name:e.PROP.NAME,type:e.PROP.BRANCH_TYPE}})}(o,"cvProcessingBranches",["BEFORE_COMPUTATION","BEFORE_VALIDATION","BEFORE_PROCESSING","AFTER_PROCESSING"],"AFTER_PROCESSING")),v(n,o)}function h(e){e.empty().off("click","a.create").off("click","a.edit")}p((function(){var n=p("#componentView-container"),t=p("#PDrenderingCV"),a=p("#PDprocessingCV");p(document).on("modelReady",(function(){M(t),V(a),p(document).on("selectionChanged."+i,(function(e,t,a){t!==i&&(o.trace("%s: selectionChanged event received from %s",i,t,a),n.find("li.a-CV-component."+r).removeClass(r),d=a,m(n))})),p(document).one("modelCleared",(function(){e.unobserver(i,{}),p(document).off("selectionChanged."+i),d=[],h(t),h(a)}))}))}))}(pe,window.pageDesigner,apex.util,apex.debug,apex.lang,apex.jQuery);
$((function(){"use strict";!function(e,t,a,i,n,o){var s=$v("pInstance"),r=$v("F4000_P1_FLOW")||$v("P4500_CURRENT_APP"),p=e(N+k).length>0,l="",c=$v("pFlowId"),u=[],d=[],h=[],f="",g=!1,S=!1,m=apex_img_dir+"apex_ui/js/staticData/apex_search_common_en.json",v=apex_img_dir+"apex_ui/js/staticData/apex_search_common_"+apex.locale.getLanguage()+".json",C=[20,49,56,57,73,76,78,160,163,196,224,226,227,273,279,433,441,460,479,494,495,514,516,523,527,559,588,589,598,650,680,689,722,733,800,875,876,933,934,1500,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2111,2115,2116,2117,2150,2151,2152,2153,2154,2155,2157,3e3,3001,3005,3020,4460,4900];if(window.self!==window.top||"4050"===c)return!1;if("undefined"!=typeof pe)var E=pe;var _,y="redirect",A="search-page",I="search-app",x="search-all-apps",O="goto-page",P="goto-app",b="pe",R="shortcutAction",w="icon-edit-app",L="icon-page",T="icon-search",F="icon-shared-components",D="icon-goto-group",H="icon-page-designer",N=".",k="a-Spotlight",G="a-Spotlight-input",B="a-Spotlight-results",M="is-active",W="sp-result-list",U=e.ui.keyCode,j={4e3:"builder",4500:"builder",4800:"teamdev",4350:"admin"}[c];r.length<=0&&(_=window.location.search.substring(1).replace("p=","").split(":"),r="4000"!==_[0]||C.includes(parseInt(_[1]))?"":apex.builder.gApplicationId);var $,z=i.formatMessage,K={app:i.getMessage("SL.APP"),page:i.getMessage("SL.PAGE"),placeHolder:i.getMessage("SL.PLACEHOLDER"),oneMatchFound:i.getMessage("SL.MATCH.FOUND"),noMatchFound:i.getMessage("SL.NO.MATCH.FOUND"),enterKeywords:i.getMessage("SL.SEARCH.HELP")},X=function(e){var t,a,i=e.title,n=e.desc,o=e.path||"",s=e.url,p=e.type,l=e.icon,c=e.shortcut,u=c?'<span class="a-Spotlight-shortcut" >'+c+"</span>":"",d="",h=e.peData;if((0===s||s&&s.length>0)&&(d='data-url="'+s+'" '),p&&(d=d+' data-type="'+p+'" '),h)for(t in h)h.hasOwnProperty(t)&&(d=d+" data-"+t+'="'+h[t]+'" ');return p===P&&e.initials.trim().length>0?(a='<span class="'+l+'" style="color: #fff; box-shadow: 0 0 0 1px #fff;webkit-box-shadow: 0 0 0 1px #fff;position: relative;z-index: 1;margin-right: 16px;padding: 8px;width: 32px;height: 32px;border-radius: 2px;" aria-hidden="true"><span class="a-Icon">'+e.initials+"</span></span>",n=n||"Open Application "+i):a=e.hasCustomIcon?l:'<span class="a-Spotlight-icon" aria-hidden="true"><span class="a-Icon '+l+'"></span></span>','<li class="a-Spotlight-result a-Spotlight-result--page" aria-label="'+n+'"><span class="a-Spotlight-link" '+d+">"+a+'<span class="a-Spotlight-info"><span class="a-Spotlight-label" role="option">'+(i+=e.alias&&e.alias.trim().length>0?' <span class="a-Spotlight-labelContext">'+e.alias.toLowerCase()+"</span>":"")+'</span><span class="a-Spotlight-desc">'+o.replace("{APP_ID}",r)+"</span></span>"+u+"</span></li>"},Y=function(t,i){var p,c=t.data("url");switch(t.data("type")){case b:o.goToComponent(t.data("typeid"),t.data("componentid"),t.data("propertyid"));break;case A:o.activateTab("search"),e("#P4500_LOCAL_SEARCH").val(l).trigger("change").focus();break;case I:a.popup({url:"f?p=4000:8000:"+s+"::::P8000_START_SEARCH,P8000_SEARCH:1,"+encodeURIComponent(l),name:"SEARCH_RESULTS",width:1e3,height:800});break;case x:a.popup({url:"f?p=4000:8000:"+s+"::::FB_FLOW_ID,FB_FLOW_PAGE_ID,P8000_START_SEARCH,P8000_SEARCH:"+r+",,1,"+encodeURIComponent(l),name:"SEARCH_RESULTS",width:1e3,height:800});break;case P:a.redirect("f?p=4000:1:"+s+"::NO::FB_FLOW_ID,F4000_P1_FLOW,P0_FLOWPAGE:"+c+","+c+","+c);break;case O:o&&!g?o.goToPage(c):g?a.redirect("f?p=4000:4150:"+s+"::NO::FB_FLOW_ID,FB_FLOW_PAGE_ID:"+f+","+c):a.redirect("f?p=4000:4150:"+s+"::NO::FB_FLOW_PAGE_ID:"+c);break;case y:a.redirect(function(e){return isNaN(e.split(":")[0])?e:"f?p="+e+":"+s}(c));break;case R:(p=n.lookup(c)).action||p.href?n.invoke(c,i,$):n.toggle(c)}te()},J=function(){e("#"+W).empty(),e(N+G).val("").focus(),l="",Q(),S&&(S=!1,g=!1,f="")},Q=function(){var t=e(N+B),a=e(N+G),i=t.find(N+M).find(N+"a-Spotlight-label").attr("id"),n=e("#"+i),o=n.text(),s=t.find("li"),r=0!==s.length,p="",c=s.filter((function(){return 0===e(this).find(N+"a-Spotlight-shortcut").length})).length;e(N+"a-Spotlight-label").attr("aria-selected","false"),n.attr("aria-selected","true"),""===l?p=K.enterKeywords:0===c?p=K.noMatchFound:1===c?p=K.oneMatchFound:c>1&&(p=z("SL.N.MATCHES.FOUND",c)),p=o+", "+p,e("#sp-aria-match-found").text(p),a.attr("aria-activedescendant",i).attr("aria-expanded",r)},V=function(){var t,a,i,n,o=function(){var o=e("div.a-Spotlight-results");t=o.outerHeight(),a=e("li.a-Spotlight-result").outerHeight(),i=o.offset().top,n=t/a},s=function(e){var i=e.find(N+M),s=i.index();n||o(),!i.length||i.is(":last-child")?(i.removeClass(M),e.find("li").first().addClass(M),e.animate({scrollTop:0})):function(e){if(e[0]){var a=e.offset().top;return a<0||a>t}}(i.removeClass(M).next().addClass(M))&&e.animate({scrollTop:(s-n+2)*a},0)},r=function(e){var s=e.find(N+M),r=s.index();n||o(),!e.length||s.is(":first-child")?(s.removeClass(M),e.find("li").last().addClass(M),e.animate({scrollTop:e.find("li").length*a})):function(e){if(e[0]){var a=e.offset().top;return a>t||a<=i}}(s.removeClass(M).prev().addClass(M))&&e.animate({scrollTop:(r-1)*a},0)};e(window).on("apexwindowresized",(function(){o()})),e("body").append('<div class="'+k+'"><div class="a-Spotlight-body"><div class="a-Spotlight-search"><div class="a-Spotlight-icon"><span class="a-Icon icon-search" aria-hidden="true"></span></div><div class="a-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+W+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+G+'" placeholder="'+K.placeHolder+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="sp-aria-match-found"></div></div><div class="'+B+'"><ul class="a-Spotlight-resultsList" id="'+W+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",N+G,(function(){var t=e(this).val().trim(),a=t.length;0===a?J():(a>1||!isNaN(t))&&t!==l&&ne(t)})).on("keydown",N+k,(function(t){var a,i,n=e(N+B);switch(t.which){case U.DOWN:t.preventDefault(),s(n);break;case U.UP:t.preventDefault(),r(n);break;case U.ENTER:t.preventDefault(),Y(n.find("li.is-active span"),t);break;case U.TAB:te()}if(t.ctrlKey){switch(a=n.find(N+"a-Spotlight-shortcut").parent().get().reverse(),t.which){case 49:i=1;break;case 50:i=2;break;case 51:i=3;break;case 52:i=4}i&&Y(e(a[i-1]),t)}t.shiftKey&&t.which===U.TAB&&te(),Q()})).on("click","span.a-Spotlight-link",(function(t){Y(e(this),t)})).on("mousemove","li.a-Spotlight-result",(function(){var t=e(this);t.parent().find(N+M).removeClass(M),t.addClass(M)})).on("blur",N+k,(function(t){e(N+k).dialog("isOpen")&&e(N+G).focus()})),e(N+k).on("keydown",(function(t){var a=e(N+G);t.which===U.ESCAPE&&(a.val()?(J(),t.stopPropagation()):te())})),p=!0},q=function(e){f=e,apex.server.process("spotlightIndex",{x01:e,x02:"N"},{success:function(e){h=e},error:function(e,t,a){console.log(JSON.parse(e.responseText))}})},Z=function(e){var t,a,i,o,s,r="";for(u=e,t=n.list(),s=0;s<t.length;s++)"spotlight-search"!==(o=(i=t[s]).name)&&((a=n.lookup(o))&&(r=n.shortcutDisplay(a.shortcut||"")),u.push({name:i.label,description:r,path:r,shortcutAction:o,priority:0,type:R}))},ee=function(t){var i=function(){var t=e(N+k),i=window.scrollY||window.pageYOffset;t.hasClass("ui-dialog-content")&&t.dialog("isOpen")||t.dialog({width:650,resizable:!1,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(i+64),of:e("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){e(this).css("min-height","auto").prev(".ui-dialog-titlebar").remove(),a.beginFreezeScroll(),e(".ui-widget-overlay").on("click",(function(){te()}))},close:function(){J(),a.endFreezeScroll()}})};p?(i(),r!=f&&q(r)):(V(),i(),u&&u.length>0||e.ajax({dataType:"json",type:"GET",url:v,success:function(e){Z(e)},error:function(t,a,i){404==t.status&&e.ajax({dataType:"json",type:"GET",url:m,success:function(e){Z(e)},error:function(e,t,a){console.log(JSON.parse(e.responseText))}})}}),d&&d.length>0||apex.server.process("spotlightIndex",{x01:null,x02:"Y"},{success:function(e){d=e},error:function(e,t,a){console.log(JSON.parse(e.responseText))}}),r&&r.length>0&&q(r)),$=t},te=function(){e(N+k).dialog("close")},ae=function(t){var a,i,n=[],o=!1,p=t.length,c=[],S=!!(r&&r.length>0||g||e(".a-Breadcrumb-item a[href^='f?p=4000:1:']").length>0),m=function(e,t,a,i){var n,o=100,s=t-1;return 0===e&&0===s||(-1===(n=a.indexOf(l))?o=o-e-s-t:o-=n),o-i};for(i=0;i<t.length;i++)a=t[i],n=(c=[],c=S?c.concat(h).concat(d).concat(u):c.concat(d).concat(u),o?n:c).filter((function(e,t){var i=e.name.toLowerCase(),n=i.split(" ").map((function(e){return e[0]})).join(""),o=i.split(" ").length,s=i.search(a),r=0;if(p>o)return!1;if(S&&e.scope&&"app"!==e.scope&&(r=80),s>-1)return e.score=m(s,o,i,r),!0;if(e.tokens){if(e.tokens.search(a)>-1)return e.score=80,!0}else{if(n.search(a)>-1)return e.score=80,!0;if(e.appId){if(e.appId.search(a)>-1)return e.score=m(s,o,e.appId,r),!0}else if(e.pageId){if(e.pageId.search(a)>-1)return e.score=m(s,o,e.pageId,r),!0}else if(e.alias&&e.alias.toLowerCase().search(a)>-1)return e.score=80,!0}})).sort((function(e,t){return t.score-e.score})),o=!0;return function(e){var t,a,i,n,o,p,l,c="",u={},d="",h=!1,m="",v={},C="";for(e.sort((function(e,t){return parseInt(t.priority)-parseInt(e.priority)})),e.length>100&&(e.length=100),t=0;t<e.length;t++)if(a=e[t],S||!a.scope||"app"!==a.scope){if(l=a.shortcut,h=!1,m="",a.appId)n=P,d=a.appId,i="App "+a.appId,p="App "+a.appId,a.appBuilderIconName&&a.appBuilderIconName.trim().length>0?(o='<span class="a-Spotlight-icon">'+a.appBuilderIconName+"</span>",h=!0):a.imageClass&&a.imageClass.trim().length>0?(o='<span class="a-Spotlight-icon '+a.imageClass+'" aria-hidden="true"></span>',h=!0):a.appColor&&a.appColor.trim().length>0&&a.appInitials.trim().length>0?(o=a.appColor,m=a.appInitials):o=w;else if(0===a.pageId||a.pageId){if(n=O,d=a.pageId,!((C=a.parentAppId?a.parentAppId:r)&&C.length>0))continue;i=" Go to "+d+" from application ID "+C,p=K.app+" "+C+" &#92; "+K.page+" "+d,o=L}else{if(n=a.type||y,d=a.url||a.shortcutAction,i=a.description,p="",a.path)if("string"==typeof a.path)p=a.path;else{var E=0;for(var _ in a.path)a.path.hasOwnProperty(_)&&(p+=a.path[_]+" \\ ",E++);E>=1&&(E-=1),a.scope&&"action"!==a.scope&&a.name!==a.path.last?a.label='<span class="a-Spotlight-labelContext">'+a.path.last+"</span> "+a.name:a.scope&&"action"===a.scope&&(a.label='<span class="a-Spotlight-labelContext">'+a.path.last+"</span> "+a.description,p="");var A=p.split("\\");p=(A=A.slice(0,E)).join("\\")}o=a.icon||D}if(d&&d.length>0){if(d.indexOf("&DEBUG.")>0){var I="::::";g&&(I="::FB_FLOW_ID:"+f),d=d.substring(0,d.indexOf("&DEBUG.")+"&DEBUG.".length).concat(I)}d=d.replace("%SESSION%",s).replace("&DEBUG.","NO").replace("&APP_SESSION.",s)}v={title:a.label?a.label:a.name,desc:i,url:d,icon:o,hasCustomIcon:h,type:n,path:p,score:a.score,alias:a.alias,initials:m,priority:a.priority},l&&(v.shortcut=l);var x=0;a.score?(x=ie(u,a.score-t),u[x]=X(v)):(x=ie(u,-1e3*t),u[x]=X(v))}return Object.keys(u).sort((function(e,t){return t-e})).forEach((function(e){c+=u[e]})),c}(function(t){var a,i=encodeURIComponent(l),n=l,o=/^(\d+)(?::|-)\s*(\d+)$/,p=/^(\d+)(?::|-)\s*(s|sc|sh)$/;switch(o.test(l)?(a=l.match(o),t.unshift({name:z("SL.EDIT.PAGE.IN.APP",a[2],a[1]),url:"f?p=4000:4500:"+s+"::NO::FB_FLOW_ID,FB_FLOW_PAGE_ID:"+a[1]+","+a[2],icon:L,description:z("APEX.SEARCH.GO_TO_PAGE")+" "+a[2],path:z("APEX.SEARCH.GO_TO_PAGE")+" "+a[2],score:1e3,priority:10,type:y})):p.test(l.toLowerCase())&&(a=l.toLowerCase().match(p),t.unshift({name:z("SL.SHARED.COMP.APP",a[1]),url:"f?p=4000:9:"+s+"::NO::FB_FLOW_ID:"+a[1],icon:F,description:z("APEX.SEARCH.GO_TO_SHARED_COMPONENTS"),path:z("APEX.SEARCH.GO_TO_SHARED_COMPONENTS"),score:1e3,priority:100,type:y})),j){case"builder":(r||E||e(".a-Breadcrumb-item a[href^='f?p=4000:1:']").length>0)&&(E&&t.push({name:z("SL.SEARCH.PAGE",n),type:A,icon:T,priority:0,shortcut:"Ctrl + 4"}),t.push({name:z("SL.SEARCH.APP",n),type:I,icon:T,priority:0,shortcut:"Ctrl + 3"}));break;case"teamdev":t.push({name:z("SL.SEARCH.TEAM.DEV",n),url:"f?p=4800:8000:"+s+":::RIR:IR_ROWFILTER:"+i,icon:T,priority:0,type:y});break;case"admin":t.push({name:z("SL.SEARCH.USER",n),url:"f?p=4350:8000:"+s+":::RIR:IR_ROWFILTER:"+i,icon:"icon-user",priority:0,type:y})}return t.push({name:z("SL.SEARCH.ALLAPPS",n),type:x,icon:T,priority:0,shortcut:"Ctrl + 2"}),t.push({name:z("SL.SEARCH.WP",n),url:"f?p=4500:8000:"+s+":::RIR:IR_ROWFILTER:"+i,icon:T,type:y,priority:0,shortcut:"Ctrl + 1"}),t}(n))},ie=function(e,t){return e.hasOwnProperty(t)&&(t=ie(e,t-1)),t},ne=function(a){var i,n,o,s,p=(l=a.trim()).split(" "),c=(e(N+B),[]),u="",d=new RegExp("^[0-9]+\\s*:\\s*$","gi"),h=new RegExp("^[0-9]+\\s*:(\\s*\\S|\\s*\\d+)","gi"),m=!0;for(d.test(l)?(m=!1,S=!0,(s=l.split(":"))[0].trim().length>0&&(o=s[0],f!==o&&q(o))):h.test(l)?(m=!0,S=!0,g=!0,(s=l.split(":"))[1].trim().length>0&&(o=s[0],p=s[1].trim().split(" "))):(m=!0,S&&r!==f&&q(r)),n=0;n<p.length;n++)c.push(new RegExp(t.escapeRegExp(p[n]),"gi"));m||(c=[],l=f),i=ae(c),E&&E.getCurrentPageId()&&!g&&(u=function(a,i){var n,o,s,r,p,l,c="",u=function(e){return E.getComponentType(e)},d=function(t,a){var i,n,o,s=u(a);if(i=E.displayTitleSearch(t,a),s)for(o=s.childComponentTypes.length,n=0;n<o;n++)i=e.merge(d(t,s.childComponentTypes[n]),i);return i};for((n=d(a,i)).length>50&&(n.length=50),p=0,l=n.length;p<l;p++)s=(o=n[p]).typeId,r=u(s),c+=X({title:t.escapeHTML(r.title.singular)+" &rarr; "+t.escapeHTML(o.getDisplayTitle()),icon:H,type:b,peData:{typeid:s,componentid:o.id,propertyid:r.displayPropertyId}});return c}(c[0],E.COMP_TYPE.PAGE)),e("#"+W).html(u+i).find("li").each((function(t){e(this).find(N+"a-Spotlight-label").attr("id","sp-result-"+t)})).first().addClass(M)};n.add({name:"spotlight-search",label:null,title:null,shortcut:"Ctrl+Quote",action:function(e,t){return ee(t),!0}})}(apex.jQuery,apex.util,apex.navigation,apex.lang,apex.actions,window.pageDesigner)}));
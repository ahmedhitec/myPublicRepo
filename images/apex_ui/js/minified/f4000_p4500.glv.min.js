!function(e,n,t,o,a){"use strict";var i=a.CSS.IS_ERROR,r=a.CSS.IS_WARNING,l=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",s=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",d="option",p=n.apex.gridlayout.INDEX,u={newGrid:e.PROP.GRID_NEW_GRID,newRow:e.PROP.GRID_NEW_ROW,col:e.PROP.GRID_COLUMN,newCol:e.PROP.GRID_NEW_COLUMN,span:e.PROP.GRID_COLUMN_SPAN,rowSpan:e.PROP.GRID_ROW_SPAN,alignment:e.PROP.ALIGNMENT};function g(e){var n,t,o,a,i;for(n=0;n<e.length;n++)o=e[n],t=u[o.property],(i=o.component._modelComponent.getProperty(t))&&(!0===o.newValue?a=i.getMetaData().yesValue:!1===o.newValue?a=i.getMetaData().noValue:"alignment"===o.property&&o.newValue?a=o.newValue.toUpperCase():"col"!==o.property&&"span"!==o.property&&"rowSpan"!==o.property||-1!==o.newValue?void 0!==o.newValue&&null!==o.newValue&&(a=""+o.newValue):a="",void 0!==a&&i.setValue(a))}function P(e){var n,t=null;return void 0===(n=e.newComponentIndex)&&(n=e.newIndex),n>0&&(t=e.newParentContainer.components[n-1]._modelComponent),t}function c(e){e.newParentContainer===e.prevParentContainer?e.newParentContainer=e.prevParentContainer=[e.newParentContainer._parent.id,e.newParentContainer.id]:(e.newParentContainer&&(e.newParentContainer=[e.newParentContainer._parent.id,e.newParentContainer.id]),e.prevParentContainer&&(e.prevParentContainer=[e.prevParentContainer._parent.id,e.prevParentContainer.id])),delete e.component$,delete e.newComponent$,delete e.container$,delete e.prevContainer$}function m(){var e=b.gridlayout(d);return{hideLegacyDisplayPoints:e.hideLegacyDisplayPoints,hideEmptyDisplayPoints:e.hideEmptyDisplayPoints,hideButtons:e.hideButtons,hideItems:e.hideItems,displayFrom:e.displayFrom,hideGlobalComponents:h}}function y(e){var t=b.gridlayout(d);t.displayFrom!==e.displayFrom&&b.gridlayout(d,"displayFrom",e.displayFrom),n.each(["displayFrom","hideLegacyDisplayPoints","hideEmptyDisplayPoints","hideButtons","hideItems"],(function(n,o){e[o]||t[o]===e[o]||b.gridlayout(d,o,e[o])})),e.hideGlobalComponents!==h&&(h=e.hideGlobalComponents,b.gridlayout("pageDataChanged"))}var O=!1,h=!0,I=null,R=!1,_=!1,E=!1,C=n.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(I=this,this.gl$.gridlayout("move",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=m()},updateDataLayer:function(n){var t,a,i,r,l=[];function s(e,n){l.push({id:e,value:n})}n&&(this.changes=n),n=this.changes,this._label=o.formatMessageNoEscape("PD.GLV.CMD.MOVE",this.changes.component.title),E=!0,this.transaction=e.transaction.start("glv"),i=n.component._modelComponent,n.newParentContainer!==n.prevParentContainer&&(a=(t=n.newParentContainer)._parent,"region"===n.component.type?"page"===a.type?(s(e.PROP.PARENT_REGION,""),s(e.PROP.REGION_POSITION,t.id)):s(e.PROP.PARENT_REGION,a.id):"item"===n.component.type?s(e.PROP.REGION,a.id):"button"===n.component.type&&(a!==n.prevParentContainer._parent?(s(e.PROP.REGION,a.id),s(e.PROP.BUTTON_POSITION,t.id)):t.id!==n.prevParentContainer.id&&s(e.PROP.BUTTON_POSITION,t.id))),r=P(n),i.move(r,l),g(n.propertyChanges),this.transaction.execute(),c(n)},undo:function(){var n,t=this.changes,o=t.prevGrid,a=t.prevRow,i=t.prevColumn,r=t.prevIndex;y(this.state),R=!0,t.prevGridRemoved?r=p.NEW_GRID:t.prevRowRemoved?r=p.NEW_ROW:t.prevColumnRemoved&&(r=p.NEW_COLUMN),t.newParentContainer===t.prevParentContainer&&(r>=0&&t.prevIndex>t.newIndex&&(r+=1),t.newGridInserted?t.newGrid<=t.prevGrid&&(o+=1):t.newRowInserted?t.newRow<=t.prevRow&&(a+=1):t.newColumnInserted&&t.newColumn<=t.prevColumn&&(i+=1)),E=!0,this.transaction.undo(),(n=b.gridlayout("findComponentById",t.component.id)).col=1*x(n._modelComponent,e.PROP.GRID_COLUMN,-1),n.col>=0&&(n.forceColumn=!0),this.gl$.gridlayout("move",{},t.component.id,t.prevParentContainer,o,a,i,r,t.prevAlignment)},redo:function(){var e=this.changes,n=e.newIndex;y(this.state),R=!0,e.newGridInserted?n=p.NEW_GRID:e.newRowInserted?n=p.NEW_ROW:e.newColumnInserted?n=p.NEW_COLUMN:e.newParentContainer===e.prevParentContainer&&e.newIndex>e.prevIndex&&(n+=1),E=!0,this.transaction.redo(),this.gl$.gridlayout("move",{},e.component.id,e.newParentContainer,e.newGrid,e.newRow,e.newColumn,n,e.newAlignment)},label:function(){return this._label}});function N(e,n,t,o,a,i,r,l,s){var d=Object.create(C);return d.changes=n,d.gl$=e,d.component$=t,d.container$=o,d.grid=a,d.row=i,d.column=r,d.index=l,d.alignment=s,d._label="move",d}var v=n.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(I=this,this.gl$.gridlayout("copy",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=m()},updateDataLayer:function(n){var t,a,i,r,l=[];function s(e,n){l.push({id:e,value:n})}n&&(this.changes=n),n=this.changes,this._label=o.formatMessageNoEscape("PD.GLV.CMD.COPY",this.changes.originalComponent.title),E=!0,_=!0,this.transaction=e.transaction.start("glv"),i=n.component._modelComponent,i=n.component._modelComponent=i.duplicate(),n.component.id=i.id,n.component.title=i.getDisplayTitle(),b.gridlayout("update",n.component,!1),n.newParentContainer!==n.originalComponent._parent&&(a=(t=n.newParentContainer)._parent,"region"===n.component.type?"page"===a.type?(s(e.PROP.PARENT_REGION,""),s(e.PROP.REGION_POSITION,t.id)):s(e.PROP.PARENT_REGION,a.id):"item"===n.component.type?s(e.PROP.REGION,a.id):"button"===n.component.type&&(s(e.PROP.REGION,a.id),s(e.PROP.BUTTON_POSITION,t.id))),r=P(n),i.move(r,l),g(n.propertyChanges),this.transaction.execute(),c(n)},undo:function(){var e=this.changes;y(this.state),R=!0,this.gl$.gridlayout("remove",{},[e.component.id]),this.transaction.undo()},redo:function(){var e=this.changes,n=e.newIndex;y(this.state),R=!0,e.newGridInserted?n=p.NEW_GRID:e.newRowInserted?n=p.NEW_ROW:e.newColumnInserted?n=p.NEW_COLUMN:e.newParentContainer===e.prevParentContainer&&e.newIndex>e.prevIndex&&(n+=1),E=!0,_=!0,this.gl$.gridlayout("add",{},e.component,e.newParentContainer,e.newGrid,e.newRow,e.newColumn,n,e.newAlignment,e.newComponent$),this.transaction.redo()},label:function(){return this._label}});function f(e,n,t,o,a,i,r,l,s){var d=Object.create(v);return d.changes=n,d.gl$=e,d.component$=t,d.container$=o,d.grid=a,d.row=i,d.column=r,d.index=l,d.alignment=s,d._label="copy",d}var T=n.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(I=this,this.gl$.gridlayout("add",{},this.componentTypeId,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=m()},updateDataLayer:function(n){var t,a,i,r,l,s,d,p,u=!1,m=[];function y(e,n){m.push({id:e,value:n})}for(n&&(this.changes=n),d=(n=this.changes).component._galleryComponent,this._label=o.formatMessageNoEscape("PD.GLV.CMD.CREATE",d.title),this.transaction=e.transaction.start("glv"),i=(a=n.newParentContainer)._parent,"region"===n.component.type?(s=e.COMP_TYPE.REGION,"page"===i.type?(y(e.PROP.PARENT_REGION,""),y(e.PROP.REGION_POSITION,a.id)):y(e.PROP.PARENT_REGION,i.id)):"item"===n.component.type?(s=e.COMP_TYPE.PAGE_ITEM,y(e.PROP.REGION,i.id)):"button"===n.component.type&&(s=e.COMP_TYPE.BUTTON,y(e.PROP.REGION,i.id),y(e.PROP.BUTTON_POSITION,a.id)),p=P(n),t=0;t<d.values.length;t++)r=d.values[t],m.push(r),r.id===e.PROP.ITEM_TYPE&&"NATIVE_HIDDEN"===r.value&&(u=!0);E=!0,_=!0,l=new e.Component({previousComponent:p,typeId:s,values:m}),n.component._modelComponent=l,delete n.component._galleryComponent,u?(R=!0,b.gridlayout("remove",{},n.newComponent$),this.changes=null):(g(n.propertyChanges),n.component.id=l.id,n.component.title=l.getDisplayTitle(),b.gridlayout("update",n.component,!1)),this.transaction.execute(),c(n)},undo:function(){var e=this.changes;y(this.state),e&&(R=!0,this.gl$.gridlayout("remove",{},[e.component.id])),this.transaction.undo()},redo:function(){var e,n=this.changes;y(this.state),n&&(e=n.newIndex,R=!0,E=!0,_=!0,n.newGridInserted?e=p.NEW_GRID:n.newRowInserted?e=p.NEW_ROW:n.newColumnInserted?e=p.NEW_COLUMN:n.newParentContainer===n.prevParentContainer&&n.newIndex>n.prevIndex&&(e+=1),this.gl$.gridlayout("add",{},n.component,n.newParentContainer,n.newGrid,n.newRow,n.newColumn,e,n.newAlignment,n.newComponent$)),this.transaction.redo()},label:function(){return this._label}});function G(e,n,t,o,a,i,r,l,s){var d=Object.create(T);return d.changes=n,d.gl$=e,d.componentTypeId=t,d.container$=o,d.grid=a,d.row=i,d.column=r,d.index=l,d.alignment=s,d._label="create",d}var D=n.extend(apex.commandHistory.baseCommand(),{execute:function(){I=this,this.gl$.gridlayout("remove",{}),this.state=m()},updateDataLayer:function(n){this.changes.push(n),this.transaction||(this.transaction=e.transaction.start("glv")),n.component._modelComponent.remove(),c(n),n.lastChange&&this.transaction.execute()},undo:function(){var e,n,t,o=this.changes;for(y(this.state),e=o.length-1;e>=0;e--)n=o[e],R=!0,t=n.prevIndex,n.prevGridRemoved?t=p.NEW_GRID:n.prevRowRemoved?t=p.NEW_ROW:n.prevColumnRemoved&&(t=p.NEW_COLUMN),this.gl$.gridlayout("add",{},n.component,n.prevParentContainer,n.prevGrid,n.prevRow,n.prevColumn,t,n.prevAlignment,n.component$);this.transaction.undo()},redo:function(){var e,n=[],t=this.changes;for(y(this.state),R=!0,e=0;e<t.length;e++)n.push(t[e].component.id);this.gl$.gridlayout("remove",{},n),this.transaction.redo()},label:function(){return this._label}});function w(e,n){e.id="t0001",e._modelComponent=n._modelComponent}function M(e){return e.iconClass}function L(n){var t,o,a,i,r,l,s=window.componentGallery.getComponentData(n);if(o={type:i=s.type,_galleryComponent:s,id:"t0002",title:s.title},"region"===i){for(r="",l="",t=0;t<s.values.length;t++)(a=s.values[t]).id===e.PROP.REGION_TEMPLATE?r=a.value:a.id===e.PROP.REGION_TYPE&&(l=a.value);for(o.displayPoints=[],U(e.getRegionTemplates()[r].displayPoints,o.displayPoints,null,l),t=0;t<o.displayPoints.length;t++)o.displayPoints[t].components=[]}return o}var b,A={BUTTON:"buttonContainer",PAGE_ITEM:"itemContainer",REGION:"regionContainer"};function S(e,n,t){var o,a=t,i=e.getProperty(n);return i&&(o=i.getMetaData().yesValue,a=i.getValue()===o),a}function x(e,n,t){var o=t,a=e.getProperty(n);return a&&(null!==(o=a.getValue())&&""!==o||!t||(o=t)),o}function V(n){var t=n.parentId;return n.typeId===e.COMP_TYPE.REGION&&(t=x(n,e.PROP.PARENT_REGION,t)),t}function W(e){var n,t=[];for(n=0;n<e.length;n++)t.push(A[e[n]]);return t}function U(n,t,a,i){var r,l,s,d,p=0;for(r=0;r<n.length;r++)l=(s=n[r]).name,"PAGE_ITEM"===s.types[0]&&(l=o.getMessage("PD.GLV.DP_ITEMS")),"RIGHT_OF_IR_SEARCH_BAR"===s.id&&(i&&"NATIVE_IR"!==i||a&&"NATIVE_IR"!==e.getComponents(e.COMP_TYPE.REGION,{id:a})[0].getProperty(e.PROP.REGION_TYPE).getValue()||!a&&!i)||(d={types:W(s.types),id:s.id,title:l,isGrid:s.hasGridSupport,isLegacy:s.isLegacy},a||i||(s.hasOwnProperty("glvSpan")||!1===s.glvNewRow?(d.span=s.glvSpan,d.newColumn=!s.glvNewRow,!d.newColumn&&d.span>p&&(d.newRow=!0),p=d.span):d.newRow=!0),"buttonContainer"===d.types[0]&&s.hasAlignment&&(d.hasAlignment=!0),t.push(d))}function B(n,t,o,i){var r,l,s,d,p,u,g,P,c,m=[];for(r=0;r<n.length;r++){if(g={properties:[{id:e.PROP.REGION,value:i}]},"buttonContainer"===n[r])u=e.COMP_TYPE.BUTTON,g.properties.push({id:e.PROP.BUTTON_POSITION,value:t});else{if("itemContainer"!==n[r])throw"Unknown container type: "+n[r];u=e.COMP_TYPE.PAGE_ITEM}m.push({typeId:u,filter:g})}for(h&&(g.excludeGlobalPage=!0),l=e.getComponentsAdvanced(m),r=0;r<l.length;r++){if((s=l[r]).typeId===e.COMP_TYPE.BUTTON)P="button",c=a.getComponentIconClass("button",S(s,e.PROP.BUTTON_IS_HOT,!1)?"hot":"normal");else{if(s.typeId!==e.COMP_TYPE.PAGE_ITEM)throw"Unexpected component type "+s.typeId;P="item",c=a.getComponentIconClass("item",x(s,e.PROP.ITEM_TYPE))}"item"===P&&"NATIVE_HIDDEN"===x(s,e.PROP.ITEM_TYPE)||(d={type:P,id:s.id,title:s.getDisplayTitle(),iconClass:c,newGrid:S(s,e.PROP.GRID_NEW_GRID,!1),newRow:S(s,e.PROP.GRID_NEW_ROW,!1),col:1*x(s,e.PROP.GRID_COLUMN,-1),newCol:S(s,e.PROP.GRID_NEW_COLUMN,!0),span:1*x(s,e.PROP.GRID_COLUMN_SPAN,-1),hasErrors:s.hasErrors(),hasWarnings:s.hasWarnings(),isReadOnly:s.isReadOnly(),_modelComponent:s},(p=1*x(s,e.PROP.GRID_ROW_SPAN,-1))>0&&(d.rowSpan=p),a.isConditional(s)&&(d.isConditional=!0),o.push(d))}}function Y(n,t){var o,i,r,l,s,d,p,u={properties:[{id:e.PROP.REGION,value:t}]};for(h&&(u.excludeGlobalPage=!0),i=e.getComponents(e.COMP_TYPE.BUTTON,u),o=0;o<i.length;o++)n[s=x(r=i[o],e.PROP.BUTTON_POSITION)]&&(d=x(r,e.PROP.ALIGNMENT,null),p=S(r,e.PROP.BUTTON_IS_HOT,!1),l={type:"button",id:r.id,title:r.getDisplayTitle(),iconClass:a.getComponentIconClass("button",p?"hot":"normal"),hasErrors:r.hasErrors(),hasWarnings:r.hasWarnings(),isReadOnly:r.isReadOnly(),_modelComponent:r},d&&(l.alignment=d.toLowerCase()),a.isConditional(r)&&(l.isConditional=!0),n[s].push(l))}function H(n,o,i){var r,l,s,d,p,u,g,P,c,m,y,O,I=e.getRegionTemplates();for(c=i?{properties:[{id:e.PROP.PARENT_REGION,value:i}]}:{properties:[{id:e.PROP.PARENT_REGION,value:""},{id:e.PROP.REGION_POSITION,value:o}]},h&&(c.excludeGlobalPage=!0),u=e.getComponents(e.COMP_TYPE.REGION,c),r=0;r<u.length;r++)if(g=u[r],a.isDisplayed(g))if(P={},p=I[d=x(g,e.PROP.REGION_TEMPLATE)]){for(m={},y=p,(O={type:"region",id:g.id,title:g.getDisplayTitle(),iconClass:a.getComponentIconClass("region",x(g,e.PROP.REGION_TYPE)),newGrid:S(g,e.PROP.GRID_NEW_GRID,!1),newRow:S(g,e.PROP.GRID_NEW_ROW,!1),col:1*x(g,e.PROP.GRID_COLUMN,-1),newCol:S(g,e.PROP.GRID_NEW_COLUMN,!0),span:1*x(g,e.PROP.GRID_COLUMN_SPAN,-1),hasErrors:g.hasErrors(),hasWarnings:g.hasWarnings(),isReadOnly:g.isReadOnly(),itemsAboveContent:"ABOVE"===x(g,e.PROP.ITEM_DISPLAY_POSITION,"ABOVE"),_modelComponent:g}).templateName=y.name,O.maxColumns=12,O.displayPoints=[],U(y.displayPoints,O.displayPoints,O.id),P=O,a.isConditional(g)&&(P.isConditional=!0),l=0;l<P.displayPoints.length;l++)(s=P.displayPoints[l]).components=[],"regionContainer"===s.types[0]?H(s.components,null,P.id):s.types.length>1||"itemContainer"===s.types[0]?B(s.types,s.id,s.components,P.id):"buttonContainer"===s.types[0]&&(m[s.id]=s.components);Y(m,P.id),n.push(P)}else t.warn("Skipping region %s because no template found for id %s.",g.getDisplayTitle(),d)}function $(){return{type:"page",iconClass:"icon-warning",gridType:"fixed",maxColumns:12,hasColumnSpan:!0,hasRowSpan:!1,alwaysUseMax:!1,title:o.getMessage("PD.GLV.EMPTY_GRID"),displayPoints:[]}}function F(){var n,t,o,a,i,r,l,s,d;if(!O)return $();if(1!==(r=e.getComponents(e.COMP_TYPE.PAGE)).length)return $();if(a=r[0],!(i=e.getPageTemplate()))return $();for(l=i,s={type:"page",id:a.id,iconClass:"icon-page",title:a.getDisplayTitle(),hasErrors:a.hasErrors(),hasWarnings:a.hasWarnings(),isReadOnly:e.isPageReadOnly(),_modelComponent:a},d=l.grid,s.gridType=d.type.toLowerCase(),s.maxColumns=d.maxColumns,s.hasColumnSpan=d.hasColumnSpan,void 0!==d.hasRowSpan&&(s.hasRowSpan=d.hasRowSpan),s.alwaysUseMaxColumns=d.alwaysUseMaxColumns,s.displayPoints=[],U(l.displayPoints,s.displayPoints),n=s,t=0;t<n.displayPoints.length;t++)(o=n.displayPoints[t]).components=[],H(o.components,o.id);return n}function K(e){var n,t,o={};for(n=0;n<e.displayPoints.length;n++)(t=e.displayPoints[n]).components=[],"regionContainer"===t.types[0]?H(t.components,null,e.id):t.types.length>1||"itemContainer"===t.types[0]?B(t.types,t.id,t.components,e.id):"buttonContainer"===t.types[0]&&(o[t.id]=t.components);Y(o,e.id)}n((function(){var u=[e.COMP_TYPE.PAGE,e.COMP_TYPE.REGION,e.COMP_TYPE.PAGE_ITEM,e.COMP_TYPE.BUTTON],g=n("#glvMenu"),P=null;function c(e){var n,t=!0;for(n=0;n<e.length;n++)if(e[n].isReadOnly){t=!1;break}return t}function m(e){var n,t=b.gridlayout("getSelection").filter(l),a=b.gridlayout("getSelectedComponents"),i=c(a);0!==t.length&&i&&b.gridlayout(d,"displayFrom")!==a[0].id&&(n=function(e,n){var t=Object.create(D);return t.changes=[],t.gl$=e,t.transaction=null,n.length>1?t._label=o.formatMessageNoEscape("PD.GLV.CMD.DEL_N",n.length):t._label=o.formatMessageNoEscape("PD.GLV.CMD.DEL",b.gridlayout("getComponents",n)[0].title),t}(b,t),apex.commandHistory.execute(n))}function y(){var e,n=null,t=null,o=null,a=b.gridlayout("getSelection");1===a.length&&(this.col>=0&&(n=0,t=this.row,o=this.col),e=this.copy?f(b,null,a,this.container,n,t,o,this.index,this.alignment):N(b,null,a,this.container,n,t,o,this.index,this.alignment),apex.commandHistory.execute(e))}b=n("#glv");var C=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1},{l:"Row before",i:p.NEW_ROW,a:0},{l:"Row after",i:p.NEW_ROW,a:1},{l:"Column before",i:p.NEW_COLUMN,a:0},{l:"Column after",i:p.NEW_COLUMN,a:1}],v=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1}];function T(e,n,t){var o,a,i,r,l,s,d,u,g=null,P=[];function c(e){var o,a,i,r,s=[];for(i="grid"===u?C:v,o=0;o<i.length;o++)r={label:(a=i[o]).l,type:"action",action:n,container:l.element,index:a.i?a.i:e.index+a.a},"grid"===u?(a.i===p.NEW_ROW?r.row=e.row+a.a:r.row=e.row,a.i===p.NEW_COLUMN?r.col=e.col+a.a:r.col=e.col):e.alignment&&(r.alignment=e.alignment),t&&(r.copy=!0),s.push(r);return s}for(e.length>0&&e[0].element.hasClass("a-GridLayout-buttonContainer")&&(g={}),o=0;o<e.length;o++){if(l=e[o],g&&g.label!==l.region&&(g.label&&P.push(g),g={label:l.region,type:"subMenu",menu:{items:[]}}),i={label:g?l.name:l.label},u=l.type,0===l.items.length)i.type="action",i.action=n,i.container=l.element,i.index=0,"grid"===u?(i.row=0,i.col=0):l.alignment&&(i.alignment=l.alignment),t&&(i.copy=!0);else for(i.type="subMenu",i.menu={items:[]},s=i.menu.items,a=0;a<l.items.length;a++)d={label:(r=l.items[a]).name,type:"subMenu",menu:{items:c(r)}},s.push(d);g?g.menu.items.push(i):P.push(i)}return g&&P.push(g),P}function A(e){e=e||b.gridlayout("getSelectedComponents"),apex.actions.lookup("glv-disp-from-region").disabled=!(e.length>=1&&"region"===e[0].type&&e[0].id!==b.gridlayout(d,"displayFrom")),apex.actions.update("glv-disp-from-region"),apex.actions.lookup("glv-disp-from-page").disabled=null===b.gridlayout(d,"displayFrom"),apex.actions.update("glv-disp-from-page")}a.glvMakeTargetMenu=T,a.glvMenuAddAction=function(e){var n,t=null,o=null,a=null;this.col>=0&&(t=0,o=this.row,a=this.col),n=G(b,null,e,this.container,t,o,a,this.index,this.alignment),apex.commandHistory.execute(n)},apex.actions.add([{name:"glv-disp-from-page",label:o.getMessage("PD.GLV.MI.DISP_PAGE"),shortcut:"Ctrl+Alt+T",disabled:!0,action:function(e,n){b.gridlayout(d,"displayFrom",null),A()}},{name:"glv-disp-from-region",label:o.getMessage("PD.GLV.MI.DISP_REGION"),shortcut:"Ctrl+Alt+D",disabled:!0,action:function(e,n){var t=b.gridlayout("getSelectedComponents");t.length>=1&&"region"===t[0].type&&b.gridlayout(d,"displayFrom",t[0].id),this.disabled=!0,apex.actions.update(this.name),apex.actions.lookup("glv-disp-from-page").disabled=!1,apex.actions.update("glv-disp-from-page")}},{name:"glv-hide-empty",label:o.getMessage("PD.GLV.MI.HIDE_EMPTY"),shortcut:"Ctrl+Alt+E",get:function(){return b.gridlayout(d,"hideEmptyDisplayPoints")},set:function(e){b.gridlayout(d,"hideEmptyDisplayPoints",e),a.saveBoolPref("GLV_HIDE_EMPTY",e)}}]);var W={menubar:!1,items:[{id:"dispRoot",type:"action",action:"glv-disp-from-page"},{id:"dispHere",type:"action",action:"glv-disp-from-region"},{type:"toggle",action:"pd-expand-restore"},{type:"separator"},{id:"newgrid",type:"action",labelKey:"PD.GLV.MI.NEW_GRID",hide:!0},{id:"delete",type:"action",labelKey:"PD.DEL",accelerator:"Del",disabled:function(){var e=b.gridlayout("getSelectedComponents"),n=c(e);return e.length<1||1===e.length&&"page"===e[0].type||!n||b.gridlayout(d,"displayFrom")===e[0].id},action:function(){m()}},{id:"moveTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.MOVE2",menu:{items:[]}},{id:"copyTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.COPY2",menu:{items:[]}},{type:"separator"},{id:"hideConditional",type:"subMenu",disabled:!0,labelKey:"PD.GLV.MI.HIDE_COND_COMP",hide:!0,menu:{items:[]}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_LEGACY",get:function(){return b.gridlayout(d,"hideLegacyDisplayPoints")},set:function(e){b.gridlayout(d,"hideLegacyDisplayPoints",e),a.saveBoolPref("GLV_HIDE_LEGACY",e)}},{type:"toggle",action:"glv-hide-empty"},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_GLOBAL",disabled:function(){var n=b.gridlayout(d,"displayFrom"),t=!!n&&b.gridlayout("findComponentById",n)._modelComponent.isOnGlobalPage();return!O||e.isGlobalPage()||t},get:function(){return h},set:function(e){h=e,b.gridlayout("pageDataChanged"),a.saveBoolPref("GLV_HIDE_GLOBAL",e)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_BTNS",get:function(){return b.gridlayout(d,"hideButtons")},set:function(e){b.gridlayout(d,"hideButtons",e),a.saveBoolPref("GLV_HIDE_BTNS",e)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_ITEMS",get:function(){return b.gridlayout(d,"hideItems")},set:function(e){b.gridlayout(d,"hideItems",e),a.saveBoolPref("GLV_HIDE_ITEMS",e)}},{type:"subMenu",hide:!0,labelKey:"PD.GLV.MI.ZOOM",menu:{items:[{type:"radioGroup",set:function(e){b.gridlayout(d,"zoom",e)},get:function(){return b.gridlayout(d,"zoom")+""},choices:[{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","50"),value:"50"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","75"),value:"75"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","100"),value:"100"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","120"),value:"125"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","150"),value:"150"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","170"),value:"175"},{labelKey:o.formatMessage("PD.GLV.MI.ZOOM_N","200"),value:"200"}]}]}}],beforeOpen:function(e,n){var t,o=g.menu("find","moveTo"),a=g.menu("find","copyTo"),i=b.gridlayout("getSelection").filter(l);o.menu.items=[],a.menu.items=[],1===i.length&&(t=i.eq(0),b.gridlayout("getComponents",t)[0].isReadOnly||(o.menu.items=T(b.gridlayout("getDropTargets",t),y),a.menu.items=T(b.gridlayout("getDropTargets",t,"copy"),y,!0))),o.disabled=0===o.menu.items.length,a.disabled=0===a.menu.items.length},afterClose:function(e,n){n.actionTookFocus||b.gridlayout("focus")}};function U(e){var t,o,a,i,r,l="";for(n.isArray(e)||(e=[e]),t=0;t<e.length;t++){for(a in l+="["+(r=e[t]).component.id+": ",r.properties){for(l+=a+":",i=r.properties[a],o=0;o<i.length;o++)l+=i[o]+",";l=l.substring(0,l.length-1)+";"}l+="] "}return l}g.menu(W),h=a.getBoolPref("GLV_HIDE_GLOBAL",!0),b.gridlayout({getPageRoot:F,hideLegacyDisplayPoints:a.getBoolPref("GLV_HIDE_LEGACY",!0),hideEmptyDisplayPoints:a.getBoolPref("GLV_HIDE_EMPTY",!1),hideButtons:a.getBoolPref("GLV_HIDE_BTNS",!1),hideItems:a.getBoolPref("GLV_HIDE_ITEMS",!1),getIconForComponent:M,makeComponent:L,updateComponentCopy:w,deleteKeyAction:function(e){m()},contextMenuAction:function(e){var t,o;"contextmenu"===e.type?g.menu("toggle",e.pageX,e.pageY):(t=(o=n(e.target)).offset(),g.menu("toggle",t.left,t.top+o.find("h3").height()))},stateClassMap:{hasErrors:i,hasWarnings:r},stateIconMap:{hasErrors:"icon-error",hasWarnings:"icon-warning"},appendTo:"parent",cursor:"default",cursorAt:{left:2,top:2},containment:"document",multiple:!0,animate:!1,delay:10,distance:5,opacity:.9,scroll:!0,scrollSensitivity:30,iconType:"a-Icon",selectionChange:function(e,o){var a,i,r,l=[];for(i=n(this).gridlayout("getSelectedComponents"),a=0;a<i.length;a++)(r=i[a]._modelComponent)?l.push(r):t.log("No component found for selection "+i[a].id);A(i),n(document).trigger("selectionChanged",["glv",l])},added:function(e,n){var t;R?R=!1:I?(I.updateDataLayer(n),I=null):(t=G(b,n),apex.commandHistory.execute(t))},removed:function(e,n){R?R=!1:I&&(I.updateDataLayer(n),n.lastChange&&(I=null))},moved:function(e,n){var t;R?R=!1:I?(I.updateDataLayer(n),I=null):(t=N(b,n),apex.commandHistory.execute(t))},copied:function(e,n){var t;R?R=!1:I?(I.updateDataLayer(n),I=null):(t=f(b,n),apex.commandHistory.execute(t))},start:function(e,n){apex.tooltipManager.disableTooltips()},stop:function(e,n){apex.tooltipManager.enableTooltips()}}).tooltip({items:".a-GridLayout-page > h3, .a-GridLayout-pageItem > h3, .a-GridLayout-region > h3, .a-GridLayout-button > h3",show:apex.tooltipManager.defaultShowOption(),content:function(){var e=b.gridlayout("getComponents",n(this).parent())[0];return e.note?e.note:e._modelComponent?a.tooltipContentForComponent(e._modelComponent):void 0}}).on("focusin",(function(e){var t,o=n(e.target).closest(s);0!==o.length&&(b.tooltip(d,"disabled")||((t=n.Event(e)).target=t.currentTarget=o.children("h3")[0],b.tooltip("open",t)))})).on("focusout",(function(e){var t,o=n(e.target).closest(s);0!==o.length&&(b.tooltip(d,"disabled")||((t=n.Event(e)).target=t.currentTarget=o.children("h3")[0],b.tooltip("close",t)))})).on("keyup",(function(e){var t,o;if(e.keyCode===n.ui.keyCode.ESCAPE){if(0===(o=n(e.target).closest(s)).length)return;b.tooltip(d,"disabled")||((t=n.Event(e)).currentTarget=o.children("h3")[0],b.tooltip("close",t))}})),n(document).on("selectionChanged",(function(n,t,o){var a,i,r=[];if("glv"!==t){for(a=0;a<o.length;a++)(i=o[a]).typeId!==e.COMP_TYPE.PAGE&&i.typeId!==e.COMP_TYPE.REGION&&i.typeId!==e.COMP_TYPE.PAGE_ITEM&&i.typeId!==e.COMP_TYPE.BUTTON||r.push(i.id);b.is(":visible")?(b.gridlayout("setSelectedComponents",r),A()):P=r}})),n("#editor_tabs").on("tabsactivate",(function(e,n){"grid_layout"===n.newPanel[0].id&&P&&(b.gridlayout("setSelectedComponents",P),A(),P=null)})),e.observer("glv",{component:{typeIds:u},events:[e.EVENT.DISPLAY_TITLE]},(function(e){var n=b.gridlayout("findComponentById",e.component.id);t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle display title change: "+U(e)),n&&(n.title=e.component.getDisplayTitle(),b.gridlayout("update",n,!1))})),e.observer("glv",{component:{typeIds:u},events:[e.EVENT.CHANGE],properties:[e.PROP.CONDITION_TYPE,e.PROP.AUTHORIZATION_SCHEME,e.PROP.BUILD_OPTION,e.PROP.GRID_NEW_GRID,e.PROP.GRID_NEW_ROW,e.PROP.GRID_NEW_COLUMN,e.PROP.GRID_COLUMN,e.PROP.GRID_COLUMN_SPAN,e.PROP.GRID_ROW_SPAN,e.PROP.ALIGNMENT,e.PROP.ITEM_DISPLAY_POSITION,e.PROP.ITEM_TYPE,e.PROP.REGION_TYPE,e.PROP.BUTTON_IS_HOT,e.PROP.DISPLAY_SEQUENCE,e.PROP.REGION_POSITION,e.PROP.PARENT_REGION,e.PROP.REGION,e.PROP.BUTTON_POSITION]},(function(o){var i,r,l,s,d,p,u={},g={},P={};function c(e){var t=s.properties[e];return t&&n.inArray("change",t)>=0}function m(e){return s.component.getProperty(e).getValue()}function y(e){var n=s.component.getProperty(e),t=n.getMetaData().yesValue;return n.getValue()===t}function O(e,n){for(var t=n._parent?n._parent._parent:null;t;){if(e[t.id])return!0;t=t._parent?t._parent._parent:null}return!1}if(E)E=!1;else{for(t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle property changes: "+U(o)),i=0;i<o.length;i++)r=(s=o[i]).component.id,l=V(s.component),d=b.gridlayout("findComponentById",r),p=b.gridlayout("findComponentById",l),!d&&p&&(P[l]=p),d&&(c(e.PROP.ITEM_TYPE)&&"item"===d.type&&("NATIVE_HIDDEN"===m(e.PROP.ITEM_TYPE)?P[l]=p:(d.iconClass=a.getComponentIconClass("item",x(s.component,e.PROP.ITEM_TYPE)),u[r]=d)),(c(e.PROP.CONDITION_TYPE)||c(e.PROP.AUTHORIZATION_SCHEME)||c(e.PROP.BUILD_OPTION))&&(a.isConditional(s.component)?d.isConditional=!0:delete d.isConditional,u[r]=d),c(e.PROP.REGION_TYPE)&&"region"===d.type&&(d.iconClass=a.getComponentIconClass("region",x(s.component,e.PROP.REGION_TYPE)),u[r]=d),c(e.PROP.BUTTON_IS_HOT)&&"button"===d.type&&(d.iconClass=a.getComponentIconClass("button",S(s.component,e.PROP.BUTTON_IS_HOT,!1)?"hot":"normal"),u[r]=d),c(e.PROP.GRID_NEW_GRID)&&(d.newGrid=y(e.PROP.GRID_NEW_GRID),g[l]=d),c(e.PROP.GRID_NEW_ROW)&&(d.newRow=y(e.PROP.GRID_NEW_ROW),g[l]=d),c(e.PROP.GRID_NEW_COLUMN)&&(d.newCol=y(e.PROP.GRID_NEW_COLUMN),g[l]=d),c(e.PROP.GRID_COLUMN)&&(d.col=1*m(e.PROP.GRID_COLUMN),g[l]=d),c(e.PROP.GRID_COLUMN_SPAN)&&(d.span=1*m(e.PROP.GRID_COLUMN_SPAN),g[l]=d),c(e.PROP.GRID_ROW_SPAN)&&(d.rowSpan=1*m(e.PROP.GRID_ROW_SPAN),g[l]=d),c(e.PROP.ITEM_DISPLAY_POSITION)&&(d.itemsAboveContent="ABOVE"===m(e.PROP.ITEM_DISPLAY_POSITION),g[l]=d),(c(e.PROP.ALIGNMENT)||c(e.PROP.BUTTON_POSITION)||c(e.PROP.REGION)||c(e.PROP.PARENT_REGION)||c(e.PROP.REGION_POSITION)||c(e.PROP.DISPLAY_SEQUENCE))&&(d._parent._parent.id!==l&&(P[d._parent._parent.id]=d._parent._parent),P[l]=p));for(r in u)u.hasOwnProperty(r)&&(g[(d=u[r]).id]||P[d.id]||O(g,d)||O(P,d)||b.gridlayout("update",d,!1));for(r in g)g.hasOwnProperty(r)&&(P[(d=g[r]).id]||O(g,d._parent._parent)||O(P,d)||b.gridlayout("update",d,!0));for(r in P)P.hasOwnProperty(r)&&(p=P[r])&&!O(P,p)&&("page"===p.type?b.gridlayout("pageDataChanged"):(K(p),b.gridlayout("update",p,!0,!0)))}}),!0),e.observer("glv",{events:[e.EVENT.GRID]},(function(e){var n,o;if(t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle grid changes - refresh whole page: "+U(e)),!b.is(":visible"))for(P=[],o=b.gridlayout("getSelectedComponents"),n=0;n<o.length;n++)P.push(o[n].id);b.gridlayout("pageDataChanged")}),!0),e.observer("glv",{component:{typeIds:u},events:[e.EVENT.CREATE]},(function(e){var n;_?_=!1:(t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle create: "+U(e)),(n=b.gridlayout("findComponentById",V(e.component)))&&("page"===n.type?b.gridlayout("pageDataChanged"):(K(n),b.gridlayout("update",n,!0,!0))))})),e.observer("glv",{component:{typeIds:u},events:[e.EVENT.DELETE]},(function(e){var n,o=e.component.id;I||(t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle delete: "+U(e)),(n=b.gridlayout("findById",o)).length&&(R=!0,b.gridlayout("remove",{},n)))})),e.observer("glv",{component:{typeIds:u},events:[e.EVENT.ERRORS,e.EVENT.NO_ERRORS,e.EVENT.WARNINGS,e.EVENT.NO_WARNINGS]},(function(e){var n=b.gridlayout("findComponentById",e.component.id);t.getLevel()>=t.LOG_LEVEL.APP_TRACE&&t.trace("GLV Handle error or warning status change: "+U(e)),n&&(n.hasErrors=e.component.hasErrors(),n.hasWarnings=e.component.hasWarnings(),b.gridlayout("update",n,!1))}))})),n(document).on("modelReady",(function(){O=!0;try{b.gridlayout("pageDataChanged")}catch(e){t.error("Failed to load grid layout",e),O=!1,b.gridlayout("pageDataChanged")}})),n(document).on("modelCleared",(function(){O=!1,b.gridlayout("pageDataChanged")}))}(pe,apex.jQuery,apex.debug,apex.lang,window.pageDesigner);
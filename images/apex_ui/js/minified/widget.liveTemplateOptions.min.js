!function(e,t){"use strict";var s=window.apex_img_dir,i=["apex_ui/css/LiveTemplateOptions.css"],o=["APEX.LTO.COMMON","APEX.LTO.ADVANCED","APEX.LTO.NO_OPTIONS_FOUND","APEX.LTO.NOT_APPLICABLE","APEX.LTO.LIVE_TEMPLATE_OPTIONS","APEX.LTO.CANCEL","APEX.LTO.SAVE"],n=0,a=!1,r=[],p=!1,l=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};l.prototype={getValues:function(){return apex.templateOptionsHelper.getValuesFromDialog(this.properties,this.propertyEditor.el$).join(":")},resetClasses:function(){void 0!==this.el$[0]&&(this.el$[0].className=this.originalClassName)},destroy:function(){this.hasOptions&&this.propertyEditor.el$.propertyEditor("destroy"),this.propertyEditor.el$.remove()}},e.widget("apex.liveTemplateOptions",{options:{componentId:"",data:{},onSave:function(e){e()}},_resetClassNames:function(){this.components.forEach((function(e){e.resetClasses()}))},_destroyComponents:function(){this.components.forEach((function(e){e.destroy()})),e("#apex_lto_rds").remove()},_buildComponents:function(){var s=this.options,i=this;return this.components=[],s.data.forEach((function(o,n){var a=function(){var t=e(".lto"+s.componentId+"_"+n);return t.length<=0&&(t=e(".lto"+s.componentId+"_"+n,e("iframe").contents())),t}(i.element),r=apex.templateOptionsHelper.getProperties(o,(o.currentValues||"").split(":")),p=new l({title:o.title,defaultValues:o.defaultValues,properties:r,propertyEditor:{el:"",options:{propertySet:[{displayGroupId:"common",displayGroupTitle:t.getMessage("APEX.LTO.COMMON"),properties:r.common},{displayGroupId:"advanced",displayGroupTitle:t.getMessage("APEX.LTO.ADVANCED"),properties:r.advanced}]}},el$:a,originalClassName:a[0]?a[0].className:"",hasOptions:r.common[0].metaData.lovValues.length>0});i.components.push(p)})),!0},_render:function(){var s=this.element,i=this,o=e('<div class="apex-rds-container" id="apex_lto_rds"><ul class="apex-rds"></ul></div>'),a=e('<div class="a-LiveTemplateOptions--info"><span class="t-Icon fa fa-info-circle"></span><span class="a-LiveTemplateOptions--info-message"></span></div>');e("body").append(o);var r=o.find(".apex-rds");this.components.forEach((function(s){var i=s.el$,a="liveTemplateOptionsTab"+n++;r.append("<li><a href='#"+a+"'>"+s.title+"</a></li>");var p=s.propertyEditor.el$=e("<div id='"+a+"'>");o.append(p),s.hasOptions?(p.propertyEditor({data:s.propertyEditor.options,change:function(e,t){var o,n=function(e){var t=!1,i=(e||"").split(":").filter((function(e){return"#DEFAULT#"!==e||(t=!0,!1)})).join(" ");return t&&(i+=" "+s.defaultValues.join(" ")),i},a=n(t.property.value),r=n(t.previousValue);o=t.property$,t.property.value===t.property.originalValue?o.removeClass("is-changed").removeClass("has-warning"):(o.addClass("is-changed"),t.property.requires_reload&&o.addClass("has-warning")),i.removeClass(r),i.addClass(a)}}),""!==s.originalClassName||p.html("<div class='a-LiveTemplateOptions--inner-message'>"+t.getMessage("APEX.LTO.NOT_APPLICABLE")+"</div>")):p.html("<div class='a-LiveTemplateOptions--inner-message'>"+t.getMessage("APEX.LTO.NO_OPTIONS_FOUND")+"</div>")})),this.components.length>1?r.aTabs({classPrefix:"apex-rds",showAllScrollOffset:function(){return!1}}):r.hide();var l,d=!1,c=this.options;o.dialog({resizable:!0,draggable:!0,modal:!0,width:400,maxHeight:640,dialogClass:"a-LiveTemplateOptions utr utr-main",title:t.getMessage("APEX.LTO.LIVE_TEMPLATE_OPTIONS"),position:p||{my:"left top",at:"right top",of:s,collision:"flipfit"},create:function(){e(this).closest(".ui-dialog").attr("aria-modal",!0)},close:function(){apex.navigation.endFreezeScroll(),s.css({"z-index":"",position:""}),s.parentsUntil("body").each((function(){var t=e(this);"fixed"===t.css("position")&&t.css("z-index","")})),d?e(window).trigger("apexwindowresized"):i._resetClassNames(),i.destroy(),e("#apexDevToolbar").css("z-index",""),i._destroyComponents(),l.remove()},beforeClose:function(){var t=l.offset();p=[t.left-e(window).scrollLeft(),t.top-e(window).scrollTop()]},open:function(){l||(l=o.parents(".ui-dialog")),apex.navigation.beginFreezeScroll();var t=parseInt(l.next(".ui-front").css("z-index"))+1;s.css({"z-index":t,position:"relative"}),s.parentsUntil("body").each((function(){var s=e(this);"fixed"===s.css("position")&&s.css("z-index",t)})),l.css("z-index",t+1),e("#apexDevToolbar").css("z-index",t-2)},buttons:[{text:t.getMessage("APEX.LTO.CANCEL"),class:"utr-container__button",click:function(){o.dialog("close")}},{text:t.getMessage("APEX.LTO.SAVE"),class:"ui-button--hot utr-container__button",click:function(){var e=[];i.components.forEach((function(t,s){t.hasOptions&&e.push(t.getValues())})),c.onSave(e,(function(){d=!0,o.dialog("close")}),(function(e,t,s){alert(JSON.parse(e.responseText).addInfo||JSON.parse(e.responseText).error||s),apex.debug(e)}))}}]}),o.parents(".ui-dialog").first().find(".ui-dialog-buttonpane").append(a)},_create:function(){var e=this,t=function(){e._buildComponents()?e._render():e.destroy()};a&&jQuery().propertyEditor&&jQuery().aTabs&&apex.templateOptionsHelper?t():(r.push(t),a||d())}});var d=e.apex.liveTemplateOptions.preload=function(){if(!a){a=!0;var n=e("head"),p=0===apex.debug.getLevel(),l=function(e){n.append("<link rel='stylesheet' href='"+s+e+"' />")};i.forEach(l),e('link[href$="apex_ui/theme_roller/utr.css"]').length<=0&&l("apex_ui/theme_roller/utr.css"),t.loadMessagesIfNeeded(o,(function(){e.when(e.getScript(s+"apex_ui/js/"+(p?"minified/widget.propertyEditor.min.js":"widget.propertyEditor.js")),e.getScript(s+"libraries/apex/"+(p?"minified/widget.apexTabs.min.js":"widget.apexTabs.js")),e.getScript(s+"apex_ui/js/"+(p?"minified/templateOptionsHelper.min.js":"templateOptionsHelper.js"))).done((function(){for(apex.templateOptionsHelper.addGeneralPropertyType();r.length>0;){var e=r.pop();e&&e()}}))}))}}}(apex.jQuery,apex.lang);